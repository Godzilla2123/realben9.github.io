var m,ca="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};function fa(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}var ia=fa(this);
function ja(a,b){if(b)a:{var c=ia;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&ca(c,a,{configurable:!0,writable:!0,value:b})}}ja("globalThis",function(a){return a||ia});ja("String.prototype.trimRight",function(a){function b(){return this.replace(/[\s\xa0]+$/,"")}return a||b});
var ka=[[1,""],[2,"CPU"],[32768,"DISK"],[4,"FPU"],[8,"MEM"],[16,"DMA"],[32,"IO"],[64,"PS2"],[128,"PIC"],[256,"VGA"],[512,"PIT"],[1024,"MOUS"],[2048,"PCI"],[4096,"BIOS"],[8192,"FLOP"],[16384,"SERI"],[65536,"RTC"],[131072,"HPET"],[262144,"ACPI"],[524288,"APIC"],[1048576,"NET"],[2097152,"VIO"],[4194304,"9P"],[8388608,"SB16"]];const la=Object.freeze(["shared","exclusive","unlock"]);
function ma(a,b,c){this.h=a;this.A=c;this.C=[104,111,115,116,57,112];this.F=this.C.length;this.D="9P2000.L";this.j=this.B=8192;this.i=new Uint8Array(2*this.j);this.o=0;this.g=[];this.Wa=new na(b,{name:"virtio-9p",La:48,Me:4169,jh:9,Le:{ld:43008,ab:[{wc:32,Pd:0}],features:[0,32,29,28],Bk:()=>{}},notification:{ld:43264,ih:!1,Ve:[d=>{if(0!==d)n(!1,"Virtio9P Notified for non-existent queue: "+d+" (expected queue_id of 0)");else{for(;pa(this.l);){d=this.l;n(d.h,"VirtQueue addresses must be configured before use");
n(pa(d),"VirtQueue must not pop nonexistent request");var e=d.s.sa(d.h+4+2*d.j);t("Pop request: avail_last_idx="+d.j+" desc_idx="+e,2097152);e=new qa(d,e);d.j=d.j+1&d.rd;ra(this,e)}d=this.l;n(!0,"Must skip a non-negative number of requests");e=d.s.sa(d.h+2)+0&65535;d.s.Yc(d.g+4+8*d.size,e)}}]},Kc:{ld:42752},hg:{ld:42496,Dd:[{bytes:2,name:"mount tag length",read:()=>this.F,write:()=>{}}].concat(Array.from(Array(254).keys()).map(d=>({bytes:1,name:"mount tag name "+d,read:()=>this.C[d]||0,write:()=>
{}})))}});this.l=this.Wa.ab[0]}ma.prototype.W=function(){var a=[];a[0]=this.C;a[1]=this.F;a[2]=this.Wa;a[3]=this.D;a[4]=this.B;a[5]=this.j;a[6]=this.i;a[7]=this.o;a[8]=this.g.map(function(b){return[b.X,b.type,b.uid,b.Oa]});a[9]=this.h;return a};ma.prototype.G=function(a){this.C=a[0];this.F=a[1];this.Wa.G(a[2]);this.l=this.Wa.ab[0];this.D=a[3];this.B=a[4];this.j=a[5];this.i=a[6];this.o=a[7];this.g=a[8].map(function(b){return{X:b[0],type:b[1],uid:b[2],Oa:b[3]}});this.h.G(a[9])};
function x(a,b,c,d){n(0<=d,"9P: Negative payload size");B(["w","b","h"],[d+7,b+1,c],a.i,0);d+7>=a.i.length&&C("Error in 9p: payloadsize exceeds maximum length");a.o=d+7}function sa(a,b,c){c=B(["w"],[c],a.i,7);x(a,6,b,c)}
function I(a,b){n(0<=a.o,"9P: Negative replybuffersize");for(var c=a.i.subarray(0,a.o),d=0,e=c.length;e;){if(b.Yf===b.Zf.length){t("Device<"+b.Wa.name+"> Write more than device-writable capacity",2097152);break}var k=b.Zf[b.Yf];const l=k.He+b.Ee;k=k.oe-b.Ee;k>e?(k=e,b.Ee+=e):(b.Yf++,b.Ee=0);ua(b.s,c.subarray(d,d+k),l);d+=k;e-=k}b.Df+=d;c=a.l;n(c.g,"VirtQueue addresses must be configured before use");n(c.i<c.size,"VirtQueue replies must not exceed queue size");d=c.s.sa(c.g+2)+c.i&c.rd;t("Push reply: used_idx="+
d+" desc_idx="+b.vg,2097152);e=b.Df;c.s.Eb(c.g+4+8*d,b.vg);c.s.Eb(c.g+8+8*d,e);c.i++;a=a.l;n(a.g,"VirtQueue addresses must be configured before use");0===a.i?t("flush_replies: Nothing to flush",2097152):(t("Flushing "+a.i+" replies",2097152),b=a.s.sa(a.g+2)+a.i&65535,a.s.Yc(a.g+2,b),a.i=0,0<(a.Wa.h[0]&536870912)?(a.s.sa(a.h+4+2*a.size),a.Wa.Aa(1)):~a.s.sa(a.h)&1&&a.Wa.Aa(1))}
async function ra(a,b){var c=new Uint8Array(b.Cf);va(b,c);var d={offset:0},e=K(["w","b","h"],c,d),k=e[0],l=e[1],f=e[2];switch(l){case 8:k=wa(a.h);c=xa(a.h);e=[16914839];e[1]=a.B;e[2]=Math.floor(c/e[1]);e[3]=e[2]-Math.floor(k/e[1]);e[4]=e[2]-Math.floor(k/e[1]);e[5]=ya(a.h);e[6]=za(a.h);e[7]=0;e[8]=256;k=B("wwddddddw".split(""),e,a.i,7);x(a,l,f,k);I(a,b);break;case 112:case 12:e=K(["w","w"],c,d);var p=e[0];d=e[1];C("[open] fid="+p+", mode="+d);c=a.g[p].X;var r=Aa(a.h,c);C("file open "+a.g[p].Oa);k=
Ba(a.h,c,d);Ca(a.h,a.g[p].X,function(){C("file opened "+this.g[p].Oa+" tag:"+f);var v=[];v[0]=r.za;v[1]=this.j-24;B(["Q","w"],v,this.i,7);x(this,l,f,17);I(this,b)}.bind(a));break;case 70:e=K(["w","w","s"],c,d);c=e[0];p=e[1];k=e[2];C("[link] dfid="+c+", name="+k);k=Da(a.h,a.g[c].X,a.g[p].X,k);if(0>k){-1!==k&&n(!1,"[link]: Unexpected error code: "+-k);sa(a,f,-k);I(a,b);break}x(a,l,f,0);I(a,b);break;case 16:e=K(["w","s","s","w"],c,d);p=e[0];k=e[1];c=e[2];e=e[3];C("[symlink] fid="+p+", name="+k+", symgt="+
c+", gid="+e);c=Fa(a.h,k,a.g[p].X,c);r=Aa(a.h,c);r.uid=a.g[p].uid;r.Ja=e;B(["Q"],[r.za],a.i,7);x(a,l,f,13);I(a,b);break;case 18:e=K("wswwww".split(""),c,d);p=e[0];k=e[1];d=e[2];c=e[3];var q=e[4];e=e[5];C("[mknod] fid="+p+", name="+k+", major="+c+", minor="+q);c=Ga(a.h,k,a.g[p].X,c,q);r=Aa(a.h,c);r.mode=d;r.uid=a.g[p].uid;r.Ja=e;B(["Q"],[r.za],a.i,7);x(a,l,f,13);I(a,b);break;case 22:e=K(["w"],c,d);p=e[0];r=Aa(a.h,a.g[p].X);C("[readlink] fid="+p+" name="+a.g[p].Oa+" target="+r.Xd);k=B(["s"],[r.Xd],
a.i,7);x(a,l,f,k);I(a,b);break;case 72:e=K(["w","s","w","w"],c,d);p=e[0];k=e[1];d=e[2];e=e[3];C("[mkdir] fid="+p+", name="+k+", mode="+d+", gid="+e);c=Ha(a.h,k,a.g[p].X);r=Aa(a.h,c);r.mode=d|Ia;r.uid=a.g[p].uid;r.Ja=e;B(["Q"],[r.za],a.i,7);x(a,l,f,13);I(a,b);break;case 14:e=K(["w","s","w","w","w"],c,d);p=e[0];k=e[1];c=e[2];d=e[3];e=e[4];a.A.send("9p-create",[k,a.g[p].X]);C("[create] fid="+p+", name="+k+", flags="+c+", mode="+d+", gid="+e);c=Ja(a.h,k,a.g[p].X);a.g[p].X=c;a.g[p].type=1;a.g[p].Oa=k;
r=Aa(a.h,c);r.uid=a.g[p].uid;r.Ja=e;r.mode=d;B(["Q","w"],[r.za,a.j-24],a.i,7);x(a,l,f,17);I(a,b);break;case 52:e=K("wbwddws".split(""),c,d);p=e[0];c=e[2];k=0===e[4]?Infinity:e[4];e=Ka(e[1],e[3],k,e[5],e[6]);C("[lock] fid="+p+", type="+la[e.type]+", start="+e.start+", length="+e.length+", proc_id="+e.g);k=La(a.h,a.g[p].X,e,c);B(["b"],[k],a.i,7);x(a,l,f,1);I(a,b);break;case 54:e=K("wbddws".split(""),c,d);p=e[0];k=0===e[3]?Infinity:e[3];e=Ka(e[1],e[2],k,e[4],e[5]);C("[getlock] fid="+p+", type="+la[e.type]+
", start="+e.start+", length="+e.length+", proc_id="+e.g);k=Na(a.h,a.g[p].X,e);k||(k=e,k.type=2);k=B(["b","d","d","w","s"],[k.type,k.start,Infinity===k.length?0:k.length,k.g,k.h],a.i,7);x(a,l,f,k);I(a,b);break;case 24:e=K(["w","d"],c,d);p=e[0];r=Aa(a.h,a.g[p].X);C("[getattr]: fid="+p+" name="+a.g[p].Oa+" request mask="+e[1]);if(!r||r.status===Oa){C("getattr: unlinked");sa(a,f,2);I(a,b);break}e[0]|=4096;e[0]=e[1];e[1]=r.za;e[2]=r.mode;e[3]=r.uid;e[4]=r.Ja;e[5]=r.ua;e[6]=r.Ze<<8|r.af;e[7]=r.size;e[8]=
a.B;e[9]=Math.floor(r.size/512+1);e[10]=r.bd;e[11]=0;e[12]=r.pc;e[13]=0;e[14]=r.Ld;e[15]=0;e[16]=0;e[17]=0;e[18]=0;e[19]=0;B("dQwwwddddddddddddddd".split(""),e,a.i,7);x(a,l,f,153);I(a,b);break;case 26:e=K("wwwwwddddd".split(""),c,d);p=e[0];r=Aa(a.h,a.g[p].X);C("[setattr]: fid="+p+" request mask="+e[1]+" name="+a.g[p].Oa);e[1]&1&&(r.mode=e[2]);e[1]&2&&(r.uid=e[3]);e[1]&4&&(r.Ja=e[4]);e[1]&16&&(r.bd=Math.floor((new Date).getTime()/1E3));e[1]&32&&(r.pc=Math.floor((new Date).getTime()/1E3));e[1]&64&&
(r.Ld=Math.floor((new Date).getTime()/1E3));e[1]&128&&(r.bd=e[6]);e[1]&256&&(r.pc=e[8]);e[1]&8&&await Pa(a.h,a.g[p].X,e[5]);x(a,l,f,0);I(a,b);break;case 50:e=K(["w","d"],c,d);p=e[0];x(a,l,f,0);I(a,b);break;case 40:case 116:e=K(["w","d","w"],c,d);p=e[0];k=e[1];q=e[2];r=Aa(a.h,a.g[p].X);40==l&&C("[treaddir]: fid="+p+" offset="+k+" count="+q);116==l&&C("[read]: fid="+p+" ("+a.g[p].Oa+") offset="+k+" count="+q+" fidtype="+a.g[p].type);if(!r||r.status===Oa){C("read/treaddir: unlinked");sa(a,f,2);I(a,b);
break}if(2==a.g[p].type){(void 0).length<k+q&&(q=(void 0).length-k);for(e=0;e<q;e++)a.i[11+e]=(void 0)[k+e];B(["w"],[q],a.i,7);x(a,l,f,4+q)}else Ba(a.h,a.g[p].X),e=a.g[p].X,q=Math.min(q,a.i.length-11),r.size<k+q?q=r.size-k:40==l&&(q=Qa(a.h,e,k+q)-k),k>r.size&&(q=0),a.A.send("9p-read-start",[a.g[p].Oa]),e=await Ra(a.h,e,k,q),a.A.send("9p-read-end",[a.g[p].Oa,q]),e&&a.i.set(e,11),B(["w"],[q],a.i,7),x(a,l,f,4+q);I(a,b);break;case 118:e=K(["w","d","w"],c,d);p=e[0];k=e[1];q=e[2];e=a.g[p].Oa;C("[write]: fid="+
p+" ("+e+") offset="+k+" count="+q+" fidtype="+a.g[p].type);if(2===a.g[p].type){sa(a,f,95);I(a,b);break}else await Sa(a.h,a.g[p].X,k,q,c.subarray(d.offset));a.A.send("9p-write-end",[e,q]);B(["w"],[q],a.i,7);x(a,l,f,4);I(a,b);break;case 74:e=K(["w","s","w","s"],c,d);k=e[0];c=e[1];d=e[2];e=e[3];C("[renameat]: oldname="+c+" newname="+e);k=await Ta(a.h,a.g[k].X,c,a.g[d].X,e);if(0>k){-2!==k&&-1!==k&&-39!==k&&n(!1,"[renameat]: Unexpected error code: "+-k);sa(a,f,-k);I(a,b);break}x(a,l,f,0);I(a,b);break;
case 76:e=K(["w","s","w"],c,d);d=e[0];k=e[1];c=e[2];C("[unlink]: dirfd="+d+" name="+k+" flags="+c);p=Va(a.h,a.g[d].X,k);if(-1==p){sa(a,f,2);I(a,b);break}k=Wa(a.h,a.g[d].X,k);if(0>k){-39!==k&&-1!==k&&n(!1,"[unlink]: Unexpected error code: "+-k);sa(a,f,-k);I(a,b);break}x(a,l,f,0);I(a,b);break;case 100:e=K(["w","s"],c,d);C("[version]: msize="+e[0]+" version="+e[1]);a.j=e[0];k=B(["w","s"],[a.j,a.D],a.i,7);x(a,l,f,k);I(a,b);break;case 104:e=K(["w","w","s","s","w"],c,d);p=e[0];k=e[4];C("[attach]: fid="+
p+" afid="+M(e[1])+" uname="+e[2]+" aname="+e[3]);a.g[p]={X:0,type:1,uid:k,Oa:""};r=Aa(a.h,a.g[p].X);B(["Q"],[r.za],a.i,7);x(a,l,f,13);I(a,b);break;case 108:e=K(["h"],c,d);C("[flush] "+f);x(a,l,f,0);I(a,b);break;case 110:e=K(["w","w","h"],c,d);p=e[0];q=e[1];var u=e[2];C("[walk]: fid="+e[0]+" nwfid="+e[1]+" nwname="+u);if(0==u){a.g[q]={X:a.g[p].X,type:1,uid:a.g[p].uid,Oa:a.g[p].Oa};B(["h"],[0],a.i,7);x(a,l,f,2);I(a,b);break}k=[];for(e=0;e<u;e++)k.push("s");d=K(k,c,d);c=a.g[p].X;k=9;var A=0;C("walk in dir "+
a.g[p].Oa+" to: "+d.toString());for(e=0;e<u;e++){c=Va(a.h,c,d[e]);if(-1==c){C("Could not find: "+d[e]);break}k+=B(["Q"],[Aa(a.h,c).za],a.i,k);A++;a.g[q]={X:c,type:1,uid:a.g[p].uid,Oa:d[e]}}B(["h"],[A],a.i,7);x(a,l,f,k-7);I(a,b);break;case 120:e=K(["w"],c,d);C("[clunk]: fid="+e[0]);a.g[e[0]]&&0<=a.g[e[0]].X&&(await Xa(a.h,a.g[e[0]].X),a.g[e[0]].X=-1,a.g[e[0]].type=-1);x(a,l,f,0);I(a,b);break;case 32:e=K(["w","s","d","w"],c,d);p=e[0];k=e[1];d=e[2];c=e[3];C("[txattrcreate]: fid="+p+" name="+k+" attr_size="+
d+" flags="+c);a.g[p].type=2;x(a,l,f,0);I(a,b);break;case 30:e=K(["w","w","s"],c,d);p=e[0];k=e[2];C("[xattrwalk]: fid="+e[0]+" newfid="+e[1]+" name="+e[2]);sa(a,f,95);I(a,b);break;default:C("Error in Virtio9p: Unknown id "+l+" received"),Ya()}};function Za(a,b){function c(E){E=E.toString(16);return"#"+"0".repeat(6-E.length)+E}function d(E,G,V,X){E.style.width="";E.style.height="";X&&(E.style.transform="");var ha=E.getBoundingClientRect();X?E.style.transform=(1===G?"":" scaleX("+G+")")+(1===V?"":" scaleY("+V+")"):(0===G%1&&0===V%1?(e.style.imageRendering="crisp-edges",e.style.imageRendering="pixelated",e.style["-ms-interpolation-mode"]="nearest-neighbor"):(e.style.xk="",e.style["-ms-interpolation-mode"]=""),X=window.devicePixelRatio||1,0!==
X%1&&(G/=X,V/=X));1!==G&&(E.style.width=ha.width*G+"px");1!==V&&(E.style.height=ha.height*V+"px")}console.assert(a,"1st argument must be a DOM container");var e=a.getElementsByTagName("canvas")[0],k=e.getContext("2d",{alpha:!1}),l=a.getElementsByTagName("div")[0],f=document.createElement("div"),p,r,q=1,u=1,A=1,v,w=!1,y,z,D,H=!1,L=this;a=new Uint16Array([199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,162,163,165,8359,402,225,237,243,250,
241,209,170,186,191,8976,172,189,188,161,171,187,9617,9618,9619,9474,9508,9569,9570,9558,9557,9571,9553,9559,9565,9564,9563,9488,9492,9524,9516,9500,9472,9532,9566,9567,9562,9556,9577,9574,9568,9552,9580,9575,9576,9572,9573,9561,9560,9554,9555,9579,9578,9496,9484,9608,9604,9612,9616,9600,945,223,915,960,931,963,181,964,934,920,937,948,8734,966,949,8745,8801,177,8805,8804,8992,8993,247,8776,176,8729,183,8730,8319,178,9632,160]);for(var U=new Uint16Array([32,9786,9787,9829,9830,9827,9824,8226,9688,
9675,9689,9794,9792,9834,9835,9788,9658,9668,8597,8252,182,167,9644,8616,8593,8595,8594,8592,8735,8596,9650,9660]),O=[],J,aa=0;256>aa;aa++)J=127<aa?a[aa-128]:32>aa?U[aa]:aa,O[aa]=String.fromCharCode(J);k.imageSmoothingEnabled=!1;f.style.position="absolute";f.style.backgroundColor="#ccc";f.style.width="7px";f.style.display="inline-block";l.style.display="block";e.style.display="none";this.A=b;b.register("screen-set-mode",function(E){this.Pf(E)},this);b.register("screen-fill-buffer-end",function(E){this.Vf(E)},
this);b.register("screen-put-char",function(E){this.Jf(E[0],E[1],E[2],E[3],E[4])},this);b.register("screen-update-cursor",function(E){this.Gd(E[0],E[1])},this);b.register("screen-update-cursor-scanline",function(E){this.Hd(E[0],E[1])},this);b.register("screen-clear",function(){this.eg()},this);b.register("screen-set-size-text",function(E){this.Cd(E[0],E[1])},this);b.register("screen-set-size-graphical",function(E){this.Bd(E[0],E[1],E[2],E[3])},this);this.fb=function(){this.Cd(80,25);this.Cb()};this.mi=
function(){const E=new Image;if(w)E.src=e.toDataURL("image/png");else{const G=[9,16],V=document.createElement("canvas");V.width=z*G[0];V.height=D*G[1];const X=V.getContext("2d");X.imageSmoothingEnabled=!1;X.font=window.getComputedStyle(l).font;X.textBaseline="top";for(let ha=0;ha<z;ha++)for(let oa=0;oa<D;oa++){const ta=3*(oa*z+ha);X.fillStyle=c(y[ta+1]);X.fillRect(ha*G[0],oa*G[1],G[0],G[1]);X.fillStyle=c(y[ta+2]);X.fillText(O[y[ta]],ha*G[0],oa*G[1])}"none"!==f.style.display&&(X.fillStyle=f.style.backgroundColor,
X.fillRect(r*G[0],p*G[1]+parseInt(f.style.marginTop,10)-1,parseInt(f.style.width,10),parseInt(f.style.height,10)));E.src=V.toDataURL("image/png")}try{window.open("").document.write(E.outerHTML)}catch(G){}};this.Jf=function(E,G,V,X,ha){E<D&&G<z&&(G=3*(E*z+G),n(0<=V&&256>V),y[G]=V,y[G+1]=X,y[G+2]=ha,v[E]=1)};this.Cb=function(){H||requestAnimationFrame(w?Q:da)};var da=function(){for(var E=0;E<D;E++)v[E]&&(L.g(E),v[E]=0);this.Cb()}.bind(this),Q=function(){this.A.send("screen-fill-buffer");this.Cb()}.bind(this);
this.Da=function(){H=!0};this.Pf=function(E){(w=E)?(l.style.display="none",e.style.display="block"):(l.style.display="block",e.style.display="none")};this.eg=function(){k.fillStyle="#000";k.fillRect(0,0,e.width,e.height)};this.Cd=function(E,G){if(E!==z||G!==D){v=new Int8Array(G);y=new Int32Array(E*G*3);z=E;for(D=G;l.childNodes.length>G;)l.removeChild(l.firstChild);for(;l.childNodes.length<G;)l.appendChild(document.createElement("div"));for(E=0;E<G;E++)this.g(E);d(l,q,u,!0)}};this.Bd=function(E,G){e.style.display=
"block";e.width=E;e.height=G;A=640>=E&&2*E<window.innerWidth&&2*E<window.innerHeight?2:1;d(e,q*A,u*A,!1)};this.Qf=function(E,G){q=E;u=G;d(l,q,u,!0);d(e,q*A,u*A,!1)};this.Qf(q,u);this.Hd=function(E,G){E&32?f.style.display="none":(f.style.display="inline",f.style.height=Math.min(15,G-E)+"px",f.style.marginTop=Math.min(15,E)+"px")};this.Gd=function(E,G){if(E!==p||G!==r)v[E]=1,v[p]=1,p=E,r=G};this.g=function(E){var G=3*E*z,V;var X=l.childNodes[E];var ha=document.createElement("div");for(var oa=0;oa<z;){var ta=
document.createElement("span");var lb=y[G+1];var Ea=y[G+2];ta.style.backgroundColor=c(lb);ta.style.color=c(Ea);for(V="";oa<z&&y[G+1]===lb&&y[G+2]===Ea;){var F=y[G];V+=O[F];n(O[F]);oa++;G+=3;if(E===p)if(oa===r)break;else if(oa===r+1){ha.appendChild(f);break}}ta.textContent=V;ha.appendChild(ta)}X.parentNode.replaceChild(ha,X)};this.Vf=function(E){E.forEach(G=>{k.putImageData(G.Yb,G.Nf-G.Je,G.Of-G.Ke,G.Je,G.Ke,G.uf,G.tf)})};this.fb()};(function(){function a(){for(var v=location.search.substr(1).split("&"),w={},y=0;y<v.length;y++){var z=v[y].split("=");w[z[0]]=decodeURIComponent(z.slice(1).join("="))}return w}function b(v){document.title=v+" - Virtual x86 - debug";const w=document.querySelector("meta[name=description]");w&&(w.content="Running "+v)}function c(v){return document.getElementById(v)}function d(){function v(J){c("boot_options").style.display="none";b(J.name);z.filesystem=J.filesystem;J.state&&(c("reset").style.display=
"none",z.md=J.state);z.oa=J.oa;z.na=J.na;z.T=J.T;z.td=J.td;z.xb=J.xb;z.Hc=J.Hc;z.dd=J.dd;z.vf=J.vf;z.tc=J.tc;z.Na=J.state||void 0===z.Na?J.Na:z.Na;z.H=!J.state&&z.H?z.H:J.H;z.da=!J.state&&z.da?z.da:J.da;z.id=J.id;void 0!==J.cd&&(z.cd=J.cd);k(z,w)}function w(J){D.c&&setTimeout(function(){$a(J,D.c+"\n")},25)}if(window.WebAssembly){var y=document.createElement("script");y.src="build/xterm.js";y.async=!0;document.body.appendChild(y);var z={};c("start_emulation").onclick=function(){c("boot_options").style.display=
"none";q("custom");var J=c("floppy_image").files[0];if(J){var aa=J;z.oa={buffer:J}}if(J=c("cd_image").files[0])aa=J,z.na={buffer:J};if(J=c("hda_image").files[0])aa=J,z.T={buffer:J};if(J=c("hdb_image")&&c("hdb_image").files[0])aa=J,z.We={buffer:J};c("multiboot_image")&&(J=c("multiboot_image").files[0])&&(aa=J,z.td={buffer:J});aa&&b(aa.name);k(z)};e(z);var D=a();y=D.cdn||(u?"images/":"//k.copy.sh/");y=[{id:"archlinux",name:"Arch Linux",H:536870912,da:8388608,state:{url:y+"arch_state.bin.zst"},filesystem:{baseurl:y+
"arch/"}},{id:"archlinux-boot",name:"Arch Linux",H:536870912,da:8388608,filesystem:{baseurl:y+"arch/",basefs:{url:y+"fs.json"}},dd:"rw apm=off vga=0x344 video=vesafb:ypan,vremap:8 root=host9p rootfstype=9p rootflags=trans=virtio,cache=loose mitigations=off audit=0 page_poison=on tsc=reliable random.trust_cpu=on nowatchdog init=/usr/bin/init-openrc net.ifnames=0 biosdevname=0",vf:!0},{id:"serenity",name:"SerenityOS",T:{url:y+"serenity.img",async:!0,size:918552576,ka:!u},H:536870912,state:{url:y+"serenity_state-v2.bin.zst"},
ra:"https://serenityos.org/"},{id:"serenity-boot",name:"SerenityOS",T:{url:y+"serenity.img",async:!0,size:918552576,ka:!u},H:536870912,ra:"https://serenityos.org/"},{id:"helenos",H:268435456,na:{url:y+"HelenOS-0.11.2-ia32.iso",size:25765888,async:!1},name:"HelenOS",ra:"http://www.helenos.org/"},{id:"haiku",H:536870912,T:{url:y+"haiku-v2.img",async:!0,ka:!u,size:1073741824},state:{url:y+"haiku_state-v2.bin.zst"},name:"Haiku",ra:"https://www.haiku-os.org/"},{id:"haiku-boot",H:536870912,T:{url:y+"haiku-v2.img",
async:!0,ka:!u,size:1073741824},name:"Haiku",ra:"https://www.haiku-os.org/"},{id:"msdos",T:{url:y+"msdos.img",size:8388608,async:!1},cd:306,name:"MS-DOS"},{id:"freedos",oa:{url:y+"freedos722.img",size:737280,async:!1},name:"FreeDOS"},{id:"psychdos",T:{url:y+"psychdos.img",size:549453824,async:!0,ka:!u},name:"PsychDOS",ra:"https://psychoslinux.gitlab.io/DOS/INDEX.HTM"},{id:"oberon",T:{url:y+"oberon.img",size:25165824,async:!1},name:"Oberon"},{id:"windows1",oa:{url:y+"windows101.img",size:1474560,async:!1},
name:"Windows"},{id:"linux26",na:{url:y+"linux.iso",size:6547456,async:!1},name:"Linux"},{id:"linux3",na:{url:y+"linux3.iso",size:8624128,async:!1},name:"Linux"},{id:"linux4",na:{url:y+"linux4.iso",size:7731200,async:!1},name:"Linux",filesystem:{}},{id:"buildroot",xb:{url:y+"buildroot-bzimage.bin",size:5166352,async:!1},name:"Buildroot Linux",filesystem:{},dd:"tsc=reliable mitigations=off random.trust_cpu=on"},{id:"nodeos",xb:{url:y+"nodeos-kernel.bin",size:14452E3,async:!1},name:"NodeOS",dd:"tsc=reliable mitigations=off random.trust_cpu=on"},
{id:"dsl",H:268435456,na:{url:y+"dsl-4.11.rc2.iso",size:52824064,async:!1},name:"Damn Small Linux",ra:"http://www.damnsmalllinux.org/"},{id:"minix",name:"Minix",H:268435456,na:{url:y+"minix-3.3.0.iso",size:605581312,async:!0,ka:!u},ra:"https://www.minix3.org/"},{id:"kolibrios",oa:{url:u?y+"kolibri.img":"//builds.kolibrios.org/eng/data/data/kolibri.img",size:1474560,async:!1},name:"KolibriOS",ra:"https://kolibrios.org/en/"},{id:"kolibrios-fallback",oa:{url:y+"kolibri.img",size:1474560,async:!1},name:"KolibriOS"},
{id:"openbsd",T:{url:y+"openbsd.img",async:!0,ka:!u,size:1073741824},state:{url:y+"openbsd_state.bin.zst"},H:268435456,name:"OpenBSD"},{id:"openbsd-boot",T:{url:y+"openbsd.img",async:!0,ka:!u,size:1073741824},H:268435456,name:"OpenBSD"},{id:"netbsd",T:{url:y+"netbsd.img",async:!0,ka:!u,size:511000064},H:268435456,name:"NetBSD"},{id:"solos",oa:{url:y+"os8.img",async:!1,size:1474560},name:"Sol OS",ra:"http://oby.ro/os/"},{id:"bootchess",oa:{url:y+"bootchess.img",async:!1,size:1474560},name:"BootChess",
ra:"http://www.pouet.net/prod.php?which=64962"},{id:"bootbasic",oa:{url:y+"bootbasic.img",async:!1,size:1474560},name:"bootBASIC",ra:"https://github.com/nanochess/bootBASIC"},{id:"sectorlisp",oa:{url:y+"sectorlisp-friendly.bin",async:!1,size:512},name:"SectorLISP",ra:"https://justine.lol/sectorlisp2/"},{id:"sectorforth",oa:{url:y+"sectorforth.img",async:!1,size:512},name:"sectorforth",ra:"https://github.com/cesarblum/sectorforth"},{id:"floppybird",oa:{url:y+"floppybird.img",async:!1,size:1474560},
name:"Floppy Bird",ra:"http://mihail.co/floppybird"},{id:"windows2000",H:536870912,T:{url:y+"windows2k.img",size:2147483648,async:!0,ka:!u},name:"Windows 2000",state:{url:y+"windows2k_state.bin.zst"},tc:!0},{id:"windows2000-boot",H:536870912,T:{url:y+"windows2k.img",size:2147483648,async:!0,ka:!u},cd:306,name:"Windows 2000"},{id:"windows98",H:134217728,T:{url:y+"windows98.img",async:!0,ka:!u,size:314572800},name:"Windows 98",state:{url:y+"windows98_state.bin.zst"},tc:!0},{id:"windows98-boot",H:134217728,
T:{url:y+"windows98.img",async:!0,ka:!u,size:314572800},name:"Windows 98"},{id:"windows95",H:33554432,T:{url:y+"w95.img",size:242049024,async:!0,ka:!u},name:"Windows 95",state:{url:y+"windows95_state.bin.zst"}},{id:"windows95-boot",H:33554432,T:{url:y+"w95.img",size:242049024,async:!0,ka:!u},name:"Windows 95"},{id:"windows30",H:67108864,na:{url:y+"Win30.iso",async:!1},name:"Windows 3.0"},{id:"windows31",H:67108864,T:{url:y+"win31.img",async:!1,size:34463744},name:"Windows 3.1"},{id:"freebsd",H:268435456,
T:{url:y+"freebsd.img",size:2147483648,async:!0,ka:!u},state:{url:y+"freebsd_state.bin.zst"},name:"FreeBSD"},{id:"freebsd-boot",H:268435456,T:{url:y+"freebsd.img",size:2147483648,async:!0,ka:!u},name:"FreeBSD"},{id:"reactos-livecd",H:268435456,T:{url:y+"reactos-livecd-0.4.15-dev-73-g03c09c9-x86-gcc-lin-dbg.iso",size:250609664,async:!0,ka:!u},name:"ReactOS",ra:"https://reactos.org/"},{id:"reactos",H:536870912,T:{url:y+"reactos.img",size:524288E3,async:!0,ka:!u},state:{url:y+"reactos_state.bin.zst"},
tc:!0,name:"ReactOS",ra:"https://reactos.org/"},{id:"reactos-boot",H:536870912,T:{url:y+"reactos.img",size:524288E3,async:!0,ka:!u},name:"ReactOS",ra:"https://reactos.org/"},{id:"skift",na:{url:y+"skift-20200910.iso",size:64452608,async:!1},name:"Skift",ra:"https://skiftos.org/"},{id:"snowdrop",oa:{url:y+"snowdrop.img",size:1474560,async:!1},name:"Snowdrop",ra:"http://www.sebastianmihai.com/snowdrop/"},{id:"openwrt",T:{url:y+"openwrt-18.06.1-x86-legacy-combined-squashfs.img",size:19846474,async:!1},
name:"OpenWrt"},{id:"qnx",oa:{url:y+"qnx-demo-network-4.05.img",size:1474560,async:!1},name:"QNX 4.05"},{id:"9front",H:134217728,T:{url:y+"9front-8963.f84cf1e60427675514fb056cc1723e45da01e043.386.iso",size:477452288,async:!0,ka:!u},state:{url:y+"9front_state-v2.bin.zst"},Na:!0,name:"9front",ra:"https://9front.org/"},{id:"9front-boot",H:134217728,T:{url:y+"9front-8963.f84cf1e60427675514fb056cc1723e45da01e043.386.iso",size:477452288,async:!0,ka:!u},Na:!0,name:"9front",ra:"https://9front.org/"},{id:"mobius",
oa:{url:y+"mobius-fd-release5.img",size:1474560,async:!1},name:"Mobius"},{id:"android",H:536870912,na:{url:y+"android-x86-1.6-r2.iso",size:54661120,async:!0,ka:!u},name:"Android"},{id:"android4",H:536870912,na:{url:y+"android_x86_nonsse3_4.4r1_20140904.iso",size:247463936,async:!0,ka:!u},name:"Android"},{id:"tinycore",H:268435456,T:{url:y+"TinyCore-11.0.iso",async:!1},name:"Tinycore",ra:"http://www.tinycorelinux.net/"},{id:"freenos",H:268435456,na:{url:y+"FreeNOS-1.0.3.iso",async:!1,size:11014144},
name:"FreeNOS",Na:!0,ra:"http://www.freenos.org/"}];var H="realmode cmpxchg8b port80 setjmp sieve hypercall init msr smap tsc_adjust tsc rmap_chain memory taskswitch taskswitch2 eventinj ioapic apic".split(" ");for(var L of H)y.push({name:"Test case: "+L,id:"test-"+L,H:134217728,td:{url:"tests/kvm-unit-tests/x86/"+L+".flat"}});L=D.profile;D.use_bochs_bios&&(z.bk=!0);H=parseInt(D.m,10);0<H&&(z.H=1048576*Math.max(16,H));H=parseInt(D.vram,10);0<H&&(z.da=1048576*H);z.Eg=D.networking_proxy;z.audio="0"!==
D.audio;z.Na=D.acpi;for(H=0;H<y.length;H++){var U=y[H];if(L===U.id){v(U);return}var O=c("start_"+U.id);O&&(O.onclick=function(J,aa,da){da.preventDefault();q(J.id);aa.blur();v(J)}.bind(this,U,O))}"custom"===L&&(D["hda.url"]&&(z.T={size:parseInt(D["hda.size"],10)||void 0,url:D["hda.url"],async:!0}),D["cdrom.url"]&&(z.na={size:parseInt(D["cdrom.size"],10)||void 0,url:D["cdrom.url"],async:!0}),D["fda.url"]&&(z.oa={size:parseInt(D["fda.size"],10)||void 0,url:D["fda.url"],async:!1}),z.oa||z.na||z.T)&&(c("boot_options").style.display=
"none",k(z,w))}else alert("Your browser is not supported because it doesn't support WebAssembly")}function e(){var v=c("log_levels");if(v){for(var w=0;w<ka.length;w++){var y=ka[w][0];if(1!==y){var z=ka[w][1].toLowerCase(),D=document.createElement("input"),H=document.createElement("label");D.type="checkbox";H.htmlFor=D.id="log_"+z;ab&y&&(D.checked=!0);D.rd=y;H.appendChild(D);H.appendChild(document.createTextNode(bb(z,4)+" "));v.appendChild(H);w===Math.floor(ka.length/2)&&v.appendChild(document.createTextNode("\n"))}}v.onchange=
function(L){L=L.target;var U=L.rd;ab=L.checked?ab|U:ab&~U;L.blur()}}}function k(v,w){var y=v.H;y||(y=1048576*parseInt(c("memory_size").value,10),y||(alert("Invalid memory size - reset to 128MB"),y=134217728));var z=v.da;z||(z=1048576*parseInt(c("video_memory_size").value,10),z||(alert("Invalid video memory size - reset to 8MB"),z=8388608));if(!v.oa){var D=c("floppy_image").files[0];D&&(v.oa={buffer:D})}!v.xb&&(D=c("bzimage").files[0])&&(v.xb={buffer:D});!v.Hc&&(D=c("initrd").files[0])&&(v.Hc={buffer:D});
D=void 0===v.Eg?c("networking_proxy").value:v.Eg;const H=void 0===v.audio?c("disable_audio").checked:!v.audio,L=void 0===v.Na?c("enable_acpi").checked:v.Na;if(v.bk)var U="bochs-bios.bin",O="bochs-vgabios.bin";else U="seabios-debug.bin",O="vgabios-debug.bin";if(!v.md){var J={url:"bios/"+U};var aa={url:"bios/"+O}}var da=new cb({memory_size:y,vga_memory_size:z,screen_container:c("screen_container"),serial_container_xtermjs:c("terminal"),boot_order:v.cd||parseInt(c("boot_order").value,16)||0,network_relay_url:u?
"ws://localhost:8080/":D,bios:J,vga_bios:aa,fda:v.oa,hda:v.T,hdb:v.We,cdrom:v.na,multiboot:v.td,bzimage:v.xb,initrd:v.Hc,cmdline:v.dd,bzimage_initrd_from_filesystem:v.vf,acpi:L,initial_state:v.md,filesystem:v.filesystem||{},disable_speaker:H,preserve_mac_from_state_image:v.tc,autostart:!0});window.emulator=da;db(da,"emulator-ready",function(){p(da);if(da.Db.s.xa.exports.profiler_is_enabled()){var Q=document.createElement("pre");document.body.appendChild(Q);setInterval(function(){if(da.ae){var E=eb.Zj(da.Db.s);
Q.textContent=E}},1E3)}"dsl"===v.id||"helenos"===v.id?setTimeout(()=>{$a(da,"\n")},3E3):("android"===v.id||"android4"===v.id)&&setTimeout(()=>{fb(da,[57424,57552]);$a(da,"\n")},3E3);l(v,da);w&&w(da)});db(da,"download-progress",function(Q){var E=c("loading");E.style.display="block";if(Q.me.endsWith(".wasm")){var G=Q.me.split("/");E.textContent="Fetching "+G[G.length-1]+" ..."}else if(Q.le===Q.ke-1&&Q.loaded>=Q.total-2048)E.textContent="Done downloading. Starting now ...";else{G="Downloading images ";
"number"===typeof Q.le&&Q.ke&&(G+="["+(Q.le+1)+"/"+Q.ke+"] ");if(Q.total&&"number"===typeof Q.loaded){Q=Math.floor(Q.loaded/Q.total*100);Q=Math.min(100,Math.max(0,Q));var V=Math.floor(Q/2);G=G+(Q+"% [")+"#".repeat(V);G+=" ".repeat(50-V)+"]"}else G+=".".repeat(A++%50);E.textContent=G}});db(da,"download-error",function(Q){var E=c("loading");E.style.display="block";E.textContent="Loading "+Q.me+" failed. Check your connection and reload the page to try again."})}function l(v,w){function y(){var F=Date.now(),
ea=w.Db?w.Db.s.ii[0]>>>0:0;ea<O&&(O-=4294967296);var ba=ea-O;O=ea;da+=ba;if(ea=F-L)U+=ea,L=F,c("speed").textContent=(ba/1E3/ea).toFixed(1),c("avg_speed").textContent=(da/1E3/U).toFixed(1),F=c("running_time"),ba=U/1E3|0,F.textContent=60>ba?ba+"s":3600>ba?(ba/60|0)+"m "+gb(ba%60,2)+"s":(ba/3600|0)+"h "+gb((ba/60|0)%60,2)+"m "+gb(ba%60,2)+"s"}function z(F,ea){var ba=c("get_"+ea+"_image");!F||104857600<F.size?ba.style.display="none":ba.onclick=function(){var Ma=w.kc[ea];let Ua=v.id+("cdrom"===ea?".iso":
".img");Ma.ug?(Ma=Ma.ug(Ua),hb(Ma,Ua)):Ma.Wb(function(rd){rd?ib(rd,Ua):alert("The file could not be loaded. Maybe it's too big?")});ba.blur()}}function D(F){F.ctrlKey?window.onbeforeunload=function(){window.onbeforeunload=null;return"CTRL-W cannot be sent to the emulator."}:window.onbeforeunload=null}c("boot_options").style.display="none";c("loading").style.display="none";c("runtime_options").style.display="block";c("runtime_infos").style.display="block";c("screen_container").style.display="block";
v.filesystem&&f(w);c("run").onclick=function(){w.ae?(c("run").value="Run",w.stop()):(c("run").value="Pause",w.mf());c("run").blur()};c("exit").onclick=function(){w.stop();location.href=location.pathname};c("lock_mouse").onclick=function(){if(!H)c("toggle_mouse").onclick();jb();c("lock_mouse").blur()};var H=!0;c("toggle_mouse").onclick=function(){H=!H;w.h&&(w.h.Re=H);c("toggle_mouse").value=(H?"Dis":"En")+"able mouse";c("toggle_mouse").blur()};var L=0,U=0,O=0,J=null,aa=!1,da=0;db(w,"emulator-started",
function(){L=Date.now();J=setInterval(y,1E3)});db(w,"emulator-stopped",function(){y();null!==J&&clearInterval(J)});var Q=0,E=0,G=[];db(w,"9p-read-start",function(F){F=F[0];G.push(F);c("info_filesystem").style.display="block";c("info_filesystem_status").textContent="Loading ...";c("info_filesystem_last_file").textContent=F});db(w,"9p-read-end",function(F){Q+=F[1];c("info_filesystem_bytes_read").textContent=Q;const ea=F[0];G=G.filter(ba=>ba!==ea);G[0]?c("info_filesystem_last_file").textContent=G[0]:
c("info_filesystem_status").textContent="Idle"});db(w,"9p-write-end",function(F){E+=F[1];c("info_filesystem_bytes_written").textContent=E;G[0]||(c("info_filesystem_last_file").textContent=F[0])});var V=0,X=0,ha=0,oa=0;db(w,"ide-read-start",function(){c("info_storage").style.display="block";c("info_storage_status").textContent="Loading ..."});db(w,"ide-read-end",function(F){V+=F[1];X+=F[2];c("info_storage_status").textContent="Idle";c("info_storage_bytes_read").textContent=V;c("info_storage_sectors_read").textContent=
X});db(w,"ide-write-end",function(F){ha+=F[1];oa+=F[2];c("info_storage_bytes_written").textContent=ha;c("info_storage_sectors_written").textContent=oa});var ta=0,lb=0;db(w,"eth-receive-end",function(F){lb+=F[0];c("info_network").style.display="block";c("info_network_bytes_received").textContent=lb});db(w,"eth-transmit-end",function(F){ta+=F[0];c("info_network").style.display="block";c("info_network_bytes_transmitted").textContent=ta});db(w,"mouse-enable",function(F){aa=F;c("info_mouse_enabled").textContent=
F?"Yes":"No"});db(w,"screen-set-mode",function(F){F?c("info_vga_mode").textContent="Graphical":(c("info_vga_mode").textContent="Text",c("info_res").textContent="-",c("info_bpp").textContent="-")});db(w,"screen-set-size-graphical",function(F){c("info_res").textContent=F[0]+"x"+F[1];c("info_bpp").textContent=F[4]});c("reset").onclick=function(){w.Lf();c("reset").blur()};z(v.T,"hda");z(v.We,"hdb");z(v.oa,"fda");z(v.og,"fdb");z(v.na,"cdrom");c("memory_dump").onclick=function(){const F=w.Db.s.Ka;ib(new Uint8Array(F.buffer,
F.byteOffset,F.length),"v86memory.bin");c("memory_dump").blur()};c("save_state").onclick=function(){w.xe(function(F,ea){F?(console.log(F.stack),console.log("Couldn't save state: ",F)):ib(ea,"v86state.bin")});c("save_state").blur()};c("load_state").onclick=function(){c("load_state_input").click();c("load_state").blur()};c("load_state_input").onchange=function(){var F=this.files[0];if(F){var ea=w.ae;ea&&w.stop();var ba=new FileReader;ba.onload=function(Ma){try{w.Sd(Ma.target.result)}catch(Ua){throw alert("Something bad happened while restoring the state:\n"+
Ua+"\n\nNote that the current configuration must be the same as the original"),Ua;}ea&&w.mf()};ba.readAsArrayBuffer(F);this.value=""}};c("ctrlaltdel").onclick=function(){fb(w,[29,56,83,157,184,211]);c("ctrlaltdel").blur()};c("alttab").onclick=function(){fb(w,[56,15]);setTimeout(function(){fb(w,[184,143])},100);c("alttab").blur()};c("scale").onchange=function(){var F=parseFloat(this.value);(F||0<F)&&w.g&&w.g.Qf(F,F)};c("fullscreen").onclick=function(){if(w.g){var F=document.getElementById("screen_container");
if(F){var ea=F.requestFullScreen||F.webkitRequestFullscreen||F.mozRequestFullScreen||F.msRequestFullScreen;ea&&(ea.call(F),(F=document.getElementsByClassName("phone_keyboard")[0])&&F.focus());try{navigator.keyboard.lock()}catch(ba){}jb()}}};c("screen_container").onclick=function(){if(H&&aa)jb(),c("lock_mouse").blur();else if(window.getSelection().isCollapsed){let F=document.getElementsByClassName("phone_keyboard")[0];F.style.top=document.body.scrollTop+100+"px";F.style.left=document.body.scrollLeft+
100+"px";F.focus()}};const Ea=document.getElementsByClassName("phone_keyboard")[0];Ea.setAttribute("autocorrect","off");Ea.setAttribute("autocapitalize","off");Ea.setAttribute("spellcheck","false");Ea.tabIndex=0;c("screen_container").addEventListener("mousedown",F=>{F.preventDefault();Ea.focus()},!1);c("take_screenshot").onclick=function(){w.g&&w.g.mi();c("take_screenshot").blur()};if(w.l){let F=!1;c("mute").onclick=function(){F?(w.l.bf.pf(1),F=!1,c("mute").value="Mute"):(w.l.bf.pf(0),F=!0,c("mute").value=
"Unmute");c("mute").blur()}}else c("mute").remove();window.addEventListener("keydown",D,!1);window.addEventListener("keyup",D,!1);window.addEventListener("blur",D,!1)}function f(v){c("filesystem_panel").style.display="block";c("filesystem_send_file").onchange=function(){Array.prototype.forEach.call(this.files,function(w){var y=new kb(w);y.onload=function(){y.Wb(function(z){mb(v,"/"+w.name,new Uint8Array(z))})};y.load()},this);this.value="";this.blur()};c("filesystem_get_file").onkeypress=function(w){13===
w.which&&(this.disabled=!0,v.we(this.value,function(y,z){this.disabled=!1;z?(y=this.value.replace(/\/$/,"").split("/"),y=y[y.length-1]||"root",ib(z,y),this.value=""):alert("Can't read file")}.bind(this)))}}function p(v){if(v.Db){var w=v.Db.s.debug;c("dump_gdt").onclick=w.Sh.bind(w);c("dump_idt").onclick=w.Th.bind(w);c("dump_regs").onclick=w.ng.bind(w);c("dump_pt").onclick=w.Uh.bind(w);c("dump_log").onclick=function(){ib(nb.join(""),"v86.log")};var y=v.Db.s;c("debug_panel").style.display="block";setInterval(function(){c("debug_panel").textContent=
y.debug.ci().join("\n")+"\n"+y.debug.W();c("dump_log").value="Dump log"+(nb.length?" ("+nb.length+" lines)":"")},1E3);window.h=v;window.s=y;window.g=ib}}function r(){location.reload()}function q(v){window.history.pushState&&window.history.pushState({profile:v},"","?profile="+v)}var u=!location.hostname.endsWith("copy.sh"),A=0;window.addEventListener("load",d,!1);window.addEventListener("load",function(){setTimeout(function(){window.addEventListener("popstate",r)},0)});"complete"===document.readyState&&
d()})();var ab=-15786961;function ob(a){this.ports=[];this.s=a;for(var b=0;65536>b;b++)this.ports[b]=pb(this);var c=a.H[0];for(b=0;b<<17<c;b++)a.l[b]=a.re[b]=void 0,a.Hb[b]=a.qe[b]=void 0;qb(this,c,4294967296-c,function(d){t("Read from unmapped memory space, addr="+M(d>>>0,8),32);return 255},function(d,e){t("Write to unmapped memory space, addr="+M(d>>>0,8)+" value="+M(e,2),32)},function(d){t("Read from unmapped memory space, addr="+M(d>>>0,8),32);return-1},function(d,e){t("Write to unmapped memory space, addr="+M(d>>>0,
8)+" value="+M(e>>>0,8),32)})}function pb(a){return{Fa:a.Qe,sa:a.Oe,Vc:a.Pe,Jd:a.ob,Yc:a.ob,Eb:a.ob,ma:void 0}}m=ob.prototype;m.Qe=function(){return 255};m.Oe=function(){return 65535};m.Pe=function(){return-1};m.ob=function(){};
function N(a,b,c,d,e,k){function l(f){n(!1,"Overlapped read"+f+" "+M(b,4)+" ("+c.name+")");return-1>>>32-f|0}n("number"===typeof b);n("object"===typeof c);n(!d||"function"===typeof d);n(!e||"function"===typeof e);n(!k||"function"===typeof k);n(d||e||k);d||(d=l.bind(a,8));e||(e=l.bind(a,16));k||(k=l.bind(a,32));d&&(a.ports[b].Fa=d);e&&(a.ports[b].sa=e);k&&(a.ports[b].Vc=k);a.ports[b].ma=c}
function P(a,b,c,d,e,k){function l(f){n(!1,"Overlapped write"+f+" "+M(b)+" ("+c.name+")")}n("number"===typeof b);n("object"===typeof c);n(!d||"function"===typeof d);n(!e||"function"===typeof e);n(!k||"function"===typeof k);n(d||e||k);d||(d=l.bind(a,8));e||(e=l.bind(a,16));k||(k=l.bind(a,32));d&&(a.ports[b].Jd=d);e&&(a.ports[b].Yc=e);k&&(a.ports[b].Eb=k);a.ports[b].ma=c}
m.Ad=function(a,b,c,d,e,k){function l(){return c.call(this)|d.call(this)<<8}function f(){return e.call(this)|k.call(this)<<8}function p(){return c.call(this)|d.call(this)<<8|e.call(this)<<16|k.call(this)<<24}n(4===arguments.length||6===arguments.length);e&&k?(N(this,a,b,c,l,p),N(this,a+1,b,d),N(this,a+2,b,e,f),N(this,a+3,b,k)):(N(this,a,b,c,l),N(this,a+1,b,d))};
m.ac=function(a,b,c,d,e,k){function l(r){c.call(this,r&255);d.call(this,r>>8&255)}function f(r){e.call(this,r&255);k.call(this,r>>8&255)}function p(r){c.call(this,r&255);d.call(this,r>>8&255);e.call(this,r>>16&255);k.call(this,r>>>24)}n(4===arguments.length||6===arguments.length);e&&k?(P(this,a,b,c,l,p),P(this,a+1,b,d),P(this,a+2,b,e,f),P(this,a+3,b,k)):(P(this,a,b,c,l),P(this,a+1,b,d))};m.ni=function(a){var b=this.s.l[a>>>17];return b(a)|b(a+1)<<8|b(a+2)<<16|b(a+3)<<24};
m.oi=function(a,b){var c=this.s.re[a>>>17];c(a,b&255);c(a+1,b>>8&255);c(a+2,b>>16&255);c(a+3,b>>>24)};function qb(a,b,c,d,e,k,l){t("mmap_register addr="+M(b>>>0,8)+" size="+M(c,8),32);n(0===(b&131071));n(c&&0===(c&131071));k||(k=a.ni.bind(a));l||(l=a.oi.bind(a));for(b>>>=17;0<c;b++)a.s.l[b]=d,a.s.re[b]=e,a.s.Hb[b]=k,a.s.qe[b]=l,c-=131072}
var rb={4:"PORT_DMA_ADDR_2",5:"PORT_DMA_CNT_2",10:"PORT_DMA1_MASK_REG",11:"PORT_DMA1_MODE_REG",12:"PORT_DMA1_CLEAR_FF_REG",13:"PORT_DMA1_MASTER_CLEAR",32:"PORT_PIC1_CMD",33:"PORT_PIC1_DATA",64:"PORT_PIT_COUNTER0",65:"PORT_PIT_COUNTER1",66:"PORT_PIT_COUNTER2",67:"PORT_PIT_MODE",96:"PORT_PS2_DATA",97:"PORT_PS2_CTRLB",100:"PORT_PS2_STATUS",112:"PORT_CMOS_INDEX",113:"PORT_CMOS_DATA",128:"PORT_DIAG",129:"PORT_DMA_PAGE_2",146:"PORT_A20",160:"PORT_PIC2_CMD",161:"PORT_PIC2_DATA",178:"PORT_SMI_CMD",179:"PORT_SMI_STATUS",
212:"PORT_DMA2_MASK_REG",214:"PORT_DMA2_MODE_REG",218:"PORT_DMA2_MASTER_CLEAR",240:"PORT_MATH_CLEAR",368:"PORT_ATA2_CMD_BASE",496:"PORT_ATA1_CMD_BASE",632:"PORT_LPT2",744:"PORT_SERIAL4",760:"PORT_SERIAL2",884:"PORT_ATA2_CTRL_BASE",888:"PORT_LPT1",1E3:"PORT_SERIAL3",1008:"PORT_FD_BASE",1010:"PORT_FD_DOR",1012:"PORT_FD_STATUS",1013:"PORT_FD_DATA",1014:"PORT_HD_DATA",1015:"PORT_FD_DIR",1016:"PORT_SERIAL1",3320:"PORT_PCI_CMD",3321:"PORT_PCI_REBOOT",3324:"PORT_PCI_DATA",1026:"PORT_BIOS_DEBUG",1296:"PORT_QEMU_CFG_CTL",
1297:"PORT_QEMU_CFG_DATA",45056:"PORT_ACPI_PM_BASE",45312:"PORT_SMB_BASE",35072:"PORT_BIOS_APM"};function sb(a){return rb[a]?"  ("+rb[a]+")":""};function tb(a,b){this.i=this.g=!1;this.j=0;this.h=null;this.s=new ub(a,b,()=>{this.C&&vb(this,0)});this.A=a;a.register("cpu-init",this.fb,this);a.register("cpu-run",this.mf,this);a.register("cpu-stop",this.stop,this);a.register("cpu-restart",this.Lf,this);this.l()}m=tb.prototype;m.mf=function(){this.i=!1;this.g||(this.g=!0,this.A.send("emulator-started"));vb(this,0)};
function wb(a){if(a.i||!a.g)a.i=a.g=!1,a.A.send("emulator-stopped");else{a.C=!1;a:{var b=a.s;if(b.j[0]){var c=xb(b);if(b.j[0]){b=c;break a}}for(var d=c=yb();1>d-c;){d=b;var e=yb();d.gk();d.xf+=yb()-e;d.mg++;d=yb();e=zb(b,d);Ab(b);if(b.j[0]){b=e;break a}}b=0}vb(a,b)}}function vb(a,b){const c=++a.j;a.C=!0;a.B(b,c)}m.stop=function(){this.g&&(this.i=!0)};m.Da=function(){this.o()};m.Lf=function(){this.s.Ib();Bb(this.s)};m.fb=function(a){this.s.fb(a,this.A);this.A.send("emulator-ready")};
if("undefined"!==typeof process)tb.prototype.B=function(a,b){1>a?global.setImmediate(c=>{c===this.j&&wb(this)},b):setTimeout(c=>{c===this.j&&wb(this)},a,b)},tb.prototype.l=function(){},tb.prototype.o=function(){};else if("undefined"!==typeof Worker){function a(){globalThis.onmessage=function(b){const c=b.data.t;1>c?postMessage(b.data.kh):setTimeout(()=>postMessage(b.data.kh),c)}}tb.prototype.l=function(){const b=URL.createObjectURL(new Blob(["("+a.toString()+")()"],{type:"text/javascript"}));this.h=
new Worker(b);this.h.onmessage=c=>{c.data===this.j&&wb(this)};URL.revokeObjectURL(b)};tb.prototype.B=function(b,c){this.h.postMessage({t:b,kh:c})};tb.prototype.o=function(){this.h.terminate();this.h=null}}else tb.prototype.B=function(a){setTimeout(()=>{wb(this)},a)},tb.prototype.l=function(){},tb.prototype.o=function(){};tb.prototype.xe=function(){return this.s.xe()};tb.prototype.Sd=function(a){return this.s.Sd(a)};
if("object"===typeof performance&&performance.now)var yb=performance.now.bind(performance);else if("function"===typeof require){const {performance:a}=require("perf_hooks");yb=a.now.bind(a)}else"object"===typeof process&&process.hrtime?yb=function(){var a=process.hrtime();return 1E3*a[0]+a[1]/1E6}:yb=Date.now;var kb,Cb,Db,Eb,Fb,Gb,Hb,Ib;function bb(a,b){return(a||0===a?a+"":"").padEnd(b," ")}function gb(a,b){return(a||0===a?a+"":"").padStart(b,"0")}function R(a,b,c,d){return new Proxy({},{get:function(e,k){e=new a(b.buffer,c,d);const l=e[k];if("function"===typeof l)return l.bind(e);n(/^\d+$/.test(k)||"buffer"===k||"length"===k||"BYTES_PER_ELEMENT"===k||"byteOffset"===k);return l},set:function(e,k,l){n(/^\d+$/.test(k));(new a(b.buffer,c,d))[k]=l;return!0}})}
function M(a,b){a=a?a.toString(16):"";return"0x"+gb(a.toUpperCase(),b||1)}if("undefined"!==typeof crypto&&crypto.getRandomValues){let a=new Int32Array(1);var Jb=function(){crypto.getRandomValues(a);return a[0]}}else if("undefined"!==typeof require){const a=require("crypto");Jb=function(){return a.Ek(4).readInt32LE(0)}}else n(!1,"Unsupported platform: No cryptographic random values");function Kb(a){n(a instanceof ArrayBuffer);this.buffer=a;this.byteLength=a.byteLength;this.onload=void 0}m=Kb.prototype;
m.load=function(){this.onload&&this.onload({buffer:this.buffer})};m.get=function(a,b,c){n(a+b<=this.byteLength);c(new Uint8Array(this.buffer,a,b))};m.set=function(a,b,c){n(a+b.byteLength<=this.byteLength);(new Uint8Array(this.buffer,a,b.byteLength)).set(b);c()};m.Wb=function(a){a(this.buffer)};m.W=function(){const a=[];a[0]=this.byteLength;a[1]=new Uint8Array(this.buffer);return a};m.G=function(a){this.byteLength=a[0];this.buffer=a[1].slice().buffer};
(function(){if("function"===typeof Math.clz32)Cb=function(d){n(0<d);n(256>d);return 31-Math.clz32(d)},Db=function(d){n(0<d);return 31-Math.clz32(d)};else{for(var a=new Int8Array(256),b=0,c=-2;256>b;b++)b&b-1||c++,a[b]=c;Cb=function(d){n(0<d);n(256>d);return a[d]};Db=function(d){d>>>=0;n(0<d);var e=d>>>16;if(e){var k=e>>>8;return k?24+a[k]:16+a[e]}return(k=d>>>8)?8+a[k]:a[d]}}})();
function Lb(a){var b=new Uint8Array(a),c,d;n(0===(a&a-1));this.length=0;this.push=function(e){this.length!==a&&this.length++;b[d]=e;d=d+1&a-1};this.shift=function(){if(this.length){var e=b[c];c=c+1&a-1;this.length--;return e}return-1};this.clear=function(){this.length=d=c=0};this.clear()}function Mb(){this.size=65536;this.data=new Float32Array(65536);this.length=this.end=this.start=0;n(!0)}
Mb.prototype.push=function(a){this.length===this.size?this.start=this.start+1&this.size-1:this.length++;this.data[this.end]=a;this.end=this.end+1&this.size-1};Mb.prototype.shift=function(){if(this.length){var a=this.data[this.start];this.start=this.start+1&this.size-1;this.length--;return a}};
function Nb(a,b){var c=new Float32Array(b);b>a.length&&(b=a.length);var d=a.start+b,e=a.data.subarray(a.start,d);c.set(e);d>=a.size&&(d-=a.size,c.set(a.data.subarray(0,d),e.length));a.start=d;a.length-=b;return c}Mb.prototype.clear=function(){this.length=this.end=this.start=0};function ib(a,b){a instanceof Array||(a=[a]);hb(new Blob(a),b)}
function hb(a,b){var c=document.createElement("a");c.download=b;c.href=window.URL.createObjectURL(a);c.dataset.downloadurl=["application/octet-stream",c.download,c.href].join(":");document.createEvent?(a=document.createEvent("MouseEvent"),a.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(a)):c.click();window.URL.revokeObjectURL(c.href)}
function Ob(a){"number"===typeof a?this.view=new Uint8Array(a+7>>3):a instanceof ArrayBuffer?this.view=new Uint8Array(a):console.assert(!1)}Ob.prototype.set=function(a,b){const c=a>>3;a=1<<(a&7);this.view[c]=b?this.view[c]|a:this.view[c]&~a};Ob.prototype.get=function(a){return this.view[a>>3]>>(a&7)&1};Ob.prototype.Wb=function(){return this.view.buffer};function Pb(a,b,c,d,e,k){this.ha=new Qb(this,a,b,d,e,k);this.ia=new Qb(this,a,c,!1,e,k);this.aa=this.ha;this.s=a;0===e?(this.g=496,this.ba=14,this.La=240):1===e?(this.g=368,this.ba=15,this.La=248):n(!1,"IDE device with nr "+e+" ignored");this.j=this.g|516;this.h=46080;this.J=[134,128,16,112,5,0,160,2,0,128,1,1,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,this.h&255|1,this.h>>8,0,0,0,0,0,0,0,0,0,0,67,16,212,130,0,0,0,0,0,0,0,0,0,0,0,0,this.ba,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.hb=[{size:8},{size:4},void 0,void 0,{size:16}];this.name="ide"+e;this.l=2;N(a.u,this.g|7,this,function(){t("lower irq",32768);Rb(this.s,this.ba);return this.ah()});N(a.u,this.j|2,this,this.ah);P(a.u,this.j|2,this,this.hk);N(a.u,this.g|0,this,function(){return Sb(this.aa,1)},function(){return Sb(this.aa,2)},function(){return Sb(this.aa,4)});N(a.u,this.g|1,
this,function(){t("Read error: "+M(this.aa.error&255)+" slave="+(this.aa===this.ia),32768);return this.aa.error&255});N(a.u,this.g|2,this,function(){t("Read bytecount: "+M(this.aa.Z&255),32768);return this.aa.Z&255});N(a.u,this.g|3,this,function(){t("Read sector: "+M(this.aa.va&255),32768);return this.aa.va&255});N(a.u,this.g|4,this,function(){t("Read 1F4: "+M(this.aa.ja&255),32768);return this.aa.ja&255});N(a.u,this.g|5,this,function(){t("Read 1F5: "+M(this.aa.la&255),32768);return this.aa.la&255});
N(a.u,this.g|6,this,function(){t("Read 1F6",32768);return this.aa.Tb&255});P(a.u,this.g|0,this,function(l){Tb(this.aa,l,1)},function(l){Tb(this.aa,l,2)},function(l){Tb(this.aa,l,4)});P(a.u,this.g|1,this,function(l){t("1F1/lba_count: "+M(l),32768);this.ha.pd=(this.ha.pd<<8|l)&65535;this.ia.pd=(this.ia.pd<<8|l)&65535});P(a.u,this.g|2,this,function(l){t("1F2/bytecount: "+M(l),32768);this.ha.Z=(this.ha.Z<<8|l)&65535;this.ia.Z=(this.ia.Z<<8|l)&65535});P(a.u,this.g|3,this,function(l){t("1F3/sector: "+M(l),
32768);this.ha.va=(this.ha.va<<8|l)&65535;this.ia.va=(this.ia.va<<8|l)&65535});P(a.u,this.g|4,this,function(l){t("1F4/sector low: "+M(l),32768);this.ha.ja=(this.ha.ja<<8|l)&65535;this.ia.ja=(this.ia.ja<<8|l)&65535});P(a.u,this.g|5,this,function(l){t("1F5/sector high: "+M(l),32768);this.ha.la=(this.ha.la<<8|l)&65535;this.ia.la=(this.ia.la<<8|l)&65535});P(a.u,this.g|6,this,function(l){var f=l&16;t("1F6/drive: "+M(l,2),32768);f?(t("Slave",32768),this.aa=this.ia):this.aa=this.ha;this.ha.Tb=l;this.ia.Tb=
l;this.ha.Jc=this.ia.Jc=l>>6&1;this.ha.head=this.ia.head=l&15});this.i=this.qa=this.sc=0;P(a.u,this.g|7,this,function(l){t("lower irq",32768);Rb(this.s,this.ba);var f=this.aa;t("ATA Command: "+M(l)+" slave="+(f.Tb>>4&1),32768);if(f.buffer)switch(f.j=l,f.error=0,l){case 8:t("ATA device reset",32768);f.i=0;f.g=0;f.h=0;Ub(f);f.R();break;case 16:f.status=80;f.ja=0;f.R();break;case 248:f.status=80;var p=f.l-1;f.va=p&255;f.ja=p>>8&255;f.la=p>>16&255;f.Tb=f.Tb&240|p>>24&15;f.R();break;case 39:f.status=80;
p=f.l-1;f.va=p&255;f.ja=p>>8&255;f.la=p>>16&255;f.va|=p>>24<<8&65280;f.R();break;case 32:case 36:case 41:case 196:Vb(f,l);break;case 48:case 52:case 57:case 197:var r=52===l||57===l;p=Wb(f,r);r=Xb(f,r);l=48===l||52===l;var q=p*f.o,u=r*f.o;t("ATA write lba="+M(r)+" mode="+(f.Jc?"lba":"chs")+" lbacount="+M(p)+" bytecount="+M(q),32768);u+q>f.buffer.byteLength?(n(!1,"ATA write: Outside of disk"),f.status=255,f.R()):(f.status=88,Yb(f,q),f.g=l?512:Math.min(q,512*f.K),f.V=u);break;case 144:f.R();f.error=
257;f.status=80;break;case 145:f.status=80;f.R();break;case 160:f.I&&(f.status=88,Zb(f,12),f.g=12,f.Z=1,f.R());break;case 161:t("ATA identify packet device",32768);f.I?($b(f),f.status=88,f.ja=20,f.la=235):f.status=65;f.R();break;case 198:t("Logical sectors per DRQ Block: "+M(f.Z&255),32768);f.K=f.Z&255;f.status=80;f.R();break;case 37:case 200:r=37===l;p=Wb(f,r);r=Xb(f,r);l=p*f.o;q=r*f.o;t("ATA DMA read lba="+M(r)+" lbacount="+M(p)+" bytecount="+M(l),32768);q+l>f.buffer.byteLength?(n(!1,"ATA read: Outside of disk"),
f.status=255,f.R()):(f.status=88,f.ma.qa|=1);break;case 53:case 202:r=53===l;p=Wb(f,r);r=Xb(f,r);l=p*f.o;q=r*f.o;t("ATA DMA write lba="+M(r)+" lbacount="+M(p)+" bytecount="+M(l),32768);q+l>f.buffer.byteLength?(n(!1,"ATA DMA write: Outside of disk"),f.status=255,f.R()):(f.status=88,f.ma.qa|=1);break;case 64:t("read verify sectors",32768);f.status=80;f.R();break;case 218:t("Unimplemented: get media status",32768);f.status=65;f.error=4;f.R();break;case 224:t("ATA standby immediate",32768);f.status=80;
f.R();break;case 225:t("ATA idle immediate",32768);f.status=80;f.R();break;case 231:t("ATA flush cache",32768);f.status=80;f.R();break;case 236:t("ATA identify device",32768);if(f.I){f.status=65;f.error=4;f.R();break}$b(f);f.status=88;f.R();break;case 234:t("flush cache ext",32768);f.status=80;f.R();break;case 239:t("set features: "+M(f.Z&255),32768);f.status=80;f.R();break;case 222:f.status=80;f.R();break;case 245:t("security freeze lock",32768);f.status=80;f.R();break;case 249:t("Unimplemented: set max address",
32768);f.status=65;f.error=4;break;default:n(!1,"New ATA cmd on 1F7: "+M(l)),f.status=65,f.error=4}else t("abort: No buffer",32768),f.error=4,f.status=65,f.R()});N(a.u,this.h|4,this,void 0,void 0,this.Oh);P(a.u,this.h|4,this,void 0,void 0,this.Qh);N(a.u,this.h,this,this.ig,void 0,this.Ph);P(a.u,this.h,this,this.kg,void 0,this.Rh);N(a.u,this.h|2,this,this.jg);P(a.u,this.h|2,this,this.lg);N(a.u,this.h|8,this,function(){t("DMA read 0x8",32768);return 0});N(a.u,this.h|10,this,function(){t("DMA read 0xA",
32768);return 0});ac(a.v.Qa,this);Object.seal(this)}m=Pb.prototype;m.ah=function(){if(this.aa.buffer){var a=this.aa.status;t("ATA read status: "+M(a,2),32768);return a}return 0};m.hk=function(a){t("set device control: "+M(a,2)+" interrupts "+(a&2?"disabled":"enabled"),32768);a&4&&(t("Reset via control port",32768),Rb(this.s,this.ba),Ub(this.ha),Ub(this.ia));this.l=a};m.Oh=function(){t("dma get address: "+M(this.sc,8),32768);return this.sc};
m.Qh=function(a){t("dma set address: "+M(a,8),32768);this.sc=a};m.jg=function(){t("DMA read status: "+M(this.qa),32768);return this.qa};m.lg=function(a){t("DMA set status: "+M(a),32768);this.qa&=~(a&6)};m.Ph=function(){return this.ig()|this.jg()<<16};m.ig=function(){t("DMA read command: "+M(this.i),32768);return this.i};m.Rh=function(a){t("DMA write command: "+M(a),32768);this.kg(a&255);this.lg(a>>16&255)};
m.kg=function(a){t("DMA write command8: "+M(a),32768);let b=this.i;this.i=a&9;if((b&1)!==(a&1))if(0===(a&1))this.qa&=-2;else switch(this.qa|=1,this.aa.j){case 37:case 200:bc(this.aa);break;case 202:case 53:cc(this.aa);break;case 160:dc(this.aa);break;default:t("Spurious dma command write, current command: "+M(this.aa.j),32768),n(!1)}};m.R=function(){0===(this.l&2)&&(t("push irq",32768),this.qa|=4,this.s.Ta(this.ba))};
m.W=function(){var a=[];a[0]=this.ha;a[1]=this.ia;a[2]=this.g;a[3]=this.ba;a[4]=this.La;a[5]=this.j;a[6]=this.h;a[7]=this.name;a[8]=this.l;a[9]=this.sc;a[10]=this.qa;a[11]=this.aa===this.ha;a[12]=this.i;return a};m.G=function(a){this.ha.G(a[0]);this.ia.G(a[1]);this.g=a[2];this.ba=a[3];this.La=a[4];this.j=a[5];this.h=a[6];this.name=a[7];this.l=a[8];this.sc=a[9];this.qa=a[10];this.aa=a[11]?this.ha:this.ia;this.i=a[12]};
function Qb(a,b,c,d,e,k){this.ma=a;this.A=k;this.Y=e;this.s=b;this.buffer=c;this.o=d?2048:512;this.I=d;this.F=this.C=this.D=this.l=0;this.buffer&&(this.l=this.buffer.byteLength/this.o,this.l!==(this.l|0)&&(t("Warning: Disk size not aligned with sector size",32768),this.l=Math.ceil(this.l)),d?(this.D=1,this.C=0):(this.D=16,this.C=63),this.F=this.l/this.D/this.C,this.F!==(this.F|0)&&(t("Warning: Rounding up cylinder count. Choose different head number",32768),this.F=Math.floor(this.F)),a=b.v.Xc,n(!0),
S(a,57,a.jc[57]|1<<4*this.Y),n(!0),S(a,18,a.jc[18]&15|240),S(a,27,this.F&255),S(a,28,this.F>>8&255),S(a,29,this.D&255),S(a,30,255),S(a,31,255),S(a,32,200),S(a,33,this.F&255),S(a,34,this.F>>8&255),S(a,35,this.C&255));this.B={eh:0,fh:0,bg:0,cg:0,zg:!1};this.buffer=c;this.Tb=this.head=this.la=this.ja=this.pd=this.va=this.Z=this.Jc=0;this.status=80;this.K=128;this.i=this.error=0;this.data=new Uint8Array(65536);this.U=new Uint16Array(this.data.buffer);this.M=new Int32Array(this.data.buffer);this.g=this.h=
0;this.S=this.j=-1;this.pa=this.V=0;this.P=new Set;this.$=new Set;Object.seal(this)}function Ub(a){a.I?(a.status=0,a.Z=1,a.error=1,a.va=1,a.ja=20,a.la=235):(a.status=81,a.Z=1,a.error=1,a.va=1,a.ja=0,a.la=0);for(const b of a.P)a.$.add(b);a.P.clear()}m=Qb.prototype;m.R=function(){this.ma.R()};m.ge=function(){this.status=80;n(this.h<=this.data.length);var a=this.data.subarray(0,this.h);n(0===this.h%512);ec(this,this.j,this.h/512);this.R();this.buffer.set(this.V,a,function(){});fc(this,this.h)};
function gc(a,b){var c=b[2]<<24|b[3]<<16|b[4]<<8|b[5],d=b[7]<<8|b[8];b=b[1];var e=d*a.o,k=c*a.o;t("CD read lba="+M(c)+" lbacount="+M(d)+" bytecount="+M(e)+" flags="+M(b),32768);a.h=0;var l=a.la<<8&65280|a.ja&255;t(M(a.la,2)+" "+M(a.ja,2),32768);a.ja=a.la=0;65535===l&&l--;l>e&&(l=e);k>=a.buffer.byteLength?(n(!1,"CD read: Outside of disk  end="+M(k+e)+" size="+M(a.buffer.byteLength)),a.status=255,a.R()):0===e?(a.status=80,a.i=0):(e=Math.min(e,a.buffer.byteLength-k),a.status=208,hc(a),a.ca(k,e,f=>{t("cd read: data arrived",
32768);ic(a,f);a.status=88;a.Z=a.Z&-8|2;a.R();l&=-4;a.g=l;a.g>a.h&&(a.g=a.h);a.ja=a.g&255;a.la=a.g>>8&255;jc(a,e)}))}
function kc(a,b){var c=b[2]<<24|b[3]<<16|b[4]<<8|b[5],d=b[7]<<8|b[8];b=b[1];var e=d*a.o,k=c*a.o;t("CD read DMA lba="+M(c)+" lbacount="+M(d)+" bytecount="+M(e)+" flags="+M(b),32768);k>=a.buffer.byteLength?(n(!1,"CD read: Outside of disk  end="+M(k+e)+" size="+M(a.buffer.byteLength)),a.status=255,a.R()):(a.status=208,hc(a),a.ca(k,e,l=>{t("atapi_read_dma: Data arrived");jc(a,e);a.status=88;a.Z=a.Z&-8|2;ic(a,l);dc(a)}))}
function dc(a){if(0===(a.ma.qa&1))t("do_atapi_dma: Status not set",32768);else if(0===(a.status&8))t("do_atapi_dma: DRQ not set",32768);else{t("atapi dma transfer len="+a.h,32768);var b=a.ma.sc,c=0,d=a.data;do{var e=a.s.h(b),k=a.s.sa(b+4),l=a.s.Fa(b+7)&128;k||(k=65536);t("dma read dest="+M(e)+" count="+M(k)+" datalen="+M(a.h),32768);ua(a.s,d.subarray(c,Math.min(c+k,a.h)),e);c+=k;b+=8;if(c>=a.h&&!l){t("leave early end="+ +l+" offset="+M(c)+" data_length="+M(a.h)+" cmd="+M(a.j),32768);break}}while(!l);
t("end offset="+c,32768);a.status=80;a.ma.qa&=-2;a.Z=a.Z&-8|3;a.R()}}
function Sb(a,b){if(a.i<a.g){n(a.i+b-1<a.g);n(0===a.i%b,M(a.i)+" "+b);var c=1===b?a.data[a.i]:2===b?a.U[a.i>>>1]:a.M[a.i>>>2];a.i+=b;0===(a.i&(0===(a.g&4095)?4095:255))&&t("Read 1F0: "+M(a.data[a.i],2)+" cur="+M(a.i)+" cnt="+M(a.h),32768);a.i>=a.g&&(t("read_end cmd="+M(a.j)+" data_pointer="+M(a.i)+" end="+M(a.g)+" length="+M(a.h),32768),160===a.j?a.g===a.h?(a.status=80,a.Z=a.Z&-8|3,a.R()):(a.status=88,a.Z=a.Z&-8|2,a.R(),b=a.la<<8&65280|a.ja&255,a.g+b>a.h?(a.ja=a.h-a.g&255,a.la=a.h-a.g>>8&255,a.g=
a.h):a.g+=b,t("data_end="+M(a.g),32768)):(a.error=0,a.i>=a.h?a.status=80:(196===a.j||41===a.j?(b=Math.min(a.K,(a.h-a.g)/512),n(0===b%1)):(n(32===a.j||36===a.j),b=1),ec(a,a.j,b),a.g+=512*b,a.status=88),a.R()));return c}t("Read 1F0: empty",32768);a.i+=b;return 0}
function Tb(a,b,c){n(0===a.i%c);if(a.i>=a.g)t("Redundant write to data port: "+M(b)+" count="+M(a.g)+" cur="+M(a.i),32768);else if((0===(a.i+c&(0===(a.g&4095)?4095:255))||20>a.g)&&t("Data port: "+M(b>>>0)+" count="+M(a.g)+" cur="+M(a.i),32768),1===c?a.data[a.i++]=b:2===c?(a.U[a.i>>>1]=b,a.i+=2):(a.M[a.i>>>2]=b,a.i+=4),n(a.i<=a.g),a.i===a.g)if(160===a.j){t("ATAPI Command: "+M(a.data[0])+" slave="+(a.Tb>>4&1),32768);a.i=0;a.S=a.data[0];switch(a.S){case 0:t("test unit ready",32768);Zb(a,0);a.g=a.h;a.status=
80;break;case 3:Zb(a,a.data[4]);a.g=a.h;a.status=88;a.data[0]=240;a.data[2]=5;a.data[7]=8;break;case 18:b=a.data[4];a.status=88;t("inquiry: "+M(a.data[1],2)+" length="+b,32768);a.data.set([5,128,1,49,31,0,0,0,83,79,78,89,32,32,32,32,67,68,45,82,79,77,32,67,68,85,45,49,48,48,48,32,49,46,49,97]);a.g=a.h=Math.min(36,b);break;case 26:Zb(a,a.data[4]);a.g=a.h;a.status=88;break;case 30:Zb(a,0);a.g=a.h;a.status=80;break;case 37:b=a.l-1;ic(a,new Uint8Array([b>>24&255,b>>16&255,b>>8&255,b&255,0,0,a.o>>8&255,
a.o&255]));a.g=a.h;a.status=88;break;case 40:a.pd&1?kc(a,a.data):gc(a,a.data);break;case 66:b=a.data[8];Zb(a,Math.min(8,b));a.g=a.h;t("read q subcode: length="+b,32768);a.status=88;break;case 67:b=a.data[8]|a.data[7]<<8;c=a.data[9]>>6;Zb(a,b);a.g=a.h;t("read toc: "+M(c,2)+" length="+b+" "+(a.data[1]&2)+" "+M(a.data[6]),32768);0===c?(b=a.l,a.data.set(new Uint8Array([0,18,1,1,0,20,1,0,0,0,0,0,0,22,170,0,b>>24,b>>16&255,b>>8&255,b&255]))):1===c?a.data.set(new Uint8Array([0,10,1,1,0,0,0,0,0,0,0,0])):
n(!1,"Unimplemented format: "+c);a.status=88;break;case 70:b=a.data[8]|a.data[7]<<8;b=Math.min(b,32);Zb(a,b);a.g=a.h;a.data[0]=b-4>>24&255;a.data[1]=b-4>>16&255;a.data[2]=b-4>>8&255;a.data[3]=b-4&255;a.data[6]=8;a.data[10]=3;a.status=88;break;case 81:Zb(a,0);a.g=a.h;a.status=80;break;case 82:t("Unimplemented ATAPI command: "+M(a.data[0]),32768);a.status=81;a.h=0;a.error=80;break;case 90:b=a.data[8]|a.data[7]<<8;c=a.data[2];t("mode sense: "+M(c)+" length="+b,32768);42===c&&Zb(a,Math.min(30,b));a.g=
a.h;a.status=88;break;case 189:Zb(a,a.data[9]|a.data[8]<<8);a.g=a.h;a.data[5]=1;a.status=88;break;case 74:a.status=81;a.h=0;a.error=80;t("Unimplemented ATAPI command: "+M(a.data[0]),32768);break;case 190:t("Unimplemented ATAPI command: "+M(a.data[0]),32768);Zb(a,0);a.g=a.h;a.status=80;break;default:a.status=81,a.h=0,a.error=80,t("Unimplemented ATAPI command: "+M(a.data[0]),32768),n(!1)}a.Z=a.Z&-8|2;0===(a.status&128)&&a.R();0===(a.status&128)&&0===a.h&&(a.Z|=1,a.status&=-9)}else t("write_end data_pointer="+
M(a.i)+" data_length="+M(a.h),32768),a.i>=a.h?a.ge():(n(48===a.j||52===a.j||197===a.j,"Unexpected command: "+M(a.j)),a.status=88,a.g+=512,a.R())}
function ec(a,b,c){t("Advance sectors="+c+" old_bytecount="+a.Z,32768);a.Z-=c;36===b||41===b||52===b||57===b||37===b||53===b?(b=c+lc(a),a.va=b&255|b>>16&65280,a.ja=b>>8&255,a.la=b>>16&255):a.Jc?(b=c+mc(a),a.va=b&255,a.ja=b>>8&255,a.la=b>>16&255,a.head=a.head&-16|b&15):(b=c+nc(a),c=b/(a.D*a.C)|0,a.ja=c&255,a.la=c>>8&255,a.head=(b/a.C|0)%a.D&15,a.va=b%a.C+1&255,n(b===nc(a)))}
function Vb(a,b){var c=36===b||41===b,d=Wb(a,c);c=Xb(a,c);var e=32===b||36===b,k=d*a.o,l=c*a.o;t("ATA read cmd="+M(b)+" mode="+(a.Jc?"lba":"chs")+" lba="+M(c)+" lbacount="+M(d)+" bytecount="+M(k),32768);l+k>a.buffer.byteLength?(n(!1,"ATA read: Outside of disk"),a.status=255,a.R()):(a.status=192,hc(a),a.ca(l,k,f=>{t("ata_read: Data arrived",32768);ic(a,f);a.status=88;a.g=e?512:Math.min(k,512*a.K);ec(a,b,e?1:Math.min(d,a.C));a.R();jc(a,k)}))}
function bc(a){var b=37===a.j,c=Wb(a,b);b=Xb(a,b);var d=c*a.o,e=b*a.o;n(b<a.buffer.byteLength);hc(a);var k=a.ma.sc;a.ca(e,d,l=>{t("do_ata_read_sectors_dma: Data arrived",32768);var f=a.ma.sc,p=0;n(k===f);do{var r=a.s.h(f),q=a.s.sa(f+4),u=a.s.Fa(f+7)&128;q||(q=65536,t("dma: prd count was 0",32768));t("dma read transfer dest="+M(r)+" prd_count="+M(q),32768);ua(a.s,l.subarray(p,p+q),r);p+=q;f+=8}while(!u);n(p===d);ec(a,a.j,c);a.status=80;a.ma.qa&=-2;a.j=-1;a.R();jc(a,d)})}
function cc(a){var b=53===a.j,c=Wb(a,b),d=Xb(a,b);b=c*a.o;d*=a.o;var e=a.ma.sc,k=0;t("prdt addr: "+M(e,8),32768);const l=new Uint8Array(b);do{var f=a.s.h(e),p=a.s.sa(e+4),r=a.s.Fa(e+7)&128;p||(p=65536,t("dma: prd count was 0",32768));t("dma write transfer dest="+M(f)+" prd_count="+M(p),32768);f=a.s.Ka.subarray(f,f+p);n(f.length===p);l.set(f,k);k+=p;e+=8}while(!r);n(k===l.length);a.buffer.set(d,l,()=>{t("dma write completed",32768);ec(a,a.j,c);a.status=80;a.R();a.ma.qa&=-2;a.j=-1});fc(a,b)}
function nc(a){var b=a.ja&255|a.la<<8&65280,c=a.head,d=a.va&255;t("get_chs: c="+b+" h="+c+" s="+d,32768);return(b*a.D+c)*a.C+d-1}function mc(a){return a.va&255|a.ja<<8&65280|a.la<<16&16711680|(a.head&15)<<24}function lc(a){return(a.va&255|a.ja<<8&65280|a.la<<16&16711680|a.va>>8<<24&4278190080)>>>0}function Xb(a,b){return b?lc(a):a.Jc?mc(a):nc(a)}function Wb(a,b){b?(a=a.Z,0===a&&(a=65536)):(a=a.Z&255,0===a&&(a=256));return a}
function $b(a){if(a.Tb&16)Zb(a,0);else{for(var b=0;512>b;b++)a.data[b]=0;b=Math.min(16383,a.F);ic(a,[64,a.I?133:0,b,b>>8,0,0,a.D,a.D>>8,a.C/512,a.C/512>>8,0,2,a.C,a.C>>8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,2,4,0,0,0,0,0,0,0,0,0,56,118,32,54,68,72,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,128,0,1,0,0,2,0,0,0,2,0,2,7,0,b,b>>8,a.D,a.D>>8,a.C,0,a.l&255,a.l>>8&255,a.l>>16&255,a.l>>24&255,0,0,a.l&255,a.l>>8&255,a.l>>16&255,
a.l>>24&255,0,0,160===a.j?0:7,160===a.j?0:4,0,0,30,0,30,0,30,0,30,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,0,0,0,0,0,0,116,0,64,0,64,0,116,0,64,0,0,0,0,0,0,0,0,0,0,1,96,0,0,0,0,0,0,0,0,0,0,0,0,a.l&255,a.l>>8&255,a.l>>16&255,a.l>>24&255]);a.h=512;a.g=512}}function Zb(a,b){Yb(a,b);for(var c=0;c<b+3>>2;c++)a.M[c]=0}function Yb(a,b){a.data.length<b&&(a.data=new Uint8Array(b+3&-4),a.U=new Uint16Array(a.data.buffer),a.M=new Int32Array(a.data.buffer));a.h=b;a.i=0}
function ic(a,b){Yb(a,b.length);a.data.set(b)}function hc(a){a.B.zg=!0;a.A.send("ide-read-start")}function jc(a,b){a.B.zg=!1;var c=b/a.o|0;a.B.eh+=c;a.B.bg+=b;a.A.send("ide-read-end",[a.Y,b,c])}function fc(a,b){var c=b/a.o|0;a.B.fh+=c;a.B.cg+=b;a.A.send("ide-write-end",[a.Y,b,c])}m.ca=function(a,b,c){const d=this.pa++;this.P.add(d);this.buffer.get(a,b,e=>{if(this.$.delete(d))n(!this.P.has(d));else{var k=this.P.delete(d);n(k);c(e)}})};
m.W=function(){var a=[];a[0]=this.Z;a[1]=this.F;a[2]=this.la;a[3]=this.ja;a[4]=this.i;a[5]=0;a[6]=0;a[7]=0;a[8]=0;a[9]=this.Tb;a[10]=this.error;a[11]=this.head;a[12]=this.D;a[13]=this.I;a[14]=this.Jc;a[15]=this.pd;a[16]=this.data;a[17]=this.h;a[18]=this.va;a[19]=this.l;a[20]=this.o;a[21]=this.K;a[22]=this.C;a[23]=this.status;a[24]=this.V;a[25]=this.j;a[26]=this.g;a[27]=this.S;a[28]=this.buffer;return a};
m.G=function(a){this.Z=a[0];this.F=a[1];this.la=a[2];this.ja=a[3];this.i=a[4];this.Tb=a[9];this.error=a[10];this.head=a[11];this.D=a[12];this.I=a[13];this.Jc=a[14];this.pd=a[15];this.data=a[16];this.h=a[17];this.va=a[18];this.l=a[19];this.o=a[20];this.K=a[21];this.C=a[22];this.status=a[23];this.V=a[24];this.j=a[25];this.g=a[26];this.S=a[27];this.U=new Uint16Array(this.data.buffer);this.M=new Int32Array(this.data.buffer);this.buffer&&this.buffer.G(a[28])};function oc(a){this.qb=new Uint8Array(4);this.g=new Uint8Array(4);this.vd=new Uint8Array(4);this.wd=new Uint8Array(4);this.Oc=new Int32Array(this.qb.buffer);new Int32Array(this.g.buffer);this.Hf=new Int32Array(this.vd.buffer);this.Jg=new Int32Array(this.wd.buffer);this.Ob=[];this.v=[];this.s=a;for(var b=0;256>b;b++)this.Ob[b]=void 0,this.v[b]=void 0;this.u=a.u;P(a.u,3324,this,function(c){pc(this,this.Oc[0],c)},function(c){qc(this,this.Oc[0],c)},function(c){var d=this.Oc[0];n(0===(d&3));var e=d>>8&
65535;d&=255;var k=this.Ob[e],l=this.v[e];if(k)if(16<=d&&40>d){var f=d-16>>2,p=l.hb[f];t("BAR"+f+" exists="+(p?"y":"n")+" changed to "+M(c>>>0)+" dev="+M(e>>3,2)+" ("+l.name+") ",2048);p?(n(!(p.size&p.size-1),"bar size should be power of 2"),e=d>>2,l=k[e]&1,-1===(c|3|p.size-1)?(c=~(p.size-1)|l,0===l&&(k[e]=c)):0===l&&(f=p.Gg,(c&-16)!==(f&-16)&&t("Warning: Changing memory bar not supported, ignored",2048),k[e]=f),1===l&&(n(1===l),l=k[e]&65534,f=c&65534,t("io bar changed from "+M(l>>>0,8)+" to "+M(f>>>
0,8)+" size="+p.size,2048),rc(this,p,l,f),k[e]=c|1)):k[d>>2]=0;t("BAR effective value: "+M(k[d>>2]>>>0),2048)}else 48===d?(t("PCI write rom address dev="+M(e>>3,2)+" ("+l.name+") value="+M(c>>>0,8),2048),k[d>>2]=l.Ig?-1===(c|2047)?-l.Ig|0:l.si|0:0):4===d?t("PCI write dev="+M(e>>3,2)+" ("+l.name+") addr="+M(d,4)+" value="+M(c>>>0,8),2048):(t("PCI write dev="+M(e>>3,2)+" ("+l.name+") addr="+M(d,4)+" value="+M(c>>>0,8),2048),k[d>>>2]=c)});P(a.u,3325,this,function(c){pc(this,this.Oc[0]+1|0,c)});P(a.u,
3326,this,function(c){pc(this,this.Oc[0]+2|0,c)},function(c){qc(this,this.Oc[0]+2|0,c)});P(a.u,3327,this,function(c){pc(this,this.Oc[0]+3|0,c)});a.u.Ad(3324,this,function(){return this.vd[0]},function(){return this.vd[1]},function(){return this.vd[2]},function(){return this.vd[3]});a.u.Ad(3320,this,function(){return this.wd[0]},function(){return this.wd[1]},function(){return this.wd[2]},function(){return this.wd[3]});a.u.ac(3320,this,function(c){this.qb[0]=c&252},function(c){2===(this.qb[1]&6)&&6===
(c&6)?(t("CPU reboot via PCI"),sc(a)):this.qb[1]=c},function(c){this.qb[2]=c},function(c){this.qb[3]=c;var d=this.qb[2]<<8|this.qb[1],e=this.qb[0]&252,k=d>>3&31;c="query enabled="+(this.qb[3]>>7);c+=" bdf="+M(d,4);c+=" dev="+M(k,2);c+=" addr="+M(e,2);k=this.Ob[d];void 0!==k?(this.Jg[0]=-2147483648,this.Hf[0]=e<k.byteLength?k[e>>2]:0,c+=" "+M(this.Oc[0]>>>0,8)+" -> "+M(this.Hf[0]>>>0,8),e>=k.byteLength&&(c+=" (undef)"),c+=" ("+this.v[d].name+")",t(c,2048)):(this.Hf[0]=-1,this.Jg[0]=0)});ac(this,{La:0,
J:[134,128,55,18,0,0,0,0,2,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0],hb:[],name:"82441FX PMC"});this.i={La:8,J:[134,128,0,112,7,0,0,2,0,0,1,6,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],hb:[],name:"82371SB PIIX3 ISA"};this.j=ac(this,this.i);this.h=new Uint8Array(this.j.buffer)}
oc.prototype.W=function(){for(var a=[],b=0;256>b;b++)a[b]=this.Ob[b];a[256]=this.qb;a[257]=this.g;a[258]=this.vd;a[259]=this.wd;return a};
oc.prototype.G=function(a){for(var b=0;256>b;b++){var c=this.v[b],d=a[b];if(c&&d){for(var e=0;e<c.hb.length;e++){var k=d[4+e];if(k&1){var l=c.hb[e];rc(this,l,l.Gg&65534,k&65534)}}this.Ob[b].set(d)}else c&&t("Warning: While restoring PCI device: Device exists in current configuration but not in snapshot ("+c.name+")"),d&&t("Warning: While restoring PCI device: Device doesn't exist in current configuration but does in snapshot (device "+M(b,2)+")")}this.qb.set(a[256]);this.g.set(a[257]);this.vd.set(a[258]);
this.wd.set(a[259])};function pc(a,b,c){var d=b>>8&65535;b&=255;var e=new Uint8Array(a.Ob[d].buffer);a=a.v[d];e&&(n(!(16<=b&&44>b||48<=b&&52>b),"PCI: Expected 32-bit write, got 8-bit (addr: "+M(b)+")"),t("PCI write8 dev="+M(d>>3,2)+" ("+a.name+") addr="+M(b,4)+" value="+M(c,2),2048),e[b]=c)}
function qc(a,b,c){n(0===(b&1));var d=b>>8&65535;b&=255;var e=new Uint16Array(a.Ob[d].buffer);a=a.v[d];e&&(16<=b&&44>b?t("Warning: PCI: Expected 32-bit write, got 16-bit (addr: "+M(b)+")"):(n(!(48<=b&&52>b),"PCI: Expected 32-bit write, got 16-bit (addr: "+M(b)+")"),t("PCI writ16 dev="+M(d>>3,2)+" ("+a.name+") addr="+M(b,4)+" value="+M(c,4),2048),e[b>>>1]=c))}
function ac(a,b){n(void 0!==b.La);n(void 0!==b.J);n(void 0!==b.hb);var c=b.La;t("PCI register bdf="+M(c)+" ("+b.name+")",2048);n(!a.v[c]);n(64<=b.J.length);n(c<a.v.length);var d=new Int32Array(64);d.set(new Int32Array((new Uint8Array(b.J)).buffer));a.Ob[c]=d;a.v[c]=b;c=d.slice(4,10);for(var e=0;e<b.hb.length;e++){var k=b.hb[e];if(k){var l=c[e],f=l&1;k.Gg=l;k.entries=[];if(0!==f)for(n(1===f),l&=-2,f=0;f<k.size;f++)k.entries[f]=a.u.ports[l+f]}}return d}
function rc(a,b,c,d){var e=b.size;t("Move io bars: from="+M(c)+" to="+M(d)+" count="+e,2048);for(var k=a.u.ports,l=0;l<e;l++){var f=k[c+l];k[c+l]=pb(a.u);f.Fa===a.u.Qe&&f.sa===a.u.Oe&&f.Vc===a.u.Pe&&f.Jd===a.u.ob&&f.Yc===a.u.ob&&f.Eb===a.u.ob&&t("Warning: Bad IO bar: Source not mapped, port="+M(c+l,4),2048);f=b.entries[l];var p=k[d+l];n(f&&p);k[d+l]=f;p.Fa!==a.u.Qe&&p.sa!==a.u.Oe&&p.Vc!==a.u.Pe&&p.Jd!==a.u.ob&&p.Yc!==a.u.ob&&p.Eb!==a.u.ob||t("Warning: Bad IO bar: Target already mapped, port="+M(d+
l,4),2048)}}oc.prototype.Aa=function(a){var b=this.Ob[a];n(b);this.s.Ta(this.h[96+((b[15]>>8&255)-1+((a>>3)-1&255)&3)])};function tc(a,b){var c=a.Ob[b];n(c);Rb(a.s,a.h[96+((c[15]>>8&255)+(b>>3&255)-2&3)])};function uc(a,b){this.u=a.u;this.s=a;this.mb=a.v.mb;this.h=0;this.F=new Uint8Array(10);this.I=0;this.j=null;this.g=new Uint8Array(10);this.l=this.i=0;this.K=b;this.M=this.C=this.U=this.$=this.Y=this.V=0;this.P=1;this.o=0;if(b){var c={[163840]:{type:1,sb:40,rb:8,pb:1},[184320]:{type:1,sb:40,rb:9,pb:1},[204800]:{type:1,sb:40,rb:10,pb:1},[327680]:{type:1,sb:40,rb:8,pb:2},[368640]:{type:1,sb:40,rb:9,pb:2},[409600]:{type:1,sb:40,rb:10,pb:2},[737280]:{type:3,sb:80,rb:9,pb:2},[1228800]:{type:2,sb:80,rb:15,
pb:2},[1474560]:{type:4,sb:80,rb:18,pb:2},[1763328]:{type:5,sb:82,rb:21,pb:2},[2949120]:{type:5,sb:80,rb:36,pb:2},512:{type:1,sb:1,rb:1,pb:1}};let e=b.byteLength;var d=c[e];d||(e=1474560<b.byteLength?2949120:1474560,d=c[e],t("Warning: Unkown floppy size: "+b.byteLength+", assuming "+e));S(a.v.Xc,16,d.type<<4);a=d.rb;b=d.pb;d=d.sb;this.B=a;this.D=b;this.S=d}else S(a.v.Xc,16,64),this.S=this.D=this.B=0;N(this.u,1008,this,this.zj);N(this.u,1010,this,this.Aj);N(this.u,1012,this,this.Cj);N(this.u,1013,
this,this.Dj);N(this.u,1015,this,this.Fj);P(this.u,1010,this,this.Bj);P(this.u,1013,this,this.Ej)}m=uc.prototype;m.W=function(){var a=[];a[0]=this.h;a[1]=this.F;a[2]=this.I;a[4]=this.g;a[5]=this.i;a[6]=this.l;a[8]=this.V;a[9]=this.Y;a[10]=this.$;a[11]=this.U;a[12]=this.C;a[13]=this.M;a[14]=this.P;a[15]=this.o;a[16]=this.B;a[17]=this.D;a[18]=this.S;return a};
m.G=function(a){this.h=a[0];this.F=a[1];this.I=a[2];this.j=a[3];this.g=a[4];this.i=a[5];this.l=a[6];this.V=a[8];this.Y=a[9];this.$=a[10];this.U=a[11];this.C=a[12];this.M=a[13];this.P=a[14];this.o=a[15];this.B=a[16];this.D=a[17];this.S=a[18]};m.zj=function(){t("3F0 read",8192);return 0};m.Cj=function(){t("3F4 read",8192);var a=128;this.i<this.l&&(a|=80);0===(this.o&8)&&(a|=32);return a};m.Fj=function(){t("3F7 read",8192);return 0};
m.Dj=function(){if(this.i<this.l)return t("3F5 read: "+this.g[this.i],8192),Rb(this.s,6),this.g[this.i++];t("3F5 read, empty",8192);return 255};
m.Ej=function(a){if(this.K)if(t("3F5 write "+M(a),8192),0<this.h){if(this.F[this.I++]=a,this.h--,0===this.h){a="3F5 command received: ";for(var b=0;b<this.I;b++)a+=M(this.F[b])+" ";t(a,8192);this.j.call(this,this.F)}}else{switch(a){case 3:this.j=this.ai;this.h=2;break;case 4:this.j=this.Gh;this.h=1;break;case 5:case 197:this.j=function(c){vc(this,!0,c)};this.h=8;break;case 230:this.j=function(c){vc(this,!1,c)};this.h=8;break;case 7:this.j=this.Fh;this.h=1;break;case 8:t("floppy check interrupt status",
8192);this.i=0;this.l=2;this.g[0]=32;this.g[1]=this.C;break;case 74:this.j=this.Tj;this.h=1;break;case 15:this.h=2;this.j=this.wh;break;case 14:t("dump registers",8192);this.g[0]=128;this.i=0;this.l=1;this.h=0;break;default:n(!1,"Unimplemented floppy command call "+M(a))}this.I=0}};m.Aj=function(){t("read 3F2: DOR",8192);return this.o};
m.Bj=function(a){4===(a&4)&&0===(this.o&4)&&this.s.Ta(6);t("start motors: "+M(a>>4),8192);t("enable dma: "+!!(a&8),8192);t("reset fdc: "+!!(a&4),8192);t("drive select: "+(a&3),8192);t("DOR = "+M(a),8192);this.o=a};m.Gh=function(){t("check drive status",8192);this.i=0;this.l=1;this.g[0]=32};m.wh=function(a){t("seek",8192);n(0===(a[0]&3),"Unhandled seek drive");this.C=a[1];this.M=a[0]>>2&1;this.Aa()};m.Fh=function(){t("floppy calibrate",8192);this.Aa()};
function vc(a,b,c){var d=c[2],e=c[1],k=c[3],l=128<<c[4],f=c[5]-c[3]+1,p=((d+a.D*e)*a.B+k-1)*l;t("Floppy "+(b?"Write":"Read"),8192);t("from "+M(p)+" length "+M(f*l),8192);t(e+" / "+d+" / "+k,8192);c[4]||t("FDC: sector count is zero, use data length instead",8192);a.K&&(b?a.mb.ge(a.K,p,f*l,2,a.done.bind(a,c,e,d,k)):wc(a.mb,a.K,p,f*l,a.done.bind(a,c,e,d,k)))}
m.done=function(a,b,c,d,e){e||(d++,d>this.B&&(d=1,c++,c>=this.D&&(c=0,b++)),this.C=b,this.M=c,this.P=d,this.i=0,this.l=7,this.g[0]=c<<2|32,this.g[1]=0,this.g[2]=0,this.g[3]=b,this.g[4]=c,this.g[5]=d,this.g[6]=a[4],this.Aa())};m.ai=function(a){t("floppy fix drive data "+a,8192)};m.Tj=function(a){t("floppy read sector id "+a,8192);this.i=0;this.l=7;this.g[0]=0;this.g[1]=0;this.g[2]=0;this.g[3]=0;this.g[4]=0;this.g[5]=0;this.g[6]=0;this.Aa()};m.Aa=function(){this.o&8&&this.s.Ta(6)};function ua(a,b,c){n(b&&0<=b.length);b.length&&(n(!a.Ye(c)),n(!a.Ye(c+b.length-1)),a.ji(c,c+b.length),a.Ka.set(b,c))};function xc(a){this.s=a;this.o=new Uint8Array(8);this.B=new Uint8Array(8);this.g=new Uint16Array(8);this.j=new Uint16Array(8);this.h=new Uint16Array(8);this.l=new Uint16Array(8);this.ic=new Uint8Array(8);this.C=new Uint8Array(8);this.sf=[];this.i=0;a=a.u;P(a,0,this,this.Qc.bind(this,0));P(a,2,this,this.Qc.bind(this,1));P(a,4,this,this.Qc.bind(this,2));P(a,6,this,this.Qc.bind(this,3));P(a,1,this,this.Sc.bind(this,0));P(a,3,this,this.Sc.bind(this,1));P(a,5,this,this.Sc.bind(this,2));P(a,7,this,this.Sc.bind(this,
3));N(a,0,this,this.Pc.bind(this,0));N(a,2,this,this.Pc.bind(this,1));N(a,4,this,this.Pc.bind(this,2));N(a,6,this,this.Pc.bind(this,3));N(a,1,this,this.Rc.bind(this,0));N(a,3,this,this.Rc.bind(this,1));N(a,5,this,this.Rc.bind(this,2));N(a,7,this,this.Rc.bind(this,3));P(a,192,this,this.Qc.bind(this,4));P(a,196,this,this.Qc.bind(this,5));P(a,200,this,this.Qc.bind(this,6));P(a,204,this,this.Qc.bind(this,7));P(a,194,this,this.Sc.bind(this,4));P(a,198,this,this.Sc.bind(this,5));P(a,202,this,this.Sc.bind(this,
6));P(a,206,this,this.Sc.bind(this,7));N(a,192,this,this.Pc.bind(this,4));N(a,196,this,this.Pc.bind(this,5));N(a,200,this,this.Pc.bind(this,6));N(a,204,this,this.Pc.bind(this,7));N(a,194,this,this.Rc.bind(this,4));N(a,198,this,this.Rc.bind(this,5));N(a,202,this,this.Rc.bind(this,6));N(a,206,this,this.Rc.bind(this,7));P(a,135,this,this.Uc.bind(this,0));P(a,131,this,this.Uc.bind(this,1));P(a,129,this,this.Uc.bind(this,2));P(a,130,this,this.Uc.bind(this,3));P(a,143,this,this.Uc.bind(this,4));P(a,139,
this,this.Uc.bind(this,5));P(a,137,this,this.Uc.bind(this,6));P(a,138,this,this.Uc.bind(this,7));N(a,135,this,this.Tc.bind(this,0));N(a,131,this,this.Tc.bind(this,1));N(a,129,this,this.Tc.bind(this,2));N(a,130,this,this.Tc.bind(this,3));N(a,143,this,this.Tc.bind(this,4));N(a,139,this,this.Tc.bind(this,5));N(a,137,this,this.Tc.bind(this,6));N(a,138,this,this.Tc.bind(this,7));P(a,1159,this,this.zd.bind(this,0));P(a,1155,this,this.zd.bind(this,1));P(a,1153,this,this.zd.bind(this,2));P(a,1154,this,this.zd.bind(this,
3));P(a,1163,this,this.zd.bind(this,5));P(a,1161,this,this.zd.bind(this,6));P(a,1162,this,this.zd.bind(this,7));N(a,1159,this,this.yd.bind(this,0));N(a,1155,this,this.yd.bind(this,1));N(a,1153,this,this.yd.bind(this,2));N(a,1154,this,this.yd.bind(this,3));N(a,1163,this,this.yd.bind(this,5));N(a,1161,this,this.yd.bind(this,6));N(a,1162,this,this.yd.bind(this,7));P(a,10,this,this.Yg.bind(this,0));P(a,212,this,this.Yg.bind(this,4));P(a,15,this,this.Xg.bind(this,0));P(a,222,this,this.Xg.bind(this,4));
N(a,15,this,this.Wg.bind(this,0));N(a,222,this,this.Wg.bind(this,4));P(a,11,this,this.Vg.bind(this,0));P(a,214,this,this.Vg.bind(this,4));P(a,12,this,this.Ug);P(a,216,this,this.Ug)}m=xc.prototype;m.W=function(){return[this.o,this.B,this.g,this.j,this.h,this.l,this.ic,this.C,this.i]};m.G=function(a){this.o=a[0];this.B=a[1];this.g=a[2];this.j=a[3];this.h=a[4];this.l=a[5];this.ic=a[6];this.C=a[7];this.i=a[8]};
m.Sc=function(a,b){t("count write ["+a+"] = "+M(b),16);this.h[a]=yc(this,this.h[a],b,!1);this.l[a]=yc(this,this.l[a],b,!0)};m.Rc=function(a){t("count read ["+a+"] -> "+M(this.h[a]),16);return zc(this,this.h[a])};m.Qc=function(a,b){t("addr write ["+a+"] = "+M(b),16);this.g[a]=yc(this,this.g[a],b,!1);this.j[a]=yc(this,this.j[a],b,!0)};m.Pc=function(a){t("addr read ["+a+"] -> "+M(this.g[a]),16);return zc(this,this.g[a])};m.zd=function(a,b){t("pagehi write ["+a+"] = "+M(b),16);this.B[a]=b};
m.yd=function(a){t("pagehi read ["+a+"]",16);return this.B[a]};m.Uc=function(a,b){t("page write ["+a+"] = "+M(b),16);this.o[a]=b};m.Tc=function(a){t("page read ["+a+"]",16);return this.o[a]};m.Yg=function(a,b){a=(b&3)+a;b=b&4?1:0;t("singlechannel mask write ["+a+"] = "+b,16);Ac(this,a,b)};m.Xg=function(a,b){t("multichannel mask write: "+M(b),16);for(var c=0;4>c;c++)Ac(this,a+c,b&1<<c)};
m.Wg=function(a){var b=0|this.ic[a+0];b|=this.ic[a+1]<<1;b|=this.ic[a+2]<<2;b|=this.ic[a+3]<<3;t("multichannel mask read: "+M(b),16);return b};m.Vg=function(a,b){a=(b&3)+a;t("mode write ["+a+"] = "+M(b),16);this.C[a]=b};m.Ug=function(){t("flipflop reset",16);this.i=0};function Ac(a,b,c){if(a.ic[b]!==c&&(a.ic[b]=c,!c))for(t("firing on_unmask("+b+")",16),c=0;c<a.sf.length;c++)a.sf[c].Ue.call(a.sf[c].Sf,b)}
function wc(a,b,c,d,e){var k=a.h[2]+1,l=Bc(a,2);t("DMA write channel 2",16);t("to "+M(l)+" len "+M(k),16);d<k&&t("DMA should read more than provided: "+M(d)+" "+M(k),16);if(c+k>b.byteLength)t("DMA read outside of buffer",16),e(!0);else{var f=a.s;a.g[2]+=k;b.get(c,k,function(p){ua(f,p,l);e(!1)})}}
m.ge=function(a,b,c,d,e){var k=this.h[d]+1&65535,l=5<=d?2:1,f=k*l,p=Bc(this,d),r=!1,q=!1,u=this.C[d]&16;t("DMA write channel "+d,16);t("to "+M(p)+" len "+M(f),16);c<f?(t("DMA should read more than provided",16),k=Math.floor(c/l),f=k*l,r=!0):c>f&&(t("DMA attempted to read more than provided",16),q=!0);b+f>a.byteLength?(t("DMA write outside of buffer",16),e(!0)):(this.g[d]+=k,this.h[d]-=k,!r&&u&&(t("DMA autoinit",16),this.g[d]=this.j[d],this.h[d]=this.l[d]),a.set(b,this.s.Ka.subarray(p,p+f),()=>{q&&
u?(t("DMA continuing from start",16),this.ge(a,b+f,c-f,d,e)):e(!1)}))};function Bc(a,b){var c=a.g[b];5<=b&&(c<<=1);c=c&65535|a.o[b]<<16;return c|=a.B[b]<<24}function yc(a,b,c,d){d||(a.i^=1);return a.i?b&-256|c:b&-65281|c<<8}function zc(a,b){a.i^=1;return a.i?b&255:b>>8&255};function Cc(a,b){this.s=a;this.A=b;this.j=new Float64Array(3);this.h=new Uint16Array(3);this.g=new Uint8Array(4);this.i=new Uint8Array(4);this.fd=new Uint8Array(4);this.B=new Uint8Array(4);this.l=new Uint8Array(4);this.o=new Uint16Array(3);this.$a=new Uint16Array(3);N(a.u,97,this,function(){var c=yb(),d=66.66666666666667*c&1;c=Dc(this,2,c);return d<<4|c<<5});P(a.u,97,this,function(c){c&1?this.A.send("pcspeaker-enable"):this.A.send("pcspeaker-disable")});N(a.u,64,this,function(){return Ec(this,0)});
N(a.u,65,this,function(){return Ec(this,1)});N(a.u,66,this,function(){return Ec(this,2)});P(a.u,64,this,function(c){Fc(this,0,c)});P(a.u,65,this,function(c){Fc(this,1,c)});P(a.u,66,this,function(c){Fc(this,2,c);this.A.send("pcspeaker-update",[this.fd[2],this.$a[2]])});P(a.u,67,this,this.C)}Cc.prototype.W=function(){var a=[];a[0]=this.g;a[1]=this.i;a[2]=this.fd;a[3]=this.B;a[4]=this.l;a[5]=this.o;a[6]=this.$a;a[7]=this.j;a[8]=this.h;return a};
Cc.prototype.G=function(a){this.g=a[0];this.i=a[1];this.fd=a[2];this.B=a[3];this.l=a[4];this.o=a[5];this.$a=a[6];this.j=a[7];this.h=a[8]};Cc.prototype.Cb=function(a,b){var c=100;b||(this.i[0]&&Dc(this,0,a)?(this.h[0]=Gc(this,0,a),this.j[0]=a,t("pit interrupt. new value: "+this.h[0],512),Rb(this.s,0),this.s.Ta(0),0===this.fd[0]&&(this.i[0]=0)):Rb(this.s,0),this.i[0]&&(c=(this.h[0]-Math.floor(1193.1816666*(a-this.j[0])))/1193.1816666));return c};
function Gc(a,b,c){if(!a.i[b])return 0;var d=c-a.j[b],e=Math.floor(1193.1816666*d);c=a.h[b]-e;t("diff="+d+" dticks="+e+" value="+c+" reload="+a.$a[b],512);a=a.$a[b];c>=a?(t("Warning: Counter"+b+" value "+c+" is larger than reload "+a,512),c%=a):0>c&&(c=c%a+a);return c}function Dc(a,b,c){c-=a.j[b];return 0>c?(t("Warning: PIT timer difference is negative, resetting (timer "+b+")"),!0):a.h[b]<Math.floor(1193.1816666*c)}
function Ec(a,b){var c=a.l[b];if(c)return a.l[b]--,2===c?a.o[b]&255:a.o[b]>>8;c=a.g[b];3===a.fd[b]&&(a.g[b]^=1);a=Gc(a,b,yb());return c?a&255:a>>8}function Fc(a,b,c){a.$a[b]=a.g[b]?a.$a[b]&-256|c:a.$a[b]&255|c<<8;3===a.B[b]&&a.g[b]||(a.$a[b]||(a.$a[b]=65535),a.h[b]=a.$a[b],a.i[b]=!0,a.j[b]=yb(),t("counter"+b+" reload="+M(a.$a[b])+" tick="+(a.$a[b]||65536)/1193.1816666+"ms",512));3===a.B[b]&&(a.g[b]^=1)}
Cc.prototype.C=function(a){var b=a>>1&7,c=a&1,d=a>>6&3;a=a>>4&3;1===d&&t("Unimplemented timer1",512);3===d?t("Unimplemented read back",512):0===a?(this.l[d]=2,b=Gc(this,d,yb()),t("latch: "+b,512),this.o[d]=b?b-1:0):(6<=b&&(b&=-5),t("Control: mode="+b+" ctr="+d+" read_mode="+a+" bcd="+c,512),this.g[d]=1===a?0:1,0===d&&Rb(this.s,0),0!==b&&3!==b&&2!==b&&t("Unimplemented counter mode: "+M(b),512),this.fd[d]=b,this.B[d]=a,2===d&&this.A.send("pcspeaker-update",[this.fd[2],this.$a[2]]))};var Hc=Uint32Array.from([655360,655360,720896,753664]),Ic=Uint32Array.from([131072,65536,32768,32768]);
function Jc(a,b,c){this.s=a;this.A=b;this.da=c;this.F=0;this.Bc=14;this.Ac=15;this.I=80;this.Kb=25;this.De=this.Ha=this.Ud=this.vc=0;this.Nd=[];this.Mc=this.wa=0;this.Gb=new Uint8Array(25);this.D=this.K=this.Lc=this.M=this.h=this.j=this.Ib=this.Jb=this.Ia=0;this.Dc=!0;this.Ea=!1;setTimeout(()=>{b.send("screen-set-mode",this.Ea)},0);this.jb=new Int32Array(256);this.Ra=this.Ga=this.i=0;this.Ma=!1;this.Ba=32;this.Ed=this.wb=0;this.J=[52,18,17,17,3,1,0,0,2,0,0,3,0,0,0,0,8,14680064,57344,224,0,0,0,0,0,
0,191,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,244,26,0,17,0,0,190,254,0,0,0,0,0,0,0,0,0,0,0,0];this.La=144;this.hb=[{size:c}];this.Ig=65536;this.si=4272947200;this.name="vga";this.B={xg:!1,Uj:0,Vj:0,ag:0};this.Za=this.Hb=this.Ya=this.o=0;this.U=255;this.Nb=new Uint8Array(16);this.g=-1;this.cc=32;this.zc=this.eb=this.ed=this.Sa=0;this.pa=-1;this.ec=15;this.Fb=this.hc=0;this.Y=-1;this.vb=this.rc=this.Gc=0;this.Ec=255;this.$=this.S=this.P=this.ub=this.Fc=this.dc=0;this.l=this.od=255;c=a.u;P(c,960,this,this.dj);
N(c,960,this,this.Qg,this.cj);N(c,961,this,this.Rg);P(c,962,this,this.ej);c.ac(964,this,this.gj,this.ij);N(c,964,this,this.fj);N(c,965,this,this.hj);c.ac(974,this,this.tj,this.vj);N(c,974,this,this.sj);N(c,975,this,this.uj);N(c,966,this,this.jj);P(c,966,this,this.kj);P(c,967,this,this.mj);N(c,967,this,this.lj);P(c,968,this,this.oj);N(c,968,this,this.nj);P(c,969,this,this.qj);N(c,969,this,this.pj);N(c,972,this,this.rj);c.ac(980,this,this.xj,this.yj);N(c,980,this,this.wj);N(c,981,this,this.Sg,()=>{t("Warning: 16-bit read from 3D5",
256);return this.Sg()});N(c,970,this,function(){t("3CA read",256);return 0});N(c,986,this,this.Tg);N(c,954,this,this.Tg);this.V=-1;this.cb=0;P(c,462,this,void 0,this.ui);P(c,463,this,void 0,this.wi);N(c,463,this,void 0,this.vi);void 0===this.da||262144>this.da?(this.da=262144,t("vga memory size rounded up to "+this.da,256)):this.da&65535&&(this.da|=65535,this.da++);const d=a.th(this.da);this.Rf=R(Uint8Array,a.Xa,d,this.da);this.de=this.da;this.ce=0;this.fe=this.da;this.ee=0;this.Yb=null;b.register("screen-fill-buffer",
function(){if(this.Ea){if(0===this.Yb.data.byteLength){var k=new Uint8ClampedArray(this.s.Xa.buffer,this.wf,4*this.Ha*this.De);this.Yb=new ImageData(k,this.Ha,this.De);Kc(this)}if(this.Ma){k=0;var l=this.Ra;if(8===this.Ba)for(var f=new Int32Array(this.s.Xa.buffer,this.wf,this.vc*this.Ud),p=new Uint8Array(this.s.Xa.buffer,this.Rf.byteOffset,this.da),r=0;r<f.length;r++){var q=this.jb[p[r]];f[r]=q&65280|q<<16|q>>16|4278190080}else this.s.xh(this.Ba,this.Ed),r=15===this.Ba?2:this.Ba/8,k=((this.s.vh[0]/
r|0)-this.Ed)/this.Ga|0,l=(((this.s.uh[0]/r|0)-this.Ed)/this.Ga|0)+1;k<l&&(k=Math.max(k,0),l=Math.min(l,this.Ra),this.A.send("screen-fill-buffer-end",[{Yb:this.Yb,Nf:0,Of:k,Je:0,Ke:k,uf:this.Ga,tf:l-k}]))}else{k=Math.min(this.ee|15,524287);r=Lc(this);q=~this.Ia&3;l=this.rc&96;f=this.Sa&64;for(p=this.fe&-16;p<=k;){var u=p>>>r;if(q){var A=p/this.Ha|0,v=p-this.Ha*A;switch(q){case 1:u=(A&1)<<13;A>>>=1;break;case 2:u=(A&1)<<14;A>>>=1;break;case 3:u=(A&3)<<13,A>>>=2}u|=(A*this.Ha+v>>>r)+this.wa}A=this.hf[u];
v=this.jf[u];var w=this.kf[u],y=this.lf[u];u=new Uint8Array(8);switch(l){case 0:A<<=0;v<<=1;w<<=2;y<<=3;for(var z=7;0<=z;z--)u[7-z]=A>>z&1|v>>z&2|w>>z&4|y>>z&8;break;case 32:u[0]=A>>6&3|w>>4&12;u[1]=A>>4&3|w>>2&12;u[2]=A>>2&3|w>>0&12;u[3]=A>>0&3|w<<2&12;u[4]=v>>6&3|y>>4&12;u[5]=v>>4&3|y>>2&12;u[6]=v>>2&3|y>>0&12;u[7]=v>>0&3|y<<2&12;break;case 64:case 96:u[0]=A>>4&15,u[1]=A>>0&15,u[2]=v>>4&15,u[3]=v>>0&15,u[4]=w>>4&15,u[5]=w>>0&15,u[6]=y>>4&15,u[7]=y>>0&15}if(f)for(A=z=0;4>z;z++,p++,A+=2)this.Qd[p]=
u[A]<<4|u[A+1];else for(z=0;8>z;z++,p++)this.Qd[p]=u[z]}f=this.de;k=Math.min(this.ce,524287);l=new Int32Array(this.s.Xa.buffer,this.wf,this.Ha*this.De);r=255;q=0;this.Sa&128&&(r&=207,q|=this.zc<<4&48);if(this.Sa&64)for(;f<=k;f++)p=this.Qd[f]&r|q,p=this.jb[p],l[f]=p&65280|p<<16|p>>16|4278190080;else for(r&=63,q|=this.zc<<4&192;f<=k;f++)p=this.Nb[this.Qd[f]&this.ed]&r|q,p=this.jb[p],l[f]=p&65280|p<<16|p>>16|4278190080;this.A.send("screen-fill-buffer-end",this.Nd)}this.de=this.da;this.ce=0;this.fe=this.da;
this.ee=0}Mc(this)},this);this.C=new Uint8Array(262144);this.hf=new Uint8Array(this.C.buffer,0,65536);this.jf=new Uint8Array(this.C.buffer,65536,65536);this.kf=new Uint8Array(this.C.buffer,131072,65536);this.lf=new Uint8Array(this.C.buffer,196608,65536);this.Qd=new Uint8Array(524288);var e=this;qb(c,655360,131072,function(k){return Nc(e,k)},function(k,l){if(e.Ma&&e.Ea&&e.Dc)e.s.Jd((k-655360|e.wb)+3758096384|0,l);else{var f=e.ub>>2&3;k-=Hc[f];if(0>k||k>=Ic[f])t("vga write outside memory space: addr:"+
M(k)+", value:"+M(l),256);else if(e.Ea){var p=l;l=Oc(e.Ec);var r=Pc(e.dc);f=Pc(e.Fc);switch(e.rc&3){case 0:p=(p|p<<8)>>>(e.vb&7)&255;var q=Oc(p);p=Pc(e.dc);q|=f&p;q&=~f|p;q=Qc(e,q,e.i);q=l&q|~l&e.i;break;case 1:q=e.i;break;case 2:q=Pc(p);q=Qc(e,q,e.i);q=l&q|~l&e.i;break;case 3:p=(p|p<<8)>>>(e.vb&7)&255,l&=Oc(p),q=l&r|~l&e.i}l=15;switch(e.hc&12){case 0:l=5<<(k&1);k&=-2;break;case 8:case 12:l=1<<(k&3),k&=-4}l&=e.ec;l&1&&(e.hf[k]=q>>0&255);l&2&&(e.jf[k]=q>>8&255);l&4&&(e.kf[k]=q>>16&255);l&8&&(e.lf[k]=
q>>24&255);l=Rc(e,k);q=l+7;l<e.fe&&(e.fe=l);q>e.ee&&(e.ee=q);l<e.de&&(e.de=l);q>e.ce&&(e.ce=q)}else e.ec&3&&(q=k,f=(q>>1)-e.wa,k=f/e.I|0,f%=e.I,q&1?(r=l,p=e.C[q&-2]):(p=l,r=e.C[q|1]),e.A.send("screen-put-char",[k,f,p,e.jb[e.U&e.Nb[r>>4&15]],e.jb[e.U&e.Nb[r&15]]]),e.C[q]=l)}});ac(a.v.Qa,this)}m=Jc.prototype;
m.W=function(){var a=[];a[0]=this.da;a[1]=this.F;a[2]=this.Bc;a[3]=this.Ac;a[4]=this.I;a[5]=this.Kb;a[6]=this.C;a[7]=this.Za;a[8]=this.wa;a[9]=this.Ea;a[10]=this.jb;a[11]=this.i;a[12]=this.P;a[13]=this.S;a[14]=this.ub;a[15]=this.Ga;a[16]=this.Ra;a[17]=this.Ia;a[18]=this.Ma;a[19]=this.Ba;a[20]=this.wb;a[21]=this.Ed;a[22]=this.o;a[23]=this.Ya;a[24]=this.Hb;a[25]=this.Nb;a[26]=this.pa;a[27]=this.ec;a[28]=this.hc;a[29]=this.Y;a[30]=this.Gc;a[31]=this.rc;a[32]=this.vb;a[33]=this.Ec;a[34]=this.$;a[35]=
this.od;a[36]=this.l;a[37]=this.V;a[38]=this.cb;a[39]=this.Rf;a[40]=this.Dc;a[41]=this.g;a[42]=this.K;a[43]=this.dc;a[44]=this.Fc;a[45]=this.Mc;a[46]=this.Gb;a[47]=this.Jb;a[48]=this.Ib;a[49]=this.j;a[50]=this.h;a[51]=this.M;a[52]=this.Lc;a[53]=this.K;a[54]=this.cc;a[55]=this.Sa;a[56]=this.ed;a[57]=this.eb;a[58]=this.zc;a[59]=this.Fb;a[60]=this.D;a[61]=this.Qd;a[62]=this.U;return a};
m.G=function(a){this.da=a[0];this.F=a[1];this.Bc=a[2];this.Ac=a[3];this.I=a[4];this.Kb=a[5];a[6]&&this.C.set(a[6]);this.Za=a[7];this.wa=a[8];this.Ea=a[9];this.jb=a[10];this.i=a[11];this.P=a[12];this.S=a[13];this.ub=a[14];this.Ga=a[15];this.Ra=a[16];this.Ia=a[17];this.Ma=a[18];this.Ba=a[19];this.wb=a[20];this.Ed=a[21];this.o=a[22];this.Ya=a[23];this.Hb=a[24];this.Nb=a[25];this.pa=a[26];this.ec=a[27];this.hc=a[28];this.Y=a[29];this.Gc=a[30];this.rc=a[31];this.vb=a[32];this.Ec=a[33];this.$=a[34];this.od=
a[35];this.l=a[36];this.V=a[37];this.cb=a[38];this.Rf.set(a[39]);this.Dc=a[40];this.g=a[41];this.K=a[42];this.dc=a[43];this.Fc=a[44];this.Mc=a[45];this.Gb.set(a[46]);this.Jb=a[47];this.Ib=a[48];this.j=a[49];this.h=a[50];this.M=a[51];this.Lc=a[52];this.K=a[53];this.cc=a[54];this.Sa=a[55];this.ed=a[56];this.eb=a[57];this.zc=a[58];this.Fb=a[59];this.D=a[60];a[61]&&this.Qd.set(a[61]);this.U=void 0===a[62]?255:a[62];this.A.send("screen-set-mode",this.Ea);this.Ea?(this.Ud=this.vc=0,this.Ma?(this.Bd(this.Ga,
this.Ra,this.Ba,this.Ga,this.Ra),Kc(this)):(Sc(this),Kc(this),Tc(this))):(this.Cd(this.I,this.Kb),this.Hd(),this.Gd());Uc(this)};
function Nc(a,b){if(a.Ma&&a.Dc)return a.s.Fa((b-655360|a.wb)+3758096384|0);var c=a.ub>>2&3;b-=Hc[c];if(0>b||b>=Ic[c])return t("vga read outside memory space: addr:"+M(b),256),0;a.i=a.hf[b];a.i|=a.jf[b]<<8;a.i|=a.kf[b]<<16;a.i|=a.lf[b]<<24;if(a.rc&8)return c=255,a.S&1&&(c&=a.hf[b]^~(a.P&1?255:0)),a.S&2&&(c&=a.jf[b]^~(a.P&2?255:0)),a.S&4&&(c&=a.kf[b]^~(a.P&4?255:0)),a.S&8&&(c&=a.lf[b]^~(a.P&8?255:0)),c;c=a.Gc;a.Ea?a.hc&8?(c=b&3,b&=-4):a.rc&16&&(c=b&1,b&=-2):c=0;return a.C[c<<16|b]}
function Oc(a){return a|a<<8|a<<16|a<<24}function Pc(a){return(a&1?255:0)|(a&2?255:0)<<8|(a&4?255:0)<<16|(a&8?255:0)<<24}function Qc(a,b,c){switch(a.vb&24){case 8:return b&c;case 16:return b|c;case 24:return b^c}return b}function Vc(a){for(var b=a.wa<<1,c,d,e=0;e<a.Kb;e++)for(var k=0;k<a.I;k++)c=a.C[b],d=a.C[b|1],a.A.send("screen-put-char",[e,k,c,a.jb[a.U&a.Nb[d>>4&15]],a.jb[a.U&a.Nb[d&15]]]),b+=2}
m.Gd=function(){var a=(this.F-this.wa)/this.I|0,b=(this.F-this.wa)%this.I;a=Math.min(this.Kb-1,a);this.A.send("screen-update-cursor",[a,b])};function Uc(a){t("complete redraw",256);a.Ea?a.Ma?a.s.Fg():(a.de=0,a.ce=524288):Vc(a)}function Tc(a){t("complete replot",256);a.Ea&&!a.Ma&&(a.fe=0,a.ee=524288,Uc(a))}m.Da=function(){};function Lc(a){var b=128+(~a.M&a.Ia&64);b-=a.M&64;b-=a.Sa&64;return b>>>6}
function Rc(a,b){var c=Lc(a);if(~a.Ia&3){var d=b-a.wa;d&=a.Ia<<13|-24577;d<<=c;var e=d/a.Ha|0;d%=a.Ha;switch(a.Ia&3){case 2:e=e<<1|b>>13&1;break;case 1:e=e<<1|b>>14&1;break;case 0:e=e<<2|b>>13&3}return e*a.Ha+d+(a.wa<<c)}return b<<c}function Wc(a,b){a.$&128&&(b>>>=1);b=Math.ceil(b/(1+(a.$&31)));a.Ia&1||(b<<=1);a.Ia&2||(b<<=1);return b}m.Cd=function(a,b){this.I=a;this.Kb=b;this.A.send("screen-set-size-text",[a,b])};
m.Bd=function(a,b,c,d,e){if(!this.B.xg||this.B.ag!==c||this.vc!==a||this.Ud!==b||this.Ha!==d||this.De!==e){this.vc=a;this.Ud=b;this.Ha=d;this.De=e;this.B.ag=c;this.B.xg=!0;this.B.Uj=a;this.B.Vj=b;if("undefined"!==typeof ImageData){const k=d*e,l=this.s.sh(k)>>>0;this.wf=l;this.Yb=new ImageData(new Uint8ClampedArray(this.s.Xa.buffer,l,4*k),d,e);this.s.Fg()}this.A.send("screen-set-size-graphical",[a,b,d,e,c])}};
function Sc(a){if(!a.Ma){var b=Math.min(1+a.Jb,a.Ib),c=Math.min(1+a.j,a.h);if(b&&c)if(a.Ea){b<<=3;var d=a.K<<4;a.Sa&64&&(b>>>=1,d>>>=1);var e=a.K<<2;a.M&64?e<<=1:a.Ia&64&&(e>>>=1);a.Bd(b,Wc(a,c),8,d,Math.ceil(Ic[0]/e));Mc(a);Kc(a)}else a.$&128&&(c>>>=1),c=c/(1+(a.$&31))|0,b&&c&&a.Cd(b,c)}}
function Kc(a){a.Ea||Vc(a);if(a.Ma)a.Nd=[];else if(a.Ha&&a.vc)if(!a.cc||a.Fb&32)a.Nd=[],a.A.send("screen-clear");else{var b=a.Mc,c=a.eb;a.Sa&64&&(c>>>=1);var d=a.Lc>>5&3,e=Rc(a,b+d);b=e/a.Ha|0;var k=e%a.Ha+c;e=Wc(a,1+a.D);e=Math.min(e,a.Ud);var l=a.Ud-e;a.Nd=[];k=-k;for(var f=0;k<a.vc;k+=a.Ha,f++)a.Nd.push({Yb:a.Yb,Nf:k,Of:0,Je:0,Ke:b+f,uf:a.Ha,tf:e});b=0;a.Sa&32||(b=Rc(a,d)+c);k=-b;for(f=0;k<a.vc;k+=a.Ha,f++)a.Nd.push({Yb:a.Yb,Nf:k,Of:e,Je:0,Ke:f,uf:a.Ha,tf:l})}}
function Mc(a){a.l|=8;a.Mc!==a.wa&&(a.Mc=a.wa,Kc(a))}m.Hd=function(){this.A.send("screen-update-cursor-scanline",[this.Bc,this.Ac])};
m.dj=function(a){if(-1===this.g)t("attribute controller index register: "+M(a),256),this.g=a&31,t("attribute actual index: "+M(this.g),256),this.cc!==(a&32)&&(this.cc=a&32,Kc(this));else{if(16>this.g)t("internal palette: "+M(this.g)+" -> "+M(a),256),this.Nb[this.g]=a,this.Sa&64||Uc(this);else switch(this.g){case 16:t("3C0 / attribute mode control: "+M(a),256);if(this.Sa!==a){var b=this.Sa;this.Sa=a;var c=0<(a&1);this.Ma||this.Ea===c||(this.Ea=c,this.A.send("screen-set-mode",this.Ea));(b^a)&64&&Tc(this);
Sc(this);Uc(this)}break;case 18:t("3C0 / color plane enable: "+M(a),256);this.ed!==a&&(this.ed=a,Uc(this));break;case 19:t("3C0 / horizontal panning: "+M(a),256);this.eb!==a&&(this.eb=a&15,Kc(this));break;case 20:t("3C0 / color select: "+M(a),256);this.zc!==a&&(this.zc=a,Uc(this));break;default:t("3C0 / attribute controller write "+M(this.g)+": "+M(a),256)}this.g=-1}};m.Qg=function(){t("3C0 read",256);return this.g|this.cc};m.cj=function(){t("3C0 read16",256);return this.Qg()&255|this.Rg()<<8&65280};
m.Rg=function(){if(16>this.g)return t("3C1 / internal palette read: "+M(this.g)+" -> "+M(this.Nb[this.g]),256),this.Nb[this.g]&255;switch(this.g){case 16:return t("3C1 / attribute mode read: "+M(this.Sa),256),this.Sa;case 18:return t("3C1 / color plane enable read: "+M(this.ed),256),this.ed;case 19:return t("3C1 / horizontal panning read: "+M(this.eb),256),this.eb;case 20:return t("3C1 / color select read: "+M(this.zc),256),this.zc;default:t("3C1 / attribute controller read "+M(this.g),256)}return 255};
m.ej=function(a){t("3C2 / miscellaneous output register = "+M(a),256);this.od=a};m.gj=function(a){this.pa=a};m.fj=function(){return this.pa};m.ij=function(a){switch(this.pa){case 1:t("clocking mode: "+M(a),256);var b=this.Fb;this.Fb=a;(b^a)&32&&Kc(this);break;case 2:t("plane write mask: "+M(a),256);this.ec=a;break;case 4:t("sequencer memory mode: "+M(a),256);this.hc=a;break;default:t("3C5 / sequencer write "+M(this.pa)+": "+M(a),256)}};
m.hj=function(){t("3C5 / sequencer read "+M(this.pa),256);switch(this.pa){case 1:return this.Fb;case 2:return this.ec;case 4:return this.hc;case 6:return 18}return 0};m.kj=function(a){this.U=a};m.jj=function(){return this.U};m.mj=function(a){t("3C7 write: "+M(a),256);this.Hb=3*a;this.Za&=0};m.lj=function(){return this.Za};m.oj=function(a){this.Ya=3*a;this.Za|=3};m.nj=function(){return this.Ya/3&255};
m.qj=function(a){var b=this.Ya/3|0,c=this.Ya%3,d=this.jb[b];a=255*(a&63)/63|0;0===c?d=d&-16711681|a<<16:1===c?d=d&-65281|a<<8:(d=d&-256|a,t("dac set color, index="+M(b)+" value="+M(d),256));this.jb[b]!==d&&(this.jb[b]=d,Uc(this));this.Ya++};m.pj=function(){t("3C9 read",256);var a=this.Hb%3,b=this.jb[this.Hb/3|0];this.Hb++;return(b>>8*(2-a)&255)/255*63|0};m.rj=function(){t("3CC read",256);return this.od};m.tj=function(a){this.Y=a};m.sj=function(){return this.Y};
m.vj=function(a){switch(this.Y){case 0:this.dc=a;t("plane set/reset: "+M(a),256);break;case 1:this.Fc=a;t("plane set/reset enable: "+M(a),256);break;case 2:this.P=a;t("color compare: "+M(a),256);break;case 3:this.vb=a;t("plane rotate: "+M(a),256);break;case 4:this.Gc=a;t("plane read: "+M(a),256);break;case 5:var b=this.rc;this.rc=a;t("planar mode: "+M(a),256);(b^a)&96&&Tc(this);break;case 6:t("miscellaneous graphics register: "+M(a),256);this.ub!==a&&(this.ub=a,Sc(this));break;case 7:this.S=a;t("color don't care: "+
M(a),256);break;case 8:this.Ec=a;t("planar bitmap: "+M(a),256);break;default:t("3CF / graphics write "+M(this.Y)+": "+M(a),256)}};m.uj=function(){t("3CF / graphics read "+M(this.Y),256);switch(this.Y){case 0:return this.dc;case 1:return this.Fc;case 2:return this.P;case 3:return this.vb;case 4:return this.Gc;case 5:return this.rc;case 6:return this.ub;case 7:return this.S;case 8:return this.Ec}return 0};m.xj=function(a){t("3D4 / crtc index: "+a,256);this.o=a};
m.wj=function(){t("3D4 read / crtc index: "+this.o,256);return this.o};
m.yj=function(a){switch(this.o){case 1:t("3D5 / hdisp enable end write: "+M(a),256);this.Jb!==a&&(this.Jb=a,Sc(this));break;case 2:this.Ib!==a&&(this.Ib=a,Sc(this));break;case 7:t("3D5 / overflow register write: "+M(a),256);var b=this.j;this.j&=255;this.j=this.j|a<<3&512|a<<7&256;b!=this.j&&Sc(this);this.D=this.D&767|a<<4&256;b=this.h;this.h=this.h&767|a<<5&256;b!==this.h&&Sc(this);Kc(this);break;case 8:t("3D5 / preset row scan write: "+M(a),256);this.Lc=a;Kc(this);break;case 9:t("3D5 / max scan line write: "+
M(a),256);this.$=a;this.D=this.D&511|a<<3&512;b=this.h;this.h=this.h&511|a<<4&512;b!==this.h&&Sc(this);Kc(this);break;case 10:t("3D5 / cursor scanline start write: "+M(a),256);this.Bc=a;this.Hd();break;case 11:t("3D5 / cursor scanline end write: "+M(a),256);this.Ac=a;this.Hd();break;case 12:(this.wa>>8&255)!==a&&(this.wa=this.wa&255|a<<8,Kc(this),~this.Ia&3&&Tc(this));t("3D5 / start addr hi write: "+M(a)+" -> "+M(this.wa,4),256);break;case 13:(this.wa&255)!==a&&(this.wa=this.wa&65280|a,Kc(this),~this.Ia&
3&&Tc(this));t("3D5 / start addr lo write: "+M(a)+" -> "+M(this.wa,4),256);break;case 14:t("3D5 / cursor address hi write: "+M(a),256);this.F=this.F&255|a<<8;this.Gd();break;case 15:t("3D5 / cursor address lo write: "+M(a),256);this.F=this.F&65280|a;this.Gd();break;case 18:t("3D5 / vdisp enable end write: "+M(a),256);(this.j&255)!==a&&(this.j=this.j&768|a,Sc(this));break;case 19:t("3D5 / offset register write: "+M(a),256);this.K!==a&&(this.K=a,Sc(this),~this.Ia&3&&Tc(this));break;case 20:t("3D5 / underline location write: "+
M(a),256);this.M!==a&&(b=this.M,this.M=a,Sc(this),(b^a)&64&&Tc(this));break;case 21:t("3D5 / vertical blank start write: "+M(a),256);(this.h&255)!==a&&(this.h=this.h&768|a,Sc(this));break;case 23:t("3D5 / crtc mode write: "+M(a),256);this.Ia!==a&&(b=this.Ia,this.Ia=a,Sc(this),(b^a)&67&&Tc(this));break;case 24:t("3D5 / line compare write: "+M(a),256);this.D=this.D&768|a;Kc(this);break;default:this.o<this.Gb.length&&(this.Gb[this.o]=a),t("3D5 / CRTC write "+M(this.o)+": "+M(a),256)}};
m.Sg=function(){t("3D5 read "+M(this.o),256);switch(this.o){case 1:return this.Jb;case 2:return this.Ib;case 7:return this.j>>7&2|this.h>>5&8|this.D>>4&16|this.j>>3&64;case 8:return this.Lc;case 9:return this.$;case 10:return this.Bc;case 11:return this.Ac;case 12:return this.wa&255;case 13:return this.wa>>8;case 14:return this.F>>8;case 15:return this.F&255;case 18:return this.j&255;case 19:return this.K;case 20:return this.M;case 21:return this.h&255;case 23:return this.Ia;case 24:return this.D&
255}return this.o<this.Gb.length?this.Gb[this.o]:0};m.Tg=function(){t("3DA read - status 1 and clear attr index",256);var a=this.l;this.Ea?(this.l^=1,this.l&=1):(this.l&1&&(this.l^=8),this.l^=1);this.g=-1;return a};m.ui=function(a){this.V=a};
m.wi=function(a){t("1CF / dispi write "+M(this.V)+": "+M(a),256);switch(this.V){case 1:this.Ga=a;2560<this.Ga&&(t("svga_width reduced from "+this.Ga+" to 2560",256),this.Ga=2560);break;case 2:this.Ra=a;1600<this.Ra&&(t("svga_height reduced from "+this.Ra+" to 1600",256),this.Ra=1600);break;case 3:this.Ba=a;break;case 4:this.Ma=1===(a&1);this.cb=a;break;case 5:t("SVGA bank offset: "+M(a<<16));this.wb=a<<16;break;case 9:const b=a*this.Ga;t("SVGA offset: "+M(b)+" y="+M(a),256);this.Ed!==b&&(this.Ed=
b,Uc(this))}!this.Ma||this.Ga&&this.Ra||(t("SVGA: disabled because of invalid width/height: "+this.Ga+"x"+this.Ra,256),this.Ma=!1);n(4!==this.Ba,"unimplemented svga bpp: 4");n(4===this.Ba||8===this.Ba||15===this.Ba||16===this.Ba||24===this.Ba||32===this.Ba,"unexpected svga bpp: "+this.Ba);t("SVGA: enabled="+this.Ma+", "+this.Ga+"x"+this.Ra+"x"+this.Ba,256);this.Ma&&4===this.V&&(this.Bd(this.Ga,this.Ra,this.Ba,this.Ga,this.Ra),this.A.send("screen-set-mode",!0),this.Dc=this.Ea=!0);this.Ma||(this.wb=
0);Kc(this)};m.vi=function(){t("1CF / dispi read "+M(this.V),256);return Xc(this,this.V)};function Xc(a,b){switch(b){case 0:return 45248;case 1:return a.cb&2?2560:a.Ga;case 2:return a.cb&2?1600:a.Ra;case 3:return a.cb&2?32:a.Ba;case 4:return a.cb;case 5:return a.wb>>>16;case 6:return a.vc?a.vc:1;case 8:return 0;case 10:return a.da/65536|0}return 255};function Yc(a,b){this.s=a;this.A=b;this.Id=this.Cc=!1;this.ne=!0;this.sd=this.$b=this.Zb=0;this.$=!0;this.M=this.K=this.D=this.I=this.P=this.F=this.ie=!1;this.fa=new Lb(1024);this.l=0;this.bb=100;this.tb=this.j=this.h=0;this.Wc=4;this.B=!1;this.g=new Lb(1024);this.C=this.o=!1;this.A.register("keyboard-code",function(c){this.ie&&(t("adding kbd code: "+M(c),64),this.fa.push(c),this.Aa())},this);this.A.register("mouse-click",function(c){this.ne&&this.Id&&(this.sd=c[0]|c[2]<<1|c[1]<<2,this.Cc&&Zc(this,
0,0))},this);this.A.register("mouse-delta",function(c){var d=c[1];if(this.ne&&this.Id){var e=this.Wc*this.bb/80;this.Zb+=c[0]*e;this.$b+=d*e;this.Cc&&(c=this.Zb|0,d=this.$b|0,c||d)&&(this.Zb-=c,this.$b-=d,Zc(this,c,d))}},this);this.A.register("mouse-wheel",function(c){this.tb-=c[0];this.tb-=2*c[1];this.tb=Math.min(7,Math.max(-8,this.tb));Zc(this,0,0)},this);this.i=5;this.Y=0;this.U=this.S=this.V=!1;N(a.u,96,this,this.Mj);N(a.u,100,this,this.Oj);P(a.u,96,this,this.Nj);P(a.u,100,this,this.Pj)}m=Yc.prototype;
m.W=function(){var a=[];a[0]=this.Cc;a[1]=this.Id;a[2]=this.ne;a[3]=this.Zb;a[4]=this.$b;a[5]=this.sd;a[6]=this.$;a[7]=this.ie;a[8]=this.F;a[9]=this.P;a[10]=this.I;a[11]=this.D;a[12]=this.K;a[13]=this.M;a[15]=this.l;a[16]=this.bb;a[17]=this.Wc;a[18]=this.B;a[20]=this.i;a[21]=this.V;a[22]=this.S;a[23]=this.Y;a[24]=this.U;a[25]=this.j;a[26]=this.h;return a};
m.G=function(a){this.Cc=a[0];this.Id=a[1];this.ne=a[2];this.Zb=a[3];this.$b=a[4];this.sd=a[5];this.$=a[6];this.ie=a[7];this.F=a[8];this.P=a[9];this.I=a[10];this.D=a[11];this.K=a[12];this.M=a[13];this.l=a[15];this.bb=a[16];this.Wc=a[17];this.B=a[18];this.i=a[20];this.V=a[21];this.S=a[22];this.Y=a[23];this.U=a[24];this.j=a[25]||0;this.h=a[26]||0;this.C=this.o=!1;this.fa.clear();this.g.clear();this.A.send("mouse-enable",this.Id)};m.Aa=function(){this.o||(this.fa.length?$c(this):this.g.length&&ad(this))};
function ad(a){a.o=!0;a.C=!0;a.i&2&&(t("Mouse irq",64),Rb(a.s,12),a.s.Ta(12))}function $c(a){a.o=!0;a.C=!1;a.i&1&&(t("Keyboard irq",64),Rb(a.s,1),a.s.Ta(1))}function Zc(a,b,c){a.g.push((0>c)<<5|(0>b)<<4|8|a.sd);a.g.push(b);a.g.push(c);4===a.j?(a.g.push(0|a.tb&15),a.tb=0):3===a.j&&(a.g.push(a.tb),a.tb=0);a.Aa()}
m.Mj=function(){this.o=!1;if(!this.fa.length&&!this.g.length)return t("Port 60 read: Empty",64),this.l;this.C?(Rb(this.s,12),this.l=this.g.shift(),t("Port 60 read (mouse): "+M(this.l),64)):(Rb(this.s,1),this.l=this.fa.shift(),t("Port 60 read (kbd)  : "+M(this.l),64));(this.fa.length||this.g.length)&&this.Aa();return this.l};m.Oj=function(){var a=16;this.o&&(a|=1);this.C&&(a|=32);t("port 64 read: "+M(a),64);return a};
m.Nj=function(a){t("port 60 write: "+M(a),64);if(this.S)this.i=a,this.S=!1,t("Keyboard command register = "+M(this.i),64);else if(this.V)this.V=!1,this.g.clear(),this.g.push(a),ad(this);else if(this.P)this.P=!1,this.g.clear(),this.g.push(250),this.bb=a,3===this.j?0===this.h&&200===this.bb?this.h=1:1===this.h&&200===this.bb?this.h=2:2===this.h&&80===this.bb?(this.h=0,this.j=4):this.h=0:0===this.j&&(0===this.h&&200===this.bb?this.h=1:1===this.h&&100===this.bb?this.h=2:2===this.h&&80===this.bb?(this.h=
0,this.j=3):this.h=0),t("mouse sample rate: "+M(a)+", mouse id: "+M(this.j),64),this.bb||(t("invalid sample rate, reset to 100",64),this.bb=100),ad(this);else if(this.M)this.M=!1,this.g.clear(),this.g.push(250),3<a?(this.Wc=4,t("invalid resolution, resetting to 4",64)):(this.Wc=1<<a,t("resolution: "+this.Wc,64)),ad(this);else if(this.I)this.I=!1,this.fa.push(250),$c(this);else if(this.D)this.D=!1,this.fa.push(250),$c(this),a||this.fa.push(2);else if(this.K)this.K=!1,this.fa.push(250),$c(this);else if(this.F){if(this.F=
!1,t("Port 60 data register write: "+M(a),64),this.ne){this.fa.clear();this.g.clear();this.g.push(250);switch(a){case 230:t("Scaling 1:1",64);this.B=!1;break;case 231:t("Scaling 2:1",64);this.B=!0;break;case 232:this.M=!0;break;case 233:Zc(this,0,0);break;case 235:t("unimplemented request single packet",64);Zc(this,0,0);break;case 242:t("required id: "+M(this.j),64);this.g.push(this.j);this.sd=this.Zb=this.$b=0;this.Aa();break;case 243:this.P=!0;break;case 244:this.Id=this.Cc=!0;this.A.send("mouse-enable",
!0);this.sd=this.Zb=this.$b=0;break;case 245:this.Cc=!1;break;case 246:this.Cc=!1;this.bb=100;this.B=!1;this.Wc=4;this.tb=this.j=this.h=0;break;case 255:t("Mouse reset",64);this.g.push(170);this.g.push(0);this.Id=!0;this.A.send("mouse-enable",!0);this.Cc=!1;this.bb=100;this.B=!1;this.Wc=4;this.sd=this.Zb=this.$b=this.tb=this.j=this.h=0;break;default:t("Unimplemented mouse command: "+M(a),64)}ad(this)}}else if(this.U)this.U=!1,this.Y=a;else{t("Port 60 data register write: "+M(a),64);this.g.clear();
this.fa.clear();this.fa.push(250);switch(a){case 237:this.I=!0;break;case 240:this.D=!0;break;case 242:this.fa.push(171);this.fa.push(83);break;case 243:this.K=!0;break;case 244:t("kbd enable scanning",64);this.ie=!0;break;case 245:t("kbd disable scanning",64);this.ie=!1;break;case 246:break;case 255:this.fa.clear();this.fa.push(250);this.fa.push(170);this.fa.push(0);break;default:t("Unimplemented keyboard command: "+M(a),64)}$c(this)}};
m.Pj=function(a){t("port 64 write: "+M(a),64);switch(a){case 32:this.fa.clear();this.g.clear();this.fa.push(this.i);$c(this);break;case 96:this.S=!0;break;case 209:this.U=!0;break;case 211:this.V=!0;break;case 212:this.F=!0;break;case 167:t("Disable second port",64);this.i|=32;break;case 168:t("Enable second port",64);this.i&=-33;break;case 169:this.fa.clear();this.g.clear();this.fa.push(0);$c(this);break;case 170:this.fa.clear();this.g.clear();this.fa.push(85);$c(this);break;case 171:this.fa.clear();
this.g.clear();this.fa.push(0);$c(this);break;case 173:t("Disable Keyboard",64);this.i|=16;break;case 174:t("Enable Keyboard",64);this.i&=-17;break;case 254:t("CPU reboot via PS2");sc(this.s);break;default:t("port 64: Unimplemented command byte: "+M(a),64)}};function bd(a,b){this.i=this.g=this.O=this.C=this.j=0;this.h=-1;this.ha=b;this.D=void 0===this.ha;this.ia=void 0;this.name=this.D?"master":"slave ";this.F=!1;this.I=this.state=0;this.o=1;this.B=this.K=0;this.s=a;this.D?(this.ia=new bd(this.s,this),this.l=function(){if(0<=this.h)Ab(this.s);else{var c=this.g&this.j;if(c){c&=-c;var d=this.K?this.j:-1;this.O&&(this.O&-this.O&d)<=c?t("master> higher prio: isr="+M(this.O,2)+" mask="+M(this.j&255,2)+" irq="+M(c,2),128):(n(0!==c),d=Cb(c),n(c===1<<d),this.h=
d,Ab(this.s))}}},this.Zd=function(){if(-1!==this.h)if(0===this.g)this.h=-1;else{n(this.g);n(0<=this.h);var c=1<<this.h;0===(this.B&c)&&(this.g&=~c);this.o||(this.O|=c);2===this.h?this.ia.Zd():this.s.I(this.C|this.h);this.h=-1;this.l()}}):(this.l=function(){if(0<=this.h)Ab(this.s);else{var c=this.g&this.j;if(c){c&=-c;var d=this.K?this.j:-1;this.O&&(this.O&-this.O&d)<=c||(n(0!==c),d=Cb(c),n(c===1<<d),this.h=d,this.ha.Wd(2))}}},this.Zd=function(){if(-1!==this.h)if(0===this.g)this.h=-1,this.ha.i&=-5,
this.s.I(this.C|7);else{n(this.g);n(0<=this.h);var c=1<<this.h;0===(this.B&c)&&(this.g&=~c);this.o||(this.O|=c);this.ha.i&=-5;this.s.I(this.C|this.h);this.h=-1;this.l()}});this.D?(a=32,b=1232):(a=160,b=1233);P(this.s.u,a,this,this.yi);N(this.s.u,a,this,this.xi);P(this.s.u,a|1,this,this.Ai);N(this.s.u,a|1,this,this.zi);P(this.s.u,b,this,this.Lj);N(this.s.u,b,this,this.Kj);this.D?(this.Wd=function(c){n(0<=c&&16>c);8<=c?this.ia.Wd(c-8):(c=1<<c,0===(this.i&c)&&(this.g|=c,this.i|=c,this.l()))},this.$d=
function(c){n(0<=c&&16>c);8<=c?this.ia.$d(c-8):(c=1<<c,this.i&c&&(this.i&=~c,this.g&=~c,this.l()))}):(this.Wd=function(c){n(0<=c&&8>c);c=1<<c;0===(this.i&c)&&(this.g|=c,this.i|=c,this.l())},this.$d=function(c){n(0<=c&&8>c);c=1<<c;this.i&c&&(this.i&=~c,this.g&=~c,this.l())})}m=bd.prototype;m.W=function(){var a=[];a[0]=this.j;a[1]=this.C;a[2]=this.O;a[3]=this.g;a[4]=this.D;a[5]=this.ia;a[6]=this.F;a[7]=this.state;a[8]=this.I;a[9]=this.o;a[10]=this.B;return a};
m.G=function(a){this.j=a[0];this.C=a[1];this.O=a[2];this.g=a[3];this.D=a[4];this.ia&&this.ia.G(a[5]);this.F=a[6];this.state=a[7];this.I=a[8];this.o=a[9];this.B=a[10]};
m.yi=function(a){if(a&16)t("icw1 = "+M(a),128),this.i=this.j=this.g=this.O=0,this.o=1,this.h=-1,this.F=a&1,this.state=1;else if(a&8)t("ocw3: "+M(a),128),a&2&&(this.I=a&1),a&4&&n(!1,"unimplemented: polling"),a&64&&(this.K=32===(a&32),t("special mask mode: "+this.K,128));else{t("eoi: "+M(a)+" ("+this.name+")",128);var b=a>>5;1===b?(this.O&=this.O-1,t("new isr: "+M(this.O,2),128)):3===b?this.O&=~(1<<(a&7)):192===(a&200)?t("lowest priority: "+M(a&7),128):(t("Unknown eoi: "+M(a),128),n(!1),this.O&=this.O-
1);this.l()}};m.xi=function(){if(this.I)return t("read port 20h (isr): "+M(this.O),128),this.O;t("read port 20h (irr): "+M(this.g),128);return this.g};m.Ai=function(a){0===this.state?this.F?(this.F=!1,this.o=a&2,t("icw4: "+M(a)+" autoeoi="+this.o,128),0===(a&1)&&n(!1,"unimplemented: not 8086 mode")):(this.j=~a,this.l()):1===this.state?(this.C=a,t("interrupts are mapped to "+M(this.C)+" ("+this.name+")",128),this.state++):2===this.state&&(this.state=0,t("icw3: "+M(a),128))};
m.zi=function(){t("21h read "+M(~this.j&255),128);return~this.j&255};m.Kj=function(){t("elcr read: "+M(this.B,2),128);return this.B};m.Lj=function(a){t("elcr write: "+M(a,2),128);this.B=a};function cd(a){this.s=a;this.yc=0;this.jc=new Uint8Array(128);this.D=this.g=Date.now();this.l=this.j=0;this.C=!1;this.B=.9765625;this.o=38;this.h=2;this.Ff=this.i=0;P(a.u,112,this,function(b){this.yc=b&127;this.Ff=b>>7});P(a.u,113,this,this.Jh);N(a.u,113,this,this.Ih)}m=cd.prototype;m.W=function(){var a=[];a[0]=this.yc;a[1]=this.jc;a[2]=this.g;a[3]=this.D;a[4]=this.j;a[5]=this.l;a[6]=this.C;a[7]=this.B;a[8]=this.o;a[9]=this.h;a[10]=this.i;a[11]=this.Ff;return a};
m.G=function(a){this.yc=a[0];this.jc=a[1];this.g=a[2];this.D=a[3];this.j=a[4];this.l=a[5];this.C=a[6];this.B=a[7];this.o=a[8];this.h=a[9];this.i=a[10];this.Ff=a[11]};m.Cb=function(a){a=Date.now();this.g+=a-this.D;this.D=a;this.C&&this.j<a?(this.s.Ta(8),this.i|=192,this.j+=this.B*Math.ceil((a-this.j)/this.B)):this.l&&this.l<a&&(this.s.Ta(8),this.i|=160,this.l=0);let b=100;this.C&&this.j&&(b=Math.min(b,Math.max(0,this.j-a)));this.l&&(b=Math.min(b,Math.max(0,this.l-a)));return b};
function dd(a,b){if(a.h&4)a=b;else{a=b;for(var c=b=0,d;a;)d=a%10,c|=d<<4*b,b++,a=(a-d)/10;a=c}return a}function ed(a,b){if(!(a.h&4)){a=b&15;const c=b>>4&15;n(256>b);n(10>a);n(10>c);b=a+10*c}return b}
m.Ih=function(){var a=this.yc;switch(a){case 0:return dd(this,(new Date(this.g)).getUTCSeconds());case 2:return dd(this,(new Date(this.g)).getUTCMinutes());case 4:return dd(this,(new Date(this.g)).getUTCHours());case 7:return dd(this,(new Date(this.g)).getUTCDate());case 8:return dd(this,(new Date(this.g)).getUTCMonth()+1);case 9:return dd(this,(new Date(this.g)).getUTCFullYear()%100);case 10:return this.o;case 11:return this.h;case 12:return Rb(this.s,8),t("cmos reg C read",65536),a=this.i,this.i&=
-241,a;case 13:return 0;case 50:return dd(this,(new Date(this.g)).getUTCFullYear()/100|0);default:return t("cmos read from index "+M(a),65536),this.jc[this.yc]}};
m.Jh=function(a){switch(this.yc){case 10:this.o=a&127;this.B=1E3/(32768>>(this.o&15)-1);t("Periodic interrupt, a="+M(this.o,2)+" t="+this.B,65536);break;case 11:this.h=a;this.h&64&&(this.j=Date.now());if(this.h&32){a=new Date;const b=ed(this,this.jc[1]),c=ed(this,this.jc[3]),d=ed(this,this.jc[5]),e=new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),d,c,b));t("RTC alarm scheduled for "+e+" hh:mm:ss="+d+":"+c+":"+b+" ms_from_now="+(e-a),65536);this.l=+e}this.h&16&&t("Unimplemented: updated interrupt",
65536);t("cmos b="+M(this.h,2),65536);break;case 1:case 3:case 5:S(this,this.yc,a);break;default:t("cmos write index "+M(this.yc)+": "+M(a),65536)}this.C=64===(this.h&64)&&0<(this.o&15)};function S(a,b,c){t("cmos "+M(b)+" <- "+M(c),65536);n(128>b);a.jc[b]=c};function fd(a,b,c){this.A=c;this.s=a;this.gb=4;this.oc=this.fc=0;this.Nc=96;this.kd=this.zf=0;this.nc=1;this.ba=this.nf=this.df=this.cf=0;this.input=new Lb(4096);this.h=[];switch(b){case 1016:this.g=0;this.ba=4;break;case 760:this.g=1;this.ba=3;break;case 1E3:this.g=2;this.ba=4;break;case 744:this.ba=this.g=3;break;default:t("Invalid serial port: "+M(b),16384),this.g=0,this.ba=4}this.A.register("serial"+this.g+"-input",function(d){t("input: "+M(d),16384);this.input.push(d);this.Nc|=1;this.gb|=4096;
gd(this)},this);a=a.u;P(a,b,this,function(d){hd(this,d)},function(d){hd(this,d&255);hd(this,d>>8)});P(a,b|1,this,function(d){this.oc&128?(this.fc=this.fc&255|d<<8,t("baud rate: "+M(this.fc),16384)):(this.kd=d&15,t("interrupt enable: "+M(d),16384),gd(this))});N(a,b,this,function(){if(this.oc&128)return this.fc&255;var d=this.input.shift();-1===d?t("Read input empty",16384):t("Read input: "+M(d),16384);0===this.input.length&&(this.Nc&=-2,this.gb&=-4097,gd(this));return d});N(a,b|1,this,function(){return this.oc&
128?this.fc>>8:this.kd&15});N(a,b|2,this,function(){var d=this.nc&15|192;t("read interrupt identification: "+M(this.nc),16384);2==this.nc&&(this.gb&=-5,gd(this));return d});P(a,b|2,this,function(d){t("fifo control: "+M(d),16384);this.zf=d});N(a,b|3,this,function(){t("read line control: "+M(this.oc),16384);return this.oc});P(a,b|3,this,function(d){t("line control: "+M(d),16384);this.oc=d});N(a,b|4,this,function(){return this.cf});P(a,b|4,this,function(d){t("modem control: "+M(d),16384);this.cf=d});
N(a,b|5,this,function(){t("read line status: "+M(this.Nc),16384);return this.Nc});P(a,b|5,this,function(){t("Factory test write",16384)});N(a,b|6,this,function(){t("read modem status: "+M(this.df),16384);return this.df});P(a,b|6,this,function(){t("Unkown register write (base+6)",16384)});N(a,b|7,this,function(){return this.nf});P(a,b|7,this,function(d){this.nf=d})}
fd.prototype.W=function(){var a=[];a[0]=this.gb;a[1]=this.fc;a[2]=this.oc;a[3]=this.Nc;a[4]=this.zf;a[5]=this.kd;a[6]=this.nc;a[7]=this.cf;a[8]=this.df;a[9]=this.nf;a[10]=this.ba;return a};fd.prototype.G=function(a){this.gb=a[0];this.fc=a[1];this.oc=a[2];this.Nc=a[3];this.zf=a[4];this.kd=a[5];this.nc=a[6];this.cf=a[7];this.df=a[8];this.nf=a[9];this.ba=a[10]};
function gd(a){a.gb&4096&&a.kd&1?(a.nc=12,a.s.Ta(a.ba)):a.gb&4&&a.kd&2?(a.nc=2,a.s.Ta(a.ba)):a.gb&1&&a.kd&8?(a.nc=0,a.s.Ta(a.ba)):(a.nc=1,Rb(a.s,a.ba))}
function hd(a,b){if(a.oc&128)a.fc=a.fc&-256|b;else if(t("data: "+M(b),16384),a.gb|=4,gd(a),255!==b){var c=String.fromCharCode(b);a.A.send("serial"+a.g+"-output-char",c);a.h.push(b);"\n"===c&&(t("SERIAL: "+String.fromCharCode.apply("",a.h).trimRight().replace(/[\x00-\x08\x0b-\x1f\x7f\x80-\xff]/g,"")),a.A.send("serial"+a.g+"-output-line",String.fromCharCode.apply("",a.h)),a.h=[])}};function id(a){this.s=a;var b=a.u;ac(a.v.Qa,{La:56,J:[134,128,19,113,7,0,128,2,8,0,128,6,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,1,0,0],hb:[],name:"acpi"});this.g=this.h=0;this.status=1;this.te=this.xd=0;this.i=jd(this,yb());this.Xb=new Uint8Array(4);N(b,45056,this,void 0,function(){t("ACPI pm1_status read",262144);return this.xd});P(b,45056,this,void 0,function(c){t("ACPI pm1_status write: "+M(c,4),262144);this.xd&=~c});N(b,45058,this,void 0,
function(){t("ACPI pm1_enable read",262144);return this.te});P(b,45058,this,void 0,function(c){t("ACPI pm1_enable write: "+M(c),262144);this.te=c});N(b,45060,this,void 0,function(){t("ACPI status read",262144);return this.status});P(b,45060,this,void 0,function(c){t("ACPI status write: "+M(c),262144);this.status=c});N(b,45064,this,void 0,void 0,function(){return jd(this,yb())&16777215});N(b,45024,this,function(){t("Read gpe#0",262144);return this.Xb[0]});N(b,45025,this,function(){t("Read gpe#1",262144);
return this.Xb[1]});N(b,45026,this,function(){t("Read gpe#2",262144);return this.Xb[2]});N(b,45027,this,function(){t("Read gpe#3",262144);return this.Xb[3]});P(b,45024,this,function(c){t("Write gpe#0: "+M(c),262144);this.Xb[0]=c});P(b,45025,this,function(c){t("Write gpe#1: "+M(c),262144);this.Xb[1]=c});P(b,45026,this,function(c){t("Write gpe#2: "+M(c),262144);this.Xb[2]=c});P(b,45027,this,function(c){t("Write gpe#3: "+M(c),262144);this.Xb[3]=c})}
id.prototype.Cb=function(a){a=jd(this,a);var b=0!==((a^this.i)&8388608);this.te&1&&b?(t("ACPI raise irq",262144),this.xd|=1,this.s.Ta(9)):Rb(this.s,9);this.i=a;return 100};function jd(a,b){b=Math.round(3579.545*b);b===a.h?3579.545>a.g&&a.g++:(n(b>a.h),a.h+a.g<=b?(a.g=0,a.h=b):t("Warning: Overshot pmtimer, waiting; current="+b+" last="+a.h+" offset="+a.g,262144));return a.h+a.g}id.prototype.W=function(){var a=[];a[0]=this.status;a[1]=this.xd;a[2]=this.te;a[3]=this.Xb;return a};
id.prototype.G=function(a){this.status=a[0];this.xd=a[1];this.te=a[2];this.Xb=a[3]};var kd="Fixed (0);Lowest Prio (1);SMI (2);Reserved (3);NMI (4);INIT (5);Reserved (6);ExtINT (7)".split(";"),ld=["physical","logical"];
function md(a){this.s=a;this.Y=this.pa=0;this.$=1;this.g=this.o=0;this.l=yb();this.M=this.S=this.P=this.U=this.h=65536;this.I=this.F=this.B=0;this.i=new Int32Array(8);this.O=new Int32Array(8);this.j=new Int32Array(8);this.V=254;this.D=-1;this.C=this.error=this.K=0;qb(a.u,4276092928,1048576,b=>{t("Unsupported read8 from apic: "+M(b>>>0),524288);var c=b&3;return this.Vc(b&-4)>>8*c&255},(b,c)=>{t("Unsupported write8 from apic: "+M(b)+" <- "+M(c),524288);t(Error().stack,void 0);n(!1)},b=>this.Vc(b),(b,
c)=>this.Eb(b,c))}m=md.prototype;
m.Vc=function(a){a=a-4276092928|0;switch(a){case 32:return t("APIC read id",524288),this.pa;case 48:return t("APIC read version",524288),327700;case 128:return this.B;case 208:return t("Read local destination",524288),this.K;case 224:return t("Read destination format",524288),this.D;case 240:return this.V;case 256:case 272:case 288:case 304:case 320:case 336:case 352:case 368:return a=a-256>>4,t("Read isr "+a+": "+M(this.O[a]>>>0,8),524288),this.O[a];case 384:case 400:case 416:case 432:case 448:case 464:case 480:case 496:return a=a-
384>>4,t("Read tmr "+a+": "+M(this.j[a]>>>0,8),524288),this.j[a];case 512:case 528:case 544:case 560:case 576:case 592:case 608:case 624:return a=a-512>>4,t("Read irr "+a+": "+M(this.i[a]>>>0,8),524288),this.i[a];case 640:return t("Read error: "+M(this.C>>>0,8),524288),this.C;case 768:return this.F;case 784:return t("APIC read icr1",524288),this.I;case 800:return t("read timer lvt",524288),this.h;case 832:return t("read lvt perf counter",524288),this.U;case 848:return t("read lvt int0",524288),this.P;
case 864:return t("read lvt int1",524288),this.S;case 880:return t("read lvt error",524288),this.M;case 992:return t("read timer divider",524288),this.Y;case 896:return t("read timer initial count",524288),this.o;case 912:return t("read timer current count: "+M(this.g>>>0,8),524288),this.g;default:return t("APIC read "+M(a),524288),n(!1),0}};
m.Eb=function(a,b){a=a-4276092928|0;switch(a){case 48:t("APIC write version: "+M(b>>>0,8)+", ignored",524288);break;case 128:this.B=b&255;nd(this);break;case 176:b=od(this);if(-1!==b){pd(this.O,b);if(qd(this.j,b)){a=this.s.v.Ic;for(var c=0;24>c;c++){var d=a.g[c];(d&255)===b&&d&16384&&(t("Clear remote IRR for irq="+M(c),524288),a.g[c]&=-16385,sd(a,c))}}nd(this)}else t("Bad eoi: No isr set",524288);break;case 208:t("Set local destination: "+M(b>>>0,8),524288);this.K=b&4278190080;break;case 224:t("Set destination format: "+
M(b>>>0,8),524288);this.D=b|16777215;break;case 240:t("Set spurious vector: "+M(b>>>0,8),524288);this.V=b;break;case 640:t("Write error: "+M(b>>>0,8),524288);this.C=this.error;this.error=0;break;case 768:a=b&255;c=b>>8&7;d=b>>11&1;var e=b>>15&1,k=b>>18&3;t("APIC write icr0: "+M(b,8)+" vector="+M(a,2)+" destination_mode="+ld[d]+" delivery_mode="+kd[c]+" destination_shorthand="+["no","self","all with self","all without self"][k],524288);this.F=b&-4097;0===k?td(this,a,c,e):1===k?td(this,a,0,e):2===k?
td(this,a,c,e):3!==k&&n(!1);break;case 784:t("APIC write icr1: "+M(b>>>0,8),524288);this.I=b;break;case 800:t("timer lvt: "+M(b>>>0,8),524288);this.h=b;break;case 832:t("lvt perf counter: "+M(b>>>0,8),524288);this.U=b;break;case 848:t("lvt int0: "+M(b>>>0,8),524288);this.P=b;break;case 864:t("lvt int1: "+M(b>>>0,8),524288);this.S=b;break;case 880:t("lvt error: "+M(b>>>0,8),524288);this.M=b;break;case 992:t("timer divider: "+M(b>>>0,8),524288);this.Y=b;b=b&3|(b&8)>>1;this.$=7===b?0:b+1;break;case 896:t("timer initial: "+
M(b>>>0,8),524288);this.o=b>>>0;this.g=b>>>0;this.l=yb();break;case 912:t("timer current: "+M(b>>>0,8),524288);n(!1,"read-only register");break;default:t("APIC write32 "+M(a)+" <- "+M(b>>>0,8),524288),n(!1)}};
m.Cb=function(a){if(0===this.g)return 100;const b=1E6/(1<<this.$);a=(a-this.l)*b>>>0;this.l+=a/b;this.g-=a;0>=this.g&&(a=this.h&393216,131072===a?(this.g%=this.o,0>=this.g&&(this.g+=this.o),n(0!==this.g),0===(this.h&65536)&&td(this,this.h&255,0,!1)):0===a&&(this.g=0,t("APIC timer one shot end",524288),0===(this.h&65536)&&td(this,this.h&255,0,!1)));return Math.max(0,this.g/b)};
function td(a,b,c,d){5!==c&&4!==c&&((16>b||255===b)&&n(!1,"TODO: Invalid vector"),qd(a.i,b)?t("Not delivered: irr already set, vector="+M(b,2),524288):(ud(a.i,b),d?ud(a.j,b):pd(a.j,b),nd(a)))}function vd(a){a=wd(a.i);n(255!==a);n(16<=a||-1===a);return a}function od(a){a=wd(a.O);n(255!==a);n(16<=a||-1===a);return a}function nd(a){var b=vd(a);-1!==b&&(od(a)>=b||(b&240)<=(a.B&240)||Ab(a.s))}
m.Zd=function(){var a=vd(this);-1===a||od(this)>=a||(a&240)<=(this.B&240)||(pd(this.i,a),ud(this.O,a),this.s.I(a),nd(this))};m.W=function(){var a=[];a[0]=this.pa;a[1]=this.Y;a[2]=this.$;a[3]=this.o;a[4]=this.g;a[5]=this.l;a[6]=this.h;a[7]=this.U;a[8]=this.P;a[9]=this.S;a[10]=this.M;a[11]=this.B;a[12]=this.F;a[13]=this.I;a[14]=this.i;a[15]=this.O;a[16]=this.j;a[17]=this.V;a[18]=this.D;a[19]=this.K;a[20]=this.error;a[21]=this.C;return a};
m.G=function(a){this.pa=a[0];this.Y=a[1];this.$=a[2];this.o=a[3];this.g=a[4];this.l=a[5];this.h=a[6];this.U=a[7];this.P=a[8];this.S=a[9];this.M=a[10];this.B=a[11];this.F=a[12];this.I=a[13];this.i=a[14];this.O=a[15];this.j=a[16];this.V=a[17];this.D=a[18];this.K=a[19];this.error=a[20];this.C=a[21]};function qd(a,b){n(0<=b&&256>b);return a[b>>5]>>(b&31)&1}function ud(a,b){n(0<=b&&256>b);a[b>>5]|=1<<(b&31)}function pd(a,b){n(0<=b&&256>b);a[b>>5]&=~(1<<(b&31))}
function wd(a){for(var b=7;0<=b;b--){var c=a[b];if(c)return Db(c>>>0)|b<<5}return-1};function xd(a){this.s=a;this.g=new Int32Array(24);this.o=new Int32Array(24);for(var b=0;b<this.g.length;b++)this.g[b]=65536;this.i=this.h=this.l=this.j=0;n(!0);qb(a.u,4273995776,131072,c=>{c=c-4273995776|0;if(16<=c&&20>c)return c-=16,t("ioapic read8 byte "+c+" "+M(this.j),524288),this.read(this.j)>>8*c&255;t("Unexpected IOAPIC register read: "+M(c>>>0),524288);n(!1);return 0},c=>{n(!1,"unsupported write8 from ioapic: "+M(c>>>0))},c=>{c=c-4273995776|0;if(0===c)return this.j;if(16===c)return this.read(this.j);
t("Unexpected IOAPIC register read: "+M(c>>>0),524288);n(!1);return 0},(c,d)=>{c=c-4273995776|0;0===c?this.j=d:16===c?this.write(this.j,d):(t("Unexpected IOAPIC register write: "+M(c>>>0)+" <- "+M(d>>>0,8),524288),n(!1))})}
function sd(a,b){var c=1<<b;if(0!==(a.h&c)){var d=a.g[b];if(0===(d&65536)){var e=d>>8&7,k=d&255,l=32768===(d&32768);if(0===(d&32768))a.h&=~c;else if(a.g[b]|=16384,d&16384){t("No route: level interrupt and remote IRR still set",524288);return}0===e||1===e?td(a.s.v.Zc,k,e,l):n(!1,"TODO");a.g[b]&=-4097}}}m=xd.prototype;m.Wd=function(a){if(24<=a)n(!1,"Bad irq: "+a);else{var b=1<<a;0===(this.i&b)&&(this.i|=b,65536!==(this.g[a]&98304)&&(this.h|=b,sd(this,a)))}};
m.$d=function(a){if(24<=a)n(!1,"Bad irq: "+a);else{var b=1<<a;(this.i&b)===b&&(this.i&=~b,this.g[a]&32768&&(this.h&=~b))}};
m.read=function(a){if(0===a)return t("IOAPIC Read id",524288),this.l<<24;if(1===a)return t("IOAPIC Read version",524288),1507345;if(2===a)return t("IOAPIC Read arbitration id",524288),this.l<<24;if(16<=a&&64>a){var b=a-16>>1;a&1?(a=this.o[b],t("IOAPIC Read destination irq="+M(b)+" -> "+M(a,8),524288)):(a=this.g[b],t("IOAPIC Read config irq="+M(b)+" -> "+M(a,8),524288));return a}t("IOAPIC register read outside of range "+M(a),524288);n(!1);return 0};
m.write=function(a,b){if(0===a)this.l=b>>>24&15;else if(1===a||2===a)t("Invalid write: "+a,524288);else if(16<=a&&64>a){var c=a-16>>1;if(a&1)this.o[c]=b&4278190080,t("Write destination "+M(b>>>0,8)+" irq="+M(c)+" dest="+M(b>>>24,2),524288);else{this.g[c]=b&110591|this.g[c]&-110592;a=b&255;var d=b>>8&7,e=b>>11&1,k=b>>15&1,l=b>>16&1;t("Write config "+M(b>>>0,8)+" irq="+M(c)+" vector="+M(a,2)+" deliverymode="+kd[d]+" destmode="+ld[e]+" is_level="+k+" disabled="+l,524288);sd(this,c)}}else t("IOAPIC register write outside of range "+
M(a)+": "+M(b>>>0,8),524288),n(!1)};m.W=function(){var a=[];a[0]=this.g;a[1]=this.o;a[2]=this.j;a[3]=this.l;a[4]=this.h;a[5]=this.i;return a};m.G=function(a){this.g=a[0];this.o=a[1];this.j=a[2];this.l=a[3];this.h=a[4];this.i=a[5]};function yd(a){this.message=a}yd.prototype=Error();const zd={Uint8Array,Int8Array,Uint16Array,Int16Array,Uint32Array,Int32Array,Float32Array,Float64Array};
function Ad(a,b){if("object"!==typeof a||null===a)return n("function"!==typeof a),a;if(a instanceof Array)return a.map(k=>Ad(k,b));a.constructor===Object&&(console.log(a),n(a.constructor!==Object,"Expected non-object"));if(a.BYTES_PER_ELEMENT){var c=new Uint8Array(a.buffer,a.byteOffset,a.length*a.BYTES_PER_ELEMENT);a=a.constructor.name.replace("bound ","");n(zd[a]);return{__state_type__:a,buffer_id:b.push(c)-1}}a.W||console.log("Object without get_state: ",a);c=a.W();a=[];for(var d=0;d<c.length;d++){var e=
c[d];n("function"!==typeof e);a[d]=Ad(e,b)}return a}function Bd(a,b){if("object"!==typeof a||null===a)return n("function"!==typeof a),a;if(a instanceof Array){for(var c=0;c<a.length;c++)a[c]=Bd(a[c],b);return a}c=a.__state_type__;n(void 0!==c);const d=zd[c];n(d,"Unkown type: "+c);return new d(b[a.buffer_id])}
ub.prototype.xe=function(){for(var a=[],b=Ad(this,a),c=[],d=0,e=0;e<a.length;e++){var k=a[e].byteLength;c[e]={offset:d,length:k};d+=k;d=d+3&-4}b=JSON.stringify({buffer_infos:c,state:b});b=(new TextEncoder).encode(b);e=16+b.length;e=e+3&-4;var l=e+d;d=new ArrayBuffer(l);var f=new Int32Array(d,0,4);(new Uint8Array(d,16,b.length)).set(b);k=new Uint8Array(d,e);f[0]=-2039052682;f[1]=6;f[2]=l;f[3]=b.length;for(e=0;e<a.length;e++)l=a[e],n(l.constructor===Uint8Array),k.set(l,c[e].offset);t("State: json size "+
(b.byteLength>>10)+"k");t("State: Total buffers size "+(k.byteLength>>10)+"k");return d};
ub.prototype.Sd=function(a){function b(A,v){const w=A.length;if(16>w)throw new yd("Invalid length: "+w);A=new Int32Array(A.buffer,A.byteOffset,4);if(-2039052682!==A[0])throw new yd("Invalid header: "+M(A[0]>>>0));if(6!==A[1])throw new yd("Version mismatch: dump="+A[1]+" we=6");if(v&&A[2]!==w)throw new yd("Length doesn't match header: real="+w+" header="+A[2]);return A[3]}function c(A){A=(new TextDecoder).decode(A);return JSON.parse(A)}a=new Uint8Array(a);if(4247762216===(new Uint32Array(a.buffer,
0,1))[0]){var d=this.lk(a.length);(new Uint8Array(this.Xa.buffer,this.nk(d),a.length)).set(a);var e=this.Fe(d,16),k=new Uint8Array(this.Xa.buffer,e,16),l=b(k,!1);this.Ge(e,16);e=this.Fe(d,l);k=new Uint8Array(this.Xa.buffer,e,l);k=c(k);this.Ge(e,l);e=k.state;var f=k.buffer_infos;k=[];l=16+l;for(var p of f){f=(l+3&-4)-l;if(1048576<p.length){var r=this.Fe(d,f);this.Ge(r,f);r=new Uint8Array(p.length);k.push(r.buffer);for(var q=0;q<p.length;){var u=p.length-q;n(0<=u);u=Math.min(u,1048576);const A=this.Fe(d,
u);r.set(new Uint8Array(this.Xa.buffer,A,u),q);this.Ge(A,u);q+=u}}else r=this.Fe(d,f+p.length),q=r+f,k.push(this.Xa.buffer.slice(q,q+p.length)),this.Ge(r,f+p.length);l+=f+p.length}e=Bd(e,k);this.G(e);this.mk(d)}else{p=b(a,!0);if(0>p||p+12>=a.length)throw new yd("Invalid info block length: "+p);e=c(a.subarray(16,16+p));d=e.state;e=e.buffer_infos;let A=16+p;A=A+3&-4;p=e.map(v=>{const w=A+v.offset;return a.buffer.slice(w,w+v.length)});d=Bd(d,p);this.G(d)}};function Cd(a,b,c){this.s=a;this.Qa=a.v.Qa;this.tc=c;this.A=b;this.A.register("net0-receive",function(d){if(!(this.ya&1)&&(this.A.send("eth-receive-end",[d.length]),this.Td&16||this.Td&4&&255===d[0]&&255===d[1]&&255===d[2]&&255===d[3]&&255===d[4]&&255===d[5]||!(this.Td&8&&1===(d[0]&1)||d[0]!==this.ga[0]||d[1]!==this.ga[1]||d[2]!==this.ga[2]||d[3]!==this.ga[3]||d[4]!==this.ga[4]||d[5]!==this.ga[5]))){var e=this.lb<<8,k=Math.max(60,d.length)+4,l=e+4,f=this.lb+1+(k>>8),p=e+k,r=1+(k>>8),q=this.Lb>this.lb?
this.Lb-this.lb:this.Va-this.lb+this.Lb-this.Ab;q<r&&0!==this.Lb?t("Buffer full, dropping packet pstart="+M(this.Ab)+" pstop="+M(this.Va)+" curpg="+M(this.lb)+" needed="+M(r)+" boundary="+M(this.Lb)+" available="+M(q),1048576):(p>this.Va<<8?(n(60<=d.length),p=(this.Va<<8)-l,n(0<=p),this.memory.set(d.subarray(0,p),l),this.memory.set(d.subarray(p),this.Ab<<8),t("rcv cut="+M(p),1048576)):(this.memory.set(d,l),60>d.length&&this.memory.fill(0,l+d.length,l+60)),f>=this.Va&&(f+=this.Ab-this.Va),this.memory[e]=
1,this.memory[e+1]=f,this.memory[e+2]=k,this.memory[e+3]=k>>8,this.lb=f,t("rcv offset="+M(e)+" len="+M(k)+" next="+M(f),1048576),Dd(this,1))}},this);this.port=768;this.name="ne2k";this.J=[236,16,41,128,3,1,0,0,0,0,0,2,0,0,0,0,this.port&255|1,this.port>>8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,244,26,0,17,0,0,184,254,0,0,0,0,0,0,0,0,0,1,0,0];this.La=40;this.hb=[{size:32}];this.Xe=this.O=0;this.ya=1;this.qf=this.Fd=this.Bb=this.be=0;this.memory=new Uint8Array(32768);this.rf=this.Td=0;this.Tf=
1;this.ga=new Uint8Array([0,34,21,255*Math.random()|0,255*Math.random()|0,255*Math.random()|0]);for(b=0;6>b;b++)this.memory[b<<1]=this.memory[b<<1|1]=this.ga[b];this.memory[28]=this.memory[29]=87;this.memory[30]=this.memory[31]=87;t("Mac: "+M(this.ga[0],2)+":"+M(this.ga[1],2)+":"+M(this.ga[2],2)+":"+M(this.ga[3],2)+":"+M(this.ga[4],2)+":"+M(this.ga[5],2),1048576);this.ta=0;this.Ab=64;this.Va=128;this.Lb=this.lb=76;b=a.u;N(b,this.port|0,this,function(){t("Read cmd",1048576);return this.ya});P(b,this.port|
0,this,function(d){this.ya=d;t("Write command: "+M(d,2)+" newpg="+(this.ya>>6)+" txcr="+M(this.rf,2),1048576);this.ya&1||(d&24&&0===this.Bb&&Dd(this,64),d&4&&(d=this.qf<<8,d=this.memory.subarray(d,d+this.Fd),this.A.send("net0-send",d),this.A.send("eth-transmit-end",[d.length]),this.ya&=-5,Dd(this,2),t("Command: Transfer. length="+M(d.byteLength),1048576)))});N(b,this.port|13,this,function(){t("Read counter0",1048576);return 0});N(b,this.port|14,this,function(){t("Read counter1",1048576);return 0});
N(b,this.port|15,this,function(){t("Read counter2",1048576);return 0});N(b,this.port|31,this,function(){var d=T(this);0===d?(t("Read reset",1048576),Dd(this,128)):(t("Read pg"+d+"/1f",1048576),n(!1));return 0});P(b,this.port|31,this,function(d){var e=T(this);0===e?t("Write reset: "+M(d,2),1048576):(t("Write pg"+e+"/1f: "+M(d),1048576),n(!1))});N(b,this.port|1,this,function(){var d=T(this);if(0===d)return this.Ab;if(1===d)return t("Read pg1/01 (mac[0])",1048576),this.ga[0];if(2===d)return this.Ab;
t("Read pg"+d+"/01");n(!1);return 0});P(b,this.port|1,this,function(d){var e=T(this);0===e?(t("start page: "+M(d,2),1048576),this.Ab=d):1===e?(t("mac[0] = "+M(d),1048576),this.ga[0]=d):3===e?t("Unimplemented: Write pg3/01 (9346CR): "+M(d),1048576):(t("Write pg"+e+"/01: "+M(d),1048576),n(!1))});N(b,this.port|2,this,function(){var d=T(this);if(0===d)return this.Va;if(1===d)return t("Read pg1/02 (mac[1])",1048576),this.ga[1];if(2===d)return this.Va;t("Read pg"+d+"/02",1048576);n(!1);return 0});P(b,this.port|
2,this,function(d){var e=T(this);0===e?(t("stop page: "+M(d,2),1048576),d>this.memory.length>>8&&(d=this.memory.length>>8,t("XXX: Adjusting stop page to "+M(d),1048576)),this.Va=d):1===e?(t("mac[1] = "+M(d),1048576),this.ga[1]=d):(t("Write pg"+e+"/02: "+M(d),1048576),n(!1))});N(b,this.port|7,this,function(){var d=T(this);if(0===d)return t("Read isr: "+M(this.O,2),1048576),this.O;if(1===d)return t("Read curpg: "+M(this.lb,2),1048576),this.lb;n(!1)});P(b,this.port|7,this,function(d){var e=T(this);0===
e?(t("Write isr: "+M(d,2),1048576),this.O&=~d,Ed(this)):1===e?(t("Write curpg: "+M(d,2),1048576),this.lb=d):n(!1)});P(b,this.port|13,this,function(d){var e=T(this);0===e?(this.rf=d,t("Write tx config: "+M(d,2),1048576)):t("Unimplemented: Write pg"+e+"/0d "+M(d,2),1048576)});P(b,this.port|14,this,function(d){var e=T(this);0===e?(t("Write data configuration: "+M(d,2),1048576),this.be=d):t("Unimplemented: Write pg"+e+"/0e "+M(d,2),1048576)});N(b,this.port|10,this,function(){if(0===T(this))return t("Read pg0/0a",
1048576),80;n(!1,"TODO");return 0});P(b,this.port|10,this,function(d){var e=T(this);0===e?(t("Write remote byte count low: "+M(d,2),1048576),this.Bb=this.Bb&65280|d&255):t("Unimplemented: Write pg"+e+"/0a "+M(d,2),1048576)});N(b,this.port|11,this,function(){if(0===T(this))return t("Read pg0/0b",1048576),67;n(!1,"TODO");return 0});P(b,this.port|11,this,function(d){var e=T(this);0===e?(t("Write remote byte count high: "+M(d,2),1048576),this.Bb=this.Bb&255|d<<8&65280):t("Unimplemented: Write pg"+e+"/0b "+
M(d,2),1048576)});N(b,this.port|8,this,function(){var d=T(this);if(0===d)return t("Read remote start address low",1048576),this.ta&255;t("Unimplemented: Read pg"+d+"/08",1048576);n(!1)});P(b,this.port|8,this,function(d){var e=T(this);0===e?(t("Write remote start address low: "+M(d,2),1048576),this.ta=this.ta&65280|d&255):t("Unimplemented: Write pg"+e+"/08 "+M(d,2),1048576)});N(b,this.port|9,this,function(){var d=T(this);if(0===d)return t("Read remote start address high",1048576),this.ta>>8&255;t("Unimplemented: Read pg"+
d+"/09",1048576);n(!1)});P(b,this.port|9,this,function(d){var e=T(this);0===e?(t("Write remote start address low: "+M(d,2),1048576),this.ta=this.ta&255|d<<8&65280):t("Unimplemented: Write pg"+e+"/09 "+M(d,2),1048576)});P(b,this.port|15,this,function(d){var e=T(this);0===e?(t("Write interrupt mask register: "+M(d,2)+" isr="+M(this.O,2),1048576),this.Xe=d,Ed(this)):t("Unimplemented: Write pg"+e+"/0f "+M(d,2),1048576)});N(b,this.port|3,this,function(){var d=T(this);if(0===d)return t("Read boundary: "+
M(this.Lb,2),1048576),this.Lb;if(1===d)return t("Read pg1/03 (mac[2])",1048576),this.ga[2];3===d?t("Unimplemented: Read pg3/03 (CONFIG0)",1048576):(t("Read pg"+d+"/03",1048576),n(!1));return 0});P(b,this.port|3,this,function(d){var e=T(this);0===e?(t("Write boundary: "+M(d,2),1048576),this.Lb=d):1===e?(t("mac[2] = "+M(d),1048576),this.ga[2]=d):(t("Write pg"+e+"/03: "+M(d),1048576),n(!1))});N(b,this.port|4,this,function(){var d=T(this);if(0===d)return this.Tf;if(1===d)return t("Read pg1/04 (mac[3])",
1048576),this.ga[3];t("Read pg"+d+"/04",1048576);n(!1);return 0});P(b,this.port|4,this,function(d){var e=T(this);0===e?(t("Write tpsr: "+M(d,2),1048576),this.qf=d):1===e?(t("mac[3] = "+M(d),1048576),this.ga[3]=d):(t("Write pg"+e+"/04: "+M(d),1048576),n(!1))});N(b,this.port|5,this,function(){var d=T(this);if(0===d)return t("Unimplemented: Read pg0/05 (NCR: Number of Collisions Register)",1048576),0;if(1===d)return t("Read pg1/05 (mac[4])",1048576),this.ga[4];3===d?t("Unimplemented: Read pg3/05 (CONFIG2)",
1048576):(t("Read pg"+d+"/05",1048576),n(!1));return 0});P(b,this.port|5,this,function(d){var e=T(this);0===e?(t("Write tcnt low: "+M(d,2),1048576),this.Fd=this.Fd&-256|d):1===e?(t("mac[4] = "+M(d),1048576),this.ga[4]=d):3===e?t("Unimplemented: Write pg3/05 (CONFIG2): "+M(d),1048576):(t("Write pg"+e+"/05: "+M(d),1048576),n(!1))});N(b,this.port|6,this,function(){var d=T(this);if(0===d)return n(!1,"TODO"),0;if(1===d)return t("Read pg1/06 (mac[5])",1048576),this.ga[5];3===d?t("Unimplemented: Read pg3/06 (CONFIG3)",
1048576):(t("Read pg"+d+"/06",1048576),n(!1));return 0});P(b,this.port|6,this,function(d){var e=T(this);0===e?(t("Write tcnt high: "+M(d,2),1048576),this.Fd=this.Fd&255|d<<8):1===e?(t("mac[5] = "+M(d),1048576),this.ga[5]=d):3===e?t("Unimplemented: Write pg3/06 (CONFIG3): "+M(d),1048576):(t("Write pg"+e+"/06: "+M(d),1048576),n(!1))});N(b,this.port|12,this,function(){var d=T(this);if(0===d)return 9;t("Unimplemented: Read pg"+d+"/0c",1048576);n(!1);return 0});P(b,this.port|12,this,function(d){var e=
T(this);0===e?(t("RX configuration reg write: "+M(d,2),1048576),this.Td=d):t("Unimplemented: Write pg"+e+"/0c: "+M(d),1048576)});N(b,this.port|16,this,this.Lh,this.fg,this.Kh);P(b,this.port|16,this,this.gg,this.gg,this.Mh);ac(a.v.Qa,this)}m=Cd.prototype;
m.W=function(){var a=[];a[0]=this.O;a[1]=this.Xe;a[2]=this.ya;a[3]=this.be;a[4]=this.Bb;a[5]=this.Fd;a[6]=this.qf;a[7]=this.ta;a[8]=this.Ab;a[9]=this.lb;a[10]=this.Lb;a[11]=this.Va;a[12]=this.Td;a[13]=this.rf;a[14]=this.Tf;a[15]=this.ga;a[16]=this.memory;return a};
m.G=function(a){this.O=a[0];this.Xe=a[1];this.ya=a[2];this.be=a[3];this.Bb=a[4];this.Fd=a[5];this.qf=a[6];this.ta=a[7];this.Ab=a[8];this.lb=a[9];this.Lb=a[10];this.Va=a[11];this.Td=a[12];this.rf=a[13];this.Tf=a[14];this.tc&&(this.ga=a[15],this.memory=a[16])};function Dd(a,b){t("Do interrupt "+M(b,2),1048576);a.O|=b;Ed(a)}function Ed(a){a.Xe&a.O?a.Qa.Aa(a.La):tc(a.Qa,a.La)}
function Fd(a,b){if(16>=a.ta||16384<=a.ta&&32768>a.ta)a.memory[a.ta]=b;a.ta++;a.Bb--;a.ta>=a.Va<<8&&(a.ta+=a.Ab-a.Va<<8);0===a.Bb&&Dd(a,64)}m.gg=function(a){Fd(this,a);this.be&1&&Fd(this,a>>8)};m.Mh=function(a){Fd(this,a);Fd(this,a>>8);Fd(this,a>>16);Fd(this,a>>24)};function Gd(a){let b=0;32768>a.ta&&(b=a.memory[a.ta]);a.ta++;a.Bb--;a.ta>=a.Va<<8&&(a.ta+=a.Ab-a.Va<<8);0===a.Bb&&Dd(a,64);return b}m.Lh=function(){return this.fg()&255};m.fg=function(){return this.be&1?Gd(this)|Gd(this)<<8:Gd(this)};
m.Kh=function(){return Gd(this)|Gd(this)<<8|Gd(this)<<16|Gd(this)<<24};function T(a){return a.ya>>6&3};var Hd=new Uint8Array(256),Id=[],Jd=[],Kd=[],Ld=new Uint8Array(256),Md=[];
function Nd(a,b){this.s=a;this.A=b;this.Ca=new Lb(64);this.ca=new Lb(64);this.h=this.B=this.kb=this.o=0;this.L=new Uint8Array(256);Od(this);this.Md=!1;this.ye=0;this.zb=this.yb=this.hd=this.mc=!1;this.Mb=[new Mb,new Mb];this.mb=a.v.mb;this.nb=this.lc=this.j=this.Qb=this.l=this.F=0;this.Rb=1;this.gd=5;this.Pb=!1;this.g=new ArrayBuffer(65536);this.Y=new Int8Array(this.g);this.D=new Uint8Array(this.g);this.V=new Int16Array(this.g);this.$=new Uint16Array(this.g);this.Ya=new Kb(this.g);this.Sb=this.C=
!1;this.ib=22050;b.send("dac-tell-sampling-rate",this.ib);this.i=1;this.M=170;this.K=0;this.ad=new Uint8Array(256);this.I=new Lb(64);this.S=this.P=this.U=0;this.bi=!1;this.ba=5;this.nd=new Uint8Array(16);a.u.Ad(544,this,this.Mg,this.Og,this.Bi,this.Di);a.u.Ad(904,this,this.Mg,this.Og);a.u.Ad(548,this,this.Fi,this.Hi);N(a.u,550,this,this.Ji);N(a.u,551,this,this.Li);N(a.u,552,this,this.Ni);N(a.u,553,this,this.Pi);N(a.u,554,this,this.Ri);N(a.u,555,this,this.Ti);N(a.u,556,this,this.Vi);N(a.u,557,this,
this.Xi);a.u.Ad(558,this,this.Zi,this.aj);a.u.ac(544,this,this.Ng,this.Pg,this.Ci,this.Ei);a.u.ac(904,this,this.Ng,this.Pg);a.u.ac(548,this,this.Gi,this.Ii);P(a.u,550,this,this.Ki);P(a.u,551,this,this.Mi);a.u.ac(552,this,this.Oi,this.Qi);P(a.u,554,this,this.Si);P(a.u,555,this,this.Ui);P(a.u,556,this,this.Wi);P(a.u,557,this,this.Yi);P(a.u,558,this,this.$i);P(a.u,559,this,this.bj);a.u.Ad(816,this,this.Gj,this.Ij);a.u.ac(816,this,this.Hj,this.Jj);this.mb.sf.push({Ue:this.pa,Sf:this});b.register("dac-request-data",
function(){!this.Qb||this.Sb?Pd(this):Qd(this)},this);b.register("speaker-has-initialized",function(){Od(this)},this);b.send("speaker-confirm-initialized");Rd(this)}function Rd(a){a.Ca.clear();a.ca.clear();a.kb=0;a.B=0;a.Md=!1;a.ye=0;a.mc=!1;a.hd=!1;a.yb=!1;a.zb=!1;a.Mb[0].clear();a.Mb[1].clear();a.F=0;a.l=0;a.Qb=0;a.j=0;a.lc=0;a.nb=0;a.Pb=!1;a.D.fill(0);a.C=!1;a.Sb=!1;a.M=170;a.K=0;a.ib=22050;a.i=1;Sd(a,1);a.nd.fill(0);a.ad.fill(0);a.ad[5]=1;a.ad[9]=248}m=Nd.prototype;
m.W=function(){var a=[];a[2]=this.o;a[3]=this.kb;a[4]=this.B;a[5]=this.h;a[6]=this.L;a[7]=this.Md;a[8]=this.ye;a[9]=this.mc;a[10]=this.hd;a[11]=this.yb;a[12]=this.zb;a[15]=this.F;a[16]=this.l;a[17]=this.Qb;a[18]=this.j;a[19]=this.lc;a[20]=this.nb;a[21]=this.Rb;a[22]=this.gd;a[23]=this.Pb;a[24]=this.D;a[25]=this.C;a[26]=this.Sb;a[27]=this.ib;a[28]=this.i;a[29]=this.M;a[30]=this.K;a[31]=this.ad;a[33]=this.eb;a[34]=this.ba;a[35]=this.nd;return a};
m.G=function(a){this.o=a[2];this.kb=a[3];this.B=a[4];this.h=a[5];this.L=a[6];Td(this);this.Md=a[7];this.ye=a[8];this.mc=a[9];this.hd=a[10];this.yb=a[11];this.zb=a[12];this.F=a[15];this.l=a[16];this.Qb=a[17];this.j=a[18];this.lc=a[19];this.nb=a[20];this.Rb=a[21];this.gd=a[22];this.Pb=a[23];this.D=a[24];this.C=a[25];this.Sb=a[26];this.ib=a[27];this.i=a[28];this.M=a[29];this.K=a[30];this.ad=a[31];this.eb=a[33];this.ba=a[34];this.nd=a[35];this.g=this.D.buffer;this.Y=new Int8Array(this.g);this.V=new Int16Array(this.g);
this.$=new Uint16Array(this.g);this.Ya=new Kb(this.g);this.Sb?this.A.send("dac-disable"):this.A.send("dac-enable")};m.Mg=function(){t("220 read: fm music status port (unimplemented)",8388608);return 255};m.Og=function(){t("221 read: fm music data port (write only)",8388608);return 255};m.Bi=function(){t("222 read: advanced fm music status port (unimplemented)",8388608);return 255};m.Di=function(){t("223 read: advanced music data port (write only)",8388608);return 255};
m.Fi=function(){t("224 read: mixer address port",8388608);return this.h};m.Hi=function(){t("225 read: mixer data port",8388608);var a=this.h,b=Jd[a];b?b=b.call(this):(b=this.L[a],t("unhandled mixer register read. addr:"+M(a)+" data:"+M(b),8388608));return b};m.Ji=function(){t("226 read: (write only)",8388608);return 255};m.Li=function(){t("227 read: undocumented",8388608);return 255};m.Ni=function(){t("228 read: fm music status port (unimplemented)",8388608);return 255};
m.Pi=function(){t("229 read: fm music data port (write only)",8388608);return 255};m.Ri=function(){t("22A read: read data",8388608);this.ca.length&&(this.o=this.ca.shift());t(" <- "+this.o+" "+M(this.o)+" '"+String.fromCharCode(this.o)+"'",8388608);return this.o};m.Ti=function(){t("22B read: undocumented",8388608);return 255};m.Vi=function(){t("22C read: write-buffer status",8388608);return 127};m.Xi=function(){t("22D read: undocumented",8388608);return 255};
m.Zi=function(){t("22E read: read-buffer status / irq 8bit ack.",8388608);this.nd[1]&&Sd(this,1);return(this.ca.length&&!this.mc)<<7|127};m.aj=function(){t("22F read: irq 16bit ack",8388608);Sd(this,2);return 0};m.Ng=function(a){t("220 write: (unimplemented) fm register 0 address = "+M(a),8388608);this.P=0};m.Pg=function(a){t("221 write: (unimplemented) fm register 0 data = "+M(a),8388608);var b=Md[this.P];b||(b=this.Te);b.call(this,a,0,this.P)};
m.Ci=function(a){t("222 write: (unimplemented) fm register 1 address = "+M(a),8388608);this.S=0};m.Ei=function(a){t("223 write: (unimplemented) fm register 1 data ="+M(a),8388608);var b=Md[this.S];b||(b=this.Te);b.call(this,a,1,this.S)};m.Gi=function(a){t("224 write: mixer address = "+M(a),8388608);this.h=a};m.Ii=function(a){t("225 write: mixer data = "+M(a),8388608);Ud(this,this.h,a)};
m.Ki=function(a){t("226 write: reset = "+M(a),8388608);this.mc?(t(" -> exit highspeed",8388608),this.mc=!1):a&&(t(" -> reset",8388608),Rd(this));this.ca.clear();this.ca.push(170)};m.Mi=function(){t("227 write: undocumented",8388608)};m.Oi=function(){t("228 write: fm music register port (unimplemented)",8388608)};m.Qi=function(){t("229 write: fm music data port (unimplemented)",8388608)};m.Si=function(){t("22A write: dsp read data port (read only)",8388608)};
m.Ui=function(){t("22B write: undocumented",8388608)};m.Wi=function(a){t("22C write: write command/data",8388608);0===this.kb?(t("22C write: command = "+M(a),8388608),this.kb=a,this.Ca.clear(),this.B=Hd[a]):(t("22C write: data: "+M(a),8388608),this.Ca.push(a));this.Ca.length>=this.B&&(a=Id[this.kb],a||(a=this.Ne),a.call(this),this.B=this.kb=0,this.Ca.clear())};m.Yi=function(){t("22D write: undocumented",8388608)};m.$i=function(){t("22E write: dsp read buffer status (read only)",8388608)};
m.bj=function(){t("22F write: undocumented",8388608)};m.Gj=function(){t("330 read: mpu data",8388608);this.I.length&&(this.U=this.I.shift());t(" <- "+M(this.U),8388608);return this.U};m.Hj=function(a){t("330 write: mpu data (unimplemented) : "+M(a),8388608)};m.Ij=function(){t("331 read: mpu status",8388608);return 0|128*!this.I.length};m.Jj=function(a){t("331 write: mpu command: "+M(a),8388608);255==a&&(this.I.clear(),this.I.push(254))};m.Ne=function(){t("Unhandled command: "+M(this.kb),8388608)};
function W(a,b,c){c||(c=Nd.prototype.Ne);for(var d=0;d<a.length;d++)Hd[a[d]]=b,Id[a[d]]=c}function Vd(a){for(var b=[],c=0;16>c;c++)b.push(a+c);return b}W([14],2,function(){this.ad[this.Ca.shift()]=this.Ca.shift()});W([15],1,function(){this.ca.clear();this.ca.push(this.ad[this.Ca.shift()])});W([16],1,function(){var a=this.Ca.shift();a=Wd(a/127.5+-1);this.Mb[0].push(a);this.Mb[1].push(a);this.A.send("dac-enable")});
W([20,21],2,function(){this.lc=1;this.nb=this.Rb;this.mc=this.yb=this.zb=this.Pb=!1;Xd(this);Yd(this)});W([22],2);W([23],2);W([28],0,function(){this.lc=1;this.nb=this.Rb;this.Pb=!0;this.mc=this.yb=this.zb=!1;Yd(this)});W([31],0);W([32],0,function(){this.ca.clear();this.ca.push(127)});W([36],2);W([44],0);W([48],0);W([49],0);W([52],0);W([53],0);W([54],0);W([55],0);W([56],0);W([64],1,function(){Zd(this,1E6/(256-this.Ca.shift())/(this.hd?2:1))});W([65,66],2,function(){Zd(this,this.Ca.shift()<<8|this.Ca.shift())});
W([72],2,function(){Xd(this)});W([116],2);W([117],2);W([118],2);W([119],2);W([125],0);W([127],0);W([128],2);W([144],0,function(){this.lc=1;this.nb=this.Rb;this.Pb=!0;this.zb=!1;this.mc=!0;this.yb=!1;Yd(this)});W([145],0);W([152],0);W([153],0);W([160],0);W([168],0);W(Vd(176),3,function(){if(this.kb&8)this.Ne();else{var a=this.Ca.shift();this.lc=2;this.nb=this.gd;this.Pb=!!(this.kb&4);this.zb=!!(a&16);this.hd=!!(a&32);this.yb=!0;Xd(this);Yd(this)}});
W(Vd(192),3,function(){if(this.kb&8)this.Ne();else{var a=this.Ca.shift();this.lc=1;this.nb=this.Rb;this.Pb=!!(this.kb&4);this.zb=!!(a&16);this.hd=!!(a&32);this.yb=!1;Xd(this);Yd(this)}});W([208],0,function(){this.Sb=!0;this.A.send("dac-disable")});W([209],0,function(){this.Md=!0});W([211],0,function(){this.Md=!1});W([212],0,function(){this.Sb=!1;this.A.send("dac-enable")});W([213],0,function(){this.Sb=!0;this.A.send("dac-disable")});W([214],0,function(){this.Sb=!1;this.A.send("dac-enable")});
W([216],0,function(){this.ca.clear();this.ca.push(255*this.Md)});W([217,218],0,function(){this.Pb=!1});W([224],1,function(){this.ca.clear();this.ca.push(~this.Ca.shift())});W([225],0,function(){this.ca.clear();this.ca.push(4);this.ca.push(5)});W([226],1);W([227],0,function(){this.ca.clear();for(var a=0;44>a;a++)this.ca.push("COPYRIGHT (C) CREATIVE TECHNOLOGY LTD, 1992.".charCodeAt(a));this.ca.push(0)});W([228],1,function(){this.ye=this.Ca.shift()});W([232],0,function(){this.ca.clear();this.ca.push(this.ye)});
W([242,243],0,function(){this.Aa()});var $d=new Uint8Array(256);$d[14]=255;$d[15]=7;$d[55]=56;W([249],1,function(){var a=this.Ca.shift();t("dsp 0xf9: unknown function. input: "+a,8388608);this.ca.clear();this.ca.push($d[a])});function Ud(a,b,c){var d=Kd[b];d?d.call(a,c):t("unhandled mixer register write. addr:"+M(b)+" data:"+M(c),8388608)}Nd.prototype.Za=function(){t("mixer register read. addr:"+M(this.h),8388608);return this.L[this.h]};
Nd.prototype.cb=function(a){t("mixer register write. addr:"+M(this.h)+" data:"+M(a),8388608);this.L[this.h]=a};function Od(a){a.L[4]=204;a.L[34]=204;a.L[38]=204;a.L[40]=0;a.L[46]=0;a.L[10]=0;a.L[48]=192;a.L[49]=192;a.L[50]=192;a.L[51]=192;a.L[52]=192;a.L[53]=192;a.L[54]=0;a.L[55]=0;a.L[56]=0;a.L[57]=0;a.L[59]=0;a.L[60]=31;a.L[61]=21;a.L[62]=11;a.L[63]=0;a.L[64]=0;a.L[65]=0;a.L[66]=0;a.L[67]=0;a.L[68]=128;a.L[69]=128;a.L[70]=128;a.L[71]=128;Td(a)}
function Td(a){for(var b=1;b<a.L.length;b++)Ld[b]||Ud(a,b,a.L[b])}function ae(a,b){b||(b=Nd.prototype.Za);Jd[a]=b}function be(a,b){b||(b=Nd.prototype.cb);Kd[a]=b}function ce(a,b,c){Ld[a]=1;Jd[a]=function(){return this.L[b]&240|this.L[c]>>>4};Kd[a]=function(d){this.L[a]=d;var e=d<<4&240|this.L[c]&15;Ud(this,b,d&240|this.L[b]&15);Ud(this,c,e)}}function de(a,b,c){Jd[a]=Nd.prototype.Za;Kd[a]=function(d){this.L[a]=d;this.A.send("mixer-volume",[b,c,(d>>>2)-62])}}ae(0,function(){Od(this);return 0});be(0);
ce(4,50,51);ce(34,48,49);ce(38,52,53);ce(40,54,55);ce(46,56,57);de(48,0,0);de(49,0,1);de(50,2,0);de(51,2,1);ae(59);be(59,function(a){this.L[59]=a;this.A.send("mixer-volume",[1,2,6*(a>>>6)-18])});ae(65);be(65,function(a){this.L[65]=a;this.A.send("mixer-gain-left",6*(a>>>6))});ae(66);be(66,function(a){this.L[66]=a;this.A.send("mixer-gain-right",6*(a>>>6))});ae(68);be(68,function(a){this.L[68]=a;a>>>=3;this.A.send("mixer-treble-left",a-(16>a?14:16))});ae(69);
be(69,function(a){this.L[69]=a;a>>>=3;this.A.send("mixer-treble-right",a-(16>a?14:16))});ae(70);be(70,function(a){this.L[70]=a;a>>>=3;this.A.send("mixer-bass-right",a-(16>a?14:16))});ae(71);be(71,function(a){this.L[71]=a;a>>>=3;this.A.send("mixer-bass-right",a-(16>a?14:16))});ae(128,function(){switch(this.ba){case 2:return 1;case 5:return 2;case 7:return 4;case 10:return 8;default:return 0}});be(128,function(a){a&1&&(this.ba=2);a&2&&(this.ba=5);a&4&&(this.ba=7);a&8&&(this.ba=10)});
ae(129,function(){var a=0;switch(this.Rb){case 0:a|=1;break;case 1:a|=2;break;case 3:a|=8}switch(this.gd){case 5:a|=32;break;case 6:a|=64;break;case 7:a|=128}return a});be(129,function(a){a&1&&(this.Rb=0);a&2&&(this.Rb=1);a&8&&(this.Rb=3);a&32&&(this.gd=5);a&64&&(this.gd=6);a&128&&(this.gd=7)});ae(130,function(){for(var a=32,b=0;16>b;b++)a|=b*this.nd[b];return a});Nd.prototype.Te=function(a,b,c){t("unhandled fm register write. addr:"+b+"|"+M(c)+" data:"+M(a),8388608)};
function ee(a,b){b||(b=Nd.prototype.Te);for(var c=0;c<a.length;c++)Md[a[c]]=b}function fe(a,b){for(var c=[];a<=b;a++)c.push(a);return c}var ge=new Uint8Array(32);ge[0]=0;ge[1]=1;ge[2]=2;ge[3]=3;ge[4]=4;ge[5]=5;ge[8]=6;ge[9]=7;ge[10]=8;ge[11]=9;ge[12]=10;ge[13]=11;ge[16]=12;ge[17]=13;ge[18]=14;ge[19]=15;ge[20]=16;ge[21]=17;ee([1],function(a,b){this.bi[b]=a&1});ee([2]);ee([3]);ee([4],function(){});ee([5],function(a,b,c){0===b&&this.Te(a,b,c)});ee([8],function(){});ee(fe(32,53),function(){});
ee(fe(64,85),function(){});ee(fe(96,117),function(){});ee(fe(128,149),function(){});ee(fe(160,168),function(){});ee(fe(176,184),function(){});ee([189],function(){});ee(fe(192,200),function(){});ee(fe(224,245),function(){});function Zd(a,b){a.ib=b;a.A.send("dac-tell-sampling-rate",b)}function Xd(a){a.F=1+(a.Ca.shift()<<0)+(a.Ca.shift()<<8)}
function Yd(a){t("begin dma transfer",8388608);a.i=1;a.yb&&(a.i*=2);a.l=a.F*a.i;a.j=1024*a.i;a.j=Math.min(Math.max(a.l>>2&-4,32),a.j);a.C=!0;a.mb.ic[a.nb]||a.pa(a.nb)}Nd.prototype.pa=function(a){a===this.nb&&this.C&&(this.C=!1,this.Qb=this.l,this.Sb=!1,this.A.send("dac-enable"))};
function Qd(a){t("dma transfering next block",8388608);var b=Math.min(a.Qb,a.j),c=Math.floor(b/a.i);a.mb.ge(a.Ya,0,b,a.nb,d=>{t("dma block transfer "+(d?"unsuccessful":"successful"),8388608);if(!d){d=a.yb?32767.5:127.5;var e=a.zb?0:-1,k=a.hd?1:2,l;a.yb?l=a.zb?a.V:a.$:l=a.zb?a.Y:a.D;for(var f=0,p=0;p<c;p++)for(var r=Wd(l[p]/d+e),q=0;q<k;q++)a.Mb[f].push(r),f^=1;Pd(a);a.Qb-=b;a.Qb||(a.Aa(a.lc),a.Pb&&(a.Qb=a.l))}})}
function Pd(a){if(a.Mb[0].length){var b=Nb(a.Mb[0],a.Mb[0].length),c=Nb(a.Mb[1],a.Mb[1].length);a.A.send("dac-send-data",[b,c],[b.buffer,c.buffer])}}Nd.prototype.Aa=function(a){t("raise irq",8388608);this.nd[a]=1;this.s.Ta(this.ba)};function Sd(a,b){t("lower irq",8388608);a.nd[b]=0;Rb(a.s,a.ba)}function Wd(a){return-1*(-1>a)+1*(1<a)+(-1<=a&&1>=a)*a};function na(a,b){this.s=a;this.Qa=a.v.Qa;this.Me=b.Me;this.J=[244,26,b.Me&255,b.Me>>8,7,5,16,0,1,0,2,0,0,0,0,0,1,168,0,0,0,16,191,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,244,26,b.jh&255,b.jh>>8,0,0,0,0,64,0,0,0,0,0,0,0,0,1,0,0];this.J=this.J.concat(Array(256-this.J.length).fill(0));this.La=b.La;this.hb=[];this.name=b.name;this.i=this.B=0;this.l=new Uint32Array(4);this.h=new Uint32Array(4);for(var c of b.Le.features)n(0<=c,"VirtIO device<"+this.name+"> feature bit numbers must be non-negative"),
n(128>c,"VirtIO device<"+this.name+"> feature bit numbers assumed less than 128 in implementation"),this.l[c>>>5]|=1<<(c&31),this.h[c>>>5]|=1<<(c&31);n(b.Le.features.includes(32),"VirtIO device<"+this.name+"> only non-transitional devices are supported");this.C=!0;this.j=0;this.F=!1;this.D=0;this.ab=[];for(var d of b.Le.ab)this.ab.push(new he(a,this,d));this.o=0;this.g=this.ab[0];this.Kc=0;c=new Set;for(var e of this.ab.map(k=>k.Pd))d=b.notification.ih?0:e,c.add(d),n(b.notification.Ve[d],"VirtIO device<"+
this.name+"> every queue's notifier must exist");for(const [k,l]of b.notification.Ve.entries())n(!l||c.has(k),"VirtIO device<"+this.name+"> no defined notify handler should be unused");e=[];e.push(ie(this,b.Le));e.push(je(this,b.notification));e.push(ke(this,b.Kc));b.hg&&e.push(le(this,b.hg));me(this,e);ac(a.v.Qa,this);this.reset()}
function ie(a,b){return{type:1,xc:0,port:b.ld,Ce:!1,offset:0,je:new Uint8Array(0),Dd:[{bytes:4,name:"device_feature_select",read:()=>a.B,write:c=>{a.B=c}},{bytes:4,name:"device_feature",read:()=>a.l[a.B]||0,write:()=>{}},{bytes:4,name:"driver_feature_select",read:()=>a.i,write:c=>{a.i=c}},{bytes:4,name:"driver_feature",read:()=>a.h[a.i]||0,write:c=>{const d=a.l[a.i];a.i<a.h.length&&(a.h[a.i]=c&d);a.C=a.C&&!(c&~d)}},{bytes:2,name:"msix_config",read:()=>{t("No msi-x capability supported.",2097152);
return 65535},write:()=>{t("No msi-x capability supported.",2097152)}},{bytes:2,name:"num_queues",read:()=>a.ab.length,write:()=>{}},{bytes:1,name:"device_status",read:()=>a.j,write:c=>{0===c?(t("Reset device<"+a.name+">",2097152),a.reset()):c&128?t("Warning: Device<"+a.name+"> status failed",2097152):t("Device<"+a.name+"> status: "+(c&1?"ACKNOWLEDGE ":"")+(c&2?"DRIVER ":"")+(c&4?"DRIVER_OK":"")+(c&8?"FEATURES_OK ":"")+(c&64?"DEVICE_NEEDS_RESET":""),2097152);c&~a.j&4&&a.j&64&&(a.F=!0,a.j&4?a.Aa(2):
n(!1,"VirtIO device<"+a.name+"> attempted to notify driver before DRIVER_OK"));a.C||(c&8&&t("Removing FEATURES_OK",2097152),c&=-9);a.j=c}},{bytes:1,name:"config_generation",read:()=>a.D,write:()=>{}},{bytes:2,name:"queue_select",read:()=>a.o,write:c=>{a.o=c;a.o<a.ab.length||(a.g=null)}},{bytes:2,name:"queue_size",read:()=>a.g?a.g.size:0,write:c=>{a.g&&(c&c-1&&(t("Warning: dev<"+a.name+"> Given queue size was not a power of 2. Rounding up to next power of 2.",2097152),c=1<<Db(c-1)+1),c>a.g.wc&&(t("Warning: dev<"+
a.name+"> Trying to set queue size greater than supported. Clamping to supported size.",2097152),c=a.g.wc),ne(a.g,c))}},{bytes:2,name:"queue_msix_vector",read:()=>{t("No msi-x capability supported.",2097152);return 65535},write:()=>{t("No msi-x capability supported.",2097152)}},{bytes:2,name:"queue_enable",read:()=>a.g?a.g.enabled|0:0,write:c=>{a.g&&(1===c?(c=a.g,c.l&&c.h&&c.g?(c=a.g,n(c.l&&c.h&&c.g,"VirtQueue must be configured before enabled"),c.enabled=!0):t("Driver bug: tried enabling unconfigured queue",
2097152)):0===c&&t("Driver bug: tried writing 0 to queue_enable",2097152))}},{bytes:2,name:"queue_notify_off",read:()=>a.g?a.g.Pd:0,write:()=>{}},{bytes:4,name:"queue_desc (low dword)",read:()=>a.g?a.g.l:0,write:c=>{a.g&&(a.g.l=c)}},{bytes:4,name:"queue_desc (high dword)",read:()=>0,write:()=>{t("Warning: High dword of 64 bit queue_desc ignored",2097152)}},{bytes:4,name:"queue_avail (low dword)",read:()=>a.g?a.g.h:0,write:c=>{a.g&&(a.g.h=c)}},{bytes:4,name:"queue_avail (high dword)",read:()=>0,write:()=>
{t("Warning: High dword of 64 bit queue_avail ignored",2097152)}},{bytes:4,name:"queue_used (low dword)",read:()=>a.g?a.g.g:0,write:c=>{a.g&&(a.g.g=c)}},{bytes:4,name:"queue_used (high dword)",read:()=>0,write:()=>{t("Warning: High dword of 64 bit queue_used ignored",2097152)}}]}}
function je(a,b){const c=[];b.ih?(n(1===b.Ve.length,"VirtIO device<"+a.name+"> too many notify handlers specified: expected single handler"),a=0):a=2;for(const [d,e]of b.Ve.entries())c.push({bytes:2,name:"notify"+d,read:()=>65535,write:e||(()=>{})});return{type:2,xc:1,port:b.ld,Ce:!1,offset:0,je:new Uint8Array([a&255,a>>8&255,a>>16&255,a>>24]),Dd:c}}
function ke(a,b){return{type:3,xc:2,port:b.ld,Ce:!1,offset:0,je:new Uint8Array(0),Dd:[{bytes:1,name:"isr_status",read:()=>{const c=a.Kc;oe(a);return c},write:()=>{}}]}}function le(a,b){n(~b.offset&3,"VirtIO device<"+a.name+"> device specific cap offset must be 4-byte aligned");return{type:4,xc:3,port:b.ld,Ce:!1,offset:0,je:new Uint8Array(0),Dd:b.Dd}}
function me(a,b){let c=a.J[52]=64;var d=c;for(const k of b){b=16+k.je.length;d=c;c=d+b;n(256>=c,"VirtIO device<"+a.name+"> can't fit all capabilities into 256byte configspace");n(0<=k.xc&&6>k.xc,"VirtIO device<"+a.name+"> capability invalid bar number");var e=k.Dd.reduce((l,f)=>l+f.bytes,0);e+=k.offset;e=16>e?16:1<<Db(e-1)+1;n(0===(k.port&e-1),"VirtIO device<"+a.name+"> capability port should be aligned to pci bar size");a.hb[k.xc]={size:e};a.J[d]=9;a.J[d+1]=c;a.J[d+2]=b;a.J[d+3]=k.type;a.J[d+4]=
k.xc;a.J[d+5]=0;a.J[d+6]=0;a.J[d+7]=0;a.J[d+8]=k.offset&255;a.J[d+9]=k.offset>>>8&255;a.J[d+10]=k.offset>>>16&255;a.J[d+11]=k.offset>>>24;a.J[d+12]=e&255;a.J[d+13]=e>>>8&255;a.J[d+14]=e>>>16&255;a.J[d+15]=e>>>24;for(const [l,f]of k.je.entries())a.J[d+16+l]=f;d=16+4*k.xc;a.J[d]=k.port&254|!k.Ce;a.J[d+1]=k.port>>>8&255;a.J[d+2]=k.port>>>16&255;a.J[d+3]=k.port>>>24&255;d=k.port+k.offset;for(const l of k.Dd){let f=l.read;b=l.write;f=()=>{const p=l.read();t("Device<"+a.name+"> cap["+k.type+"] read["+l.name+
"] => "+M(p,8*l.bytes),2097152);return p};b=p=>{t("Device<"+a.name+"> cap["+k.type+"] write["+l.name+"] <= "+M(p,8*l.bytes),2097152);l.write(p)};if(k.Ce)n(!1,"VirtIO device <"+a.name+"> mmio capability not implemented.");else{e=function(r){t("Warning: 8-bit read from 16-bit virtio port",2097152);return f(r&-2)>>((r&1)<<3)&255};const p=function(r){t("Warning: 8-bit read from 32-bit virtio port",2097152);return f(r&-4)>>((r&3)<<3)&255};switch(l.bytes){case 4:N(a.s.u,d,a,p,void 0,f);P(a.s.u,d,a,void 0,
void 0,b);break;case 2:N(a.s.u,d,a,e,f);P(a.s.u,d,a,void 0,b);break;case 1:N(a.s.u,d,a,f);P(a.s.u,d,a,b);break;default:n(!1,"VirtIO device <"+a.name+"> invalid capability field width of "+l.bytes+" bytes")}}d+=l.bytes}}n(256>=c+20,"VirtIO device<"+a.name+"> can't fit all capabilities into 256byte configspace");a.J[c]=9;a.J[c+1]=0;a.J[c+2]=20;a.J[c+3]=5;a.J[c+4]=0;a.J[c+5]=0;a.J[c+6]=0;a.J[c+7]=0;a.J[c+8]=0;a.J[c+9]=0;a.J[c+10]=0;a.J[c+11]=0;a.J[c+12]=0;a.J[c+13]=0;a.J[c+14]=0;a.J[c+15]=0;a.J[c+16]=
0;a.J[c+17]=0;a.J[c+18]=0;a.J[c+19]=0}na.prototype.W=function(){let a=[];a[0]=this.B;a[1]=this.i;a[2]=this.l;a[3]=this.h;a[4]=this.C;a[5]=this.j;a[6]=this.F;a[7]=this.D;a[8]=this.Kc;a[9]=this.o;return a=a.concat(this.ab)};na.prototype.G=function(a){this.B=a[0];this.i=a[1];this.l=a[2];this.h=a[3];this.C=a[4];this.j=a[5];this.F=a[6];this.D=a[7];this.Kc=a[8];this.o=a[9];let b=0;for(let c of a.slice(10))this.ab[b].G(c),b++;this.g=this.ab[this.o]||null};
na.prototype.reset=function(){this.i=this.B=0;this.h.set(this.l);this.C=!0;this.o=this.j=0;this.g=this.ab[0];for(const a of this.ab)a.reset();this.F=!1;this.D=0;oe(this)};na.prototype.Aa=function(a){t("Raise irq "+M(a),2097152);this.Kc|=a;this.Qa.Aa(this.La)};function oe(a){t("Lower irq ",2097152);a.Kc=0;tc(a.Qa,a.La)}function he(a,b,c){this.s=a;this.Wa=b;this.wc=this.size=c.wc;this.rd=this.size-1;this.enabled=!1;this.Pd=c.Pd;this.i=this.g=this.j=this.h=this.l=0;this.reset()}
he.prototype.W=function(){const a=[];a[0]=this.size;a[1]=this.wc;a[2]=this.enabled;a[3]=this.Pd;a[4]=this.l;a[5]=this.h;a[6]=this.j;a[7]=this.g;a[8]=this.i;return a};he.prototype.G=function(a){this.size=a[0];this.wc=a[1];this.enabled=a[2];this.Pd=a[3];this.l=a[4];this.h=a[5];this.j=a[6];this.g=a[7];this.i=a[8];this.rd=this.size-1};he.prototype.reset=function(){this.enabled=!1;this.i=this.g=this.j=this.h=this.l=0;ne(this,this.wc)};
function ne(a,b){n(0===(b&b-1),"VirtQueue size must be power of 2 or zero");n(b<=a.wc,"VirtQueue size must be within supported size");a.size=b;a.rd=b-1}function pa(a){n(a.h,"VirtQueue addresses must be configured before use");return(a.s.sa(a.h+2)&a.rd)!==a.j}
function qa(a,b){this.s=a.s;this.Wa=a.Wa;this.vg=b;this.i=[];this.Cf=this.g=this.h=0;this.Zf=[];this.Df=this.Ee=this.Yf=0;let c=a.l,d=0,e=a.size,k=!1;const l=0<(this.Wa.h[0]&268435456);t("<<< Descriptor chain start",2097152);do{var f=a,p=c,r=b;f={He:f.s.h(p+16*r),Ch:f.s.h(p+16*r+4),oe:f.s.h(p+16*r+8),flags:f.s.sa(p+16*r+12),next:f.s.sa(p+16*r+14)};t("descriptor: idx="+b+" addr="+M(f.Ch,8)+":"+M(f.He,8)+" len="+M(f.oe,8)+" flags="+M(f.flags,4)+" next="+M(f.next,4),2097152);if(l&&f.flags&4)f.flags&
1&&t("Driver bug: has set VIRTQ_DESC_F_NEXT flag in an indirect table descriptor",2097152),c=f.He,d=b=0,e=f.oe/16,t("start indirect",2097152);else{if(f.flags&2)k=!0,this.Zf.push(f);else{if(k){t("Driver bug: readonly buffer after writeonly buffer within chain",2097152);break}this.i.push(f);this.Cf+=f.oe}d++;if(d>e){t("Driver bug: descriptor chain cycle detected",2097152);break}if(f.flags&1)b=f.next;else break}}while(1);t("Descriptor chain end >>>",2097152)}
function va(a,b){let c=0,d=b.length;for(;d;){if(a.h===a.i.length){t("Device<"+a.Wa.name+"> Read more than device-readable buffers has",2097152);break}var e=a.i[a.h],k=e.He+a.g;let r=e.oe-a.g;r>d?(r=d,a.g+=d):(a.h++,a.g=0);e=b;var l=e.set,f=a.s,p=r;p&&(n(!f.Ye(k)),n(!f.Ye(k+p-1)));l.call(e,f.Ka.subarray(k,k+p),c);c+=r;d-=r}};function pe(){this.pe={};this.g=void 0}pe.prototype.register=function(a,b,c){var d=this.pe[a];void 0===d&&(d=this.pe[a]=[]);d.push({Ue:b,Sf:c})};pe.prototype.unregister=function(a,b){var c=this.pe[a];void 0!==c&&(this.pe[a]=c.filter(function(d){return d.Ue!==b}))};pe.prototype.send=function(a,b){if(this.g&&(a=this.g.pe[a],void 0!==a))for(var c=0;c<a.length;c++){var d=a[c];d.Ue.call(d.Sf,b)}};function qe(){var a=new pe,b=new pe;a.g=b;b.g=a;return[a,b]};var nb=[],t=function(){var a=ka.reduce(function(d,e){d[e[0]]=e[1];return d},{}),b="",c=0;return function(d,e){e=e||1;if(e&ab){d="["+bb(a[e]||"",4)+"] "+d;if(d===b&&(c++,2048>c))return;e=new Date;e=gb(e.getHours(),2)+":"+gb(e.getMinutes(),2)+":"+gb(e.getSeconds(),2)+"+"+gb(e.getMilliseconds(),3)+" ";c&&(1===c?console.log(e+b):console.log("Previous message repeated "+c+" times"),c=0);console.log(e+d);b=d}}}();
function n(a,b){if(!a){debugger;console.trace();if(b)throw"Assert failed: "+b;throw"Assert failed";}};function ub(a,b,c){this.qh=c;this.xa=b;re(this);b=Object.create(null);b.m=this.xa.exports.memory;for(var d of Object.keys(this.xa.exports))d.startsWith("_")||d.startsWith("zstd")||d.endsWith("_js")||(b[d]=this.xa.exports[d]);this.ph=b;this.Xa=d=this.xa.exports.memory;this.H=R(Uint32Array,d,812,1);this.Ka=new Uint8Array(0);this.Gb=new Int32Array(this.Ka.buffer);this.Jb=R(Uint8Array,d,724,8);this.M=R(Int32Array,d,736,8);this.o=R(Uint32Array,d,768,8);this.K=R(Int32Array,d,800,1);this.Fb=R(Int32Array,
d,564,1);this.wb=R(Int32Array,d,568,1);this.B=R(Int32Array,d,572,1);this.ub=R(Int32Array,d,576,1);this.dh=R(Int32Array,d,1128,1);this.Fc=R(Uint32Array,d,540,8);this.ya=R(Int32Array,d,580,8);this.U=R(Uint8Array,d,612,1);this.F=R(Int32Array,d,804,1);this.P=R(Int32Array,d,808,1);this.j=R(Uint8Array,d,616,1);this.Ec=R(Int32Array,d,620,1);this.dc=R(Int32Array,d,624,1);this.Hg=R(Int32Array,d,636,1);this.$g=R(Int32Array,d,640,1);this.Zg=R(Int32Array,d,644,1);this.Gc=R(Int32Array,d,648,1);this.flags=R(Int32Array,
d,120,1);this.ec=R(Int32Array,d,116,1);this.Bc=R(Int32Array,d,96,1);this.Dc=R(Int32Array,d,104,1);R(Int32Array,d,112,1);this.ck=R(Uint32Array,d,960,2);this.v={};this.D=R(Int32Array,d,556,1);this.Lc=R(Int32Array,d,560,1);R(Uint8Array,d,548,1);this.S=R(Uint8Array,d,552,1);this.l=[];this.re=[];this.Hb=[];this.qe=[];this.Kd={Cg:null,Yd:null};this.ii=R(Uint32Array,d,664,1);this.i=R(Int32Array,d,64,8);this.hc=R(Int32Array,d,1152,32);this.cb=R(Uint8Array,d,816,1);this.cb[0]=255;this.eb=R(Uint8Array,d,1032,
1);this.eb[0]=0;this.V=R(Uint16Array,d,1036,1);this.V[0]=895;this.ik=R(Uint16Array,d,1040,1);this.ik[0]=0;this.pa=R(Int32Array,d,1048,1);this.pa[0]=0;this.Ya=R(Int32Array,d,1052,1);this.Ya[0]=0;this.Za=R(Int32Array,d,1044,1);this.Za[0]=0;this.Y=R(Int32Array,d,1056,1);this.Y[0]=0;this.$=R(Int32Array,d,1060,1);this.$[0]=0;this.od=R(Int32Array,d,832,32);R(Int32Array,d,824,1);this.g=R(Uint16Array,d,668,8);this.cc=R(Int32Array,d,684,8);this.Mc=R(Int32Array,d,968,8);this.vh=R(Uint32Array,d,716,1);this.uh=
R(Uint32Array,d,720,1);this.Ua=[];this.Af=0;this.ud=[];this.u=void 0;this.A=a;this.Dg(0,0);se(this);this.xf=this.mg=0;this.Bg={}}
function re(a){const b=c=>{const d=a.xa.exports[c];console.assert(d,"Missing import: "+c);return d};a.Ib=b("reset_cpu");a.nh=b("getiopl");a.Ac=b("get_eflags");a.C=b("get_eflags_no_arith");a.I=b("pic_call_irq");a.gk=b("do_many_cycles_native");b("cycle_internal");a.Fa=b("read8");a.sa=b("read16");a.h=b("read32s");a.Jd=b("write8");a.Yc=b("write16");a.Eb=b("write32");a.Ye=b("in_mapped_range");b("fpu_load_tag_word");b("fpu_load_status_word");b("fpu_get_sti_f64");a.Kb=b("translate_address_system_read_js");
a.vb=b("get_seg_cs");a.kk=b("get_real_eip");b("clear_tlb");a.jk=b("full_clear_tlb");a.Dg=b("set_tsc");a.rh=b("store_current_tsc");a.oh=b("jit_clear_cache_js");a.ji=b("jit_dirty_cache");a.ak=b("codegen_finalize_finished");a.$j=b("allocate_memory");a.Ah=b("zero_memory");a.th=b("svga_allocate_memory");a.sh=b("svga_allocate_dest_buffer");a.xh=b("svga_fill_pixel_buffer");a.Fg=b("svga_mark_dirty");a.lk=b("zstd_create_ctx");a.nk=b("zstd_get_src_ptr");a.mk=b("zstd_free_ctx");a.Fe=b("zstd_read");a.Ge=b("zstd_read_free")}
ub.prototype.W=function(){var a=[];a[0]=this.H[0];a[1]=this.Jb;a[2]=this.M;a[3]=this.o;a[4]=this.K[0];a[5]=this.wb[0];a[6]=this.Fb[0];a[7]=this.ub[0];a[8]=this.B[0];a[9]=this.Fc[0];a[10]=this.ya;a[11]=this.U[0];a[13]=this.F[0];a[16]=this.P[0];a[17]=this.j[0];a[18]=this.Ec[0];a[19]=this.dc[0];a[22]=this.Hg[0];a[23]=this.Zg[0];a[24]=this.$g[0];a[25]=this.Gc[0];a[26]=this.flags[0];a[27]=this.ec[0];a[28]=this.Bc[0];a[30]=this.Dc[0];a[37]=this.D[0];a[38]=this.Lc[0];a[39]=this.i;a[40]=this.g;a[41]=this.cc;
a[42]=this.Mc;this.rh();a[43]=this.ck;a[45]=this.v.Wf;a[46]=this.v.Zc;a[47]=this.v.Xc;a[48]=this.v.Qa;a[49]=this.v.mb;a[50]=this.v.Na;a[51]=this.v.wg;a[52]=this.v.Yd;a[53]=this.v.If;a[54]=this.v.Uf;a[55]=this.v.yf;a[56]=this.v.na;a[57]=this.v.T;a[58]=this.v.gf;a[59]=this.v.Ef;a[60]=this.v.qc;a[61]=this.v.Mf;a[62]=this.Ua;a[63]=this.v.Ic;a[64]=this.dh[0];a[66]=this.od;a[67]=this.hc;a[68]=this.cb[0];a[69]=this.eb[0];a[70]=this.V[0];a[71]=this.pa[0];a[72]=this.Ya[0];a[73]=this.Y[0];a[74]=this.$[0];a[75]=
this.Za[0];n(0===(this.Ka.length&4095));var b=this.Ka.length>>12,c=[];for(var d=0;d<b;d++){var e=d<<12;e=this.Gb.subarray(e>>2,e+4096>>2);let f=!0;for(let p=0;p<e.length;p++)if(0!==e[p]){f=!1;break}f||c.push(d)}b=new Ob(b);d=new Uint8Array(c.length<<12);for(let [f,p]of c.entries())b.set(p,1),c=p<<12,d.set(this.Ka.subarray(c,c+4096),f<<12);const {ri:k,Eh:l}={Eh:b,ri:d};a[77]=k;a[78]=new Uint8Array(l.Wb());a[79]=this.v.ze;a[80]=this.v.Ae;a[81]=this.v.Be;return a};
ub.prototype.G=function(a){this.H[0]=a[0];this.Ka.length!==this.H[0]&&console.warn("Note: Memory size mismatch. we="+this.Ka.length+" state="+this.H[0]);this.Jb.set(a[1]);this.M.set(a[2]);this.o.set(a[3]);this.K[0]=a[4];this.wb[0]=a[5];this.Fb[0]=a[6];this.ub[0]=a[7];this.B[0]=a[8];this.Fc[0]=a[9];this.ya.set(a[10]);this.U[0]=a[11];this.F[0]=a[13];this.P[0]=a[16];this.j[0]=a[17];this.Ec[0]=a[18];this.dc[0]=a[19];this.Hg[0]=a[22];this.Zg[0]=a[23];this.$g[0]=a[24];this.Gc[0]=a[25];this.flags[0]=a[26];
this.ec[0]=a[27];this.Bc[0]=a[28];this.Dc[0]=a[30];this.D[0]=a[37];this.Lc[0]=a[38];this.i.set(a[39]);this.g.set(a[40]);this.cc.set(a[41]);a[42]&&this.Mc.set(a[42]);this.Dg(a[43][0],a[43][1]);this.v.Wf&&this.v.Wf.G(a[45]);this.v.Zc&&this.v.Zc.G(a[46]);this.v.Xc&&this.v.Xc.G(a[47]);this.v.Qa&&this.v.Qa.G(a[48]);this.v.mb&&this.v.mb.G(a[49]);this.v.Na&&this.v.Na.G(a[50]);this.v.wg&&this.v.wg.G(a[51]);this.v.Yd&&this.v.Yd.G(a[52]);this.v.If&&this.v.If.G(a[53]);this.v.Uf&&this.v.Uf.G(a[54]);this.v.yf&&
this.v.yf.G(a[55]);this.v.na&&this.v.na.G(a[56]);this.v.T&&this.v.T.G(a[57]);this.v.gf&&this.v.gf.G(a[58]);this.v.Ef&&this.v.Ef.G(a[59]);this.v.qc&&this.v.qc.G(a[60]);this.v.Mf&&this.v.Mf.G(a[61]);this.v.ze&&this.v.ze.G(a[79]);this.v.Ae&&this.v.Ae.G(a[80]);this.v.Be&&this.v.Be.G(a[81]);this.Ua=a[62];this.v.Ic&&this.v.Ic.G(a[63]);this.dh[0]=a[64];this.od.set(a[66]);this.hc.set(a[67]);this.cb[0]=a[68];this.eb[0]=a[69];this.V[0]=a[70];this.pa[0]=a[71];this.Ya[0]=a[72];this.Y[0]=a[73];this.$[0]=a[74];
this.Za[0]=a[75];var b=new Ob(a[78].buffer);a=a[77];this.Ah(this.H[0]);const c=this.H[0]>>12;let d=0;for(let e=0;e<c;e++)if(b.get(e)){let k=d<<12;this.Ka.set(a.subarray(k,k+4096),e<<12);d++}this.jk();this.oh()};function sc(a){a.Ib();a.Ua=[];a.v.Wa&&a.v.Wa.reset();Bb(a)}
function te(a,b){1048576>b?b=1048576:0>(b|0)&&(b=Math.pow(2,31)-131072);b=(b-1|131071)+1|0;n(0<(b|0));n(0===(b&131071));console.assert(0===a.H[0],"Expected uninitialised memory");a.H[0]=b;const c=a.$j(b);a.Ka=R(Uint8Array,a.Xa,c,b);a.Gb=R(Uint32Array,a.Xa,c,b>>2)}
ub.prototype.fb=function(a,b){"number"===typeof a.Ag&&(ab=a.Ag);te(this,"number"===typeof a.H?a.H:67108864);this.S[0]=+a.Na;this.Ib();var c=new ob(this);this.u=c;this.Kd.Cg=a.Kd;this.Kd.Yd=a.fk;Bb(this);if(a.xb){const {pi:e}=ue(this.Ka,a.xb,a.Hc,a.dd||"");e&&this.ud.push(e)}N(c,179,this,function(){t("port 0xB3 read");return 0});var d=0;N(c,146,this,function(){return d});P(c,146,this,function(e){d=e});N(c,1297,this,function(){if(this.Af<this.Ua.length)return this.Ua[this.Af++];n(!1,"config port: Read past value");
return 0});P(c,1296,this,void 0,function(e){function k(p){return new Uint8Array((new Int32Array([p])).buffer)}function l(p){return p>>8|p<<8&65280}function f(p){return p<<24|p<<8&16711680|p>>8&65280|p>>>24}t("bios config port, index="+M(e));this.Af=0;if(0===e)this.Ua=k(1431127377);else if(1===e)this.Ua=k(0);else if(3===e)this.Ua=k(this.H[0]);else if(5===e)this.Ua=k(1);else if(15===e)this.Ua=k(1);else if(13===e)this.Ua=new Uint8Array(16);else if(25===e){e=new Int32Array(4+64*this.ud.length);const p=
new Uint8Array(e.buffer);e[0]=f(this.ud.length);for(let r=0;r<this.ud.length;r++){const {name:q,data:u}=this.ud[r],A=4+64*r;n(65536>49152+r);e[A>>2]=f(u.length);e[A+4>>2]=l(49152+r);n(56>q.length);for(let v=0;v<q.length;v++)p[A+8+v]=q.charCodeAt(v)}this.Ua=p}else 32768<=e&&49152>e?this.Ua=k(0):49152<=e&&e-49152<this.ud.length?this.Ua=this.ud[e-49152].data:(t("Warning: Unimplemented fw index: "+M(e)),this.Ua=k(0))});P(c,128,this,function(){});this.v={};a.ki&&(this.v.qc=new bd(this),this.v.Qa=new oc(this),
this.S[0]&&(this.v.Ic=new xd(this),this.v.Zc=new md(this),this.v.Na=new id(this)),this.v.Xc=new cd(this),ve(this,this.v.Xc,a),this.v.mb=new xc(this),this.v.Yd=new Jc(this,b,a.da||8388608),this.v.If=new Yc(this,b),this.v.Uf=new fd(this,1016,b),a.ze&&(this.v.ze=new fd(this,760,b)),a.Ae&&(this.v.Ae=new fd(this,1E3,b)),a.Be&&(this.v.Be=new fd(this,744,b)),this.v.yf=new uc(this,a.oa),c=0,a.T&&(this.v.T=new Pb(this,a.T,a.We,!1,c++,b)),a.na&&(this.v.na=new Pb(this,a.na,void 0,!0,c++,b)),this.v.gf=new Cc(this,
b),a.Xh&&(this.v.Ef=new Cd(this,b,a.tc)),a.Vb&&(this.v.Wf=new ma(a.Vb,this,b)),this.v.Mf=new Nd(this,b));a.td&&we(this,a.td);this.debug.fb()};
function we(a,b){t("Trying multiboot from buffer of size "+b.byteLength,2);if(8192>b.byteLength){var c=new Int32Array(2048);(new Uint8Array(c.buffer)).set(new Uint8Array(b))}else c=new Int32Array(b,0,2048);for(var d=0;8192>d;d+=4)if(464367618===c[d>>2]){var e=c[d+4>>2];if(464367618+e+c[d+8>>2]|0)t("Multiboot checksum check failed",2);else{t("Multiboot magic found, flags: "+M(e>>>0,8),2);n(0===(e&-65537),"TODO");a.i[0]=732803074;a.i[3]=31744;a.Eb(31744,0);a.ya[0]=1;a.K[0]=1;a.flags[0]=2;a.F[0]=1;a.P[0]=
1;for(var k=0;6>k;k++)a.Jb[k]=0,a.M[k]=0,a.o[k]=4294967295,a.g[k]=45058;if(e&65536){t("Multiboot specifies its own address table",2);k=c[d+12>>2];var l=c[d+16>>2];e=c[d+20>>2];var f=c[d+24>>2];c=c[d+28>>2];t("header="+M(k,8)+" load="+M(l,8)+" load_end="+M(e,8)+" bss_end="+M(f,8)+" entry="+M(c,8));n(l<=k);d-=k-l;0===e?e=void 0:(n(e>=l),e-=l);b=new Uint8Array(b,d,e);ua(a,b,l);a.D[0]=a.vb()+c|0}else if(1179403647===c[0]){t("Multiboot image is in elf format",2);d=xe(b);a.D[0]=a.vb()+d.hi.Yh|0;for(l of d.Sj)0!==
l.type&&(1===l.type?(n(l.se===l.mh),n(l.Se<=l.$e),l.se+l.$e<a.H[0]?l.Se&&(d=new Uint8Array(b,l.offset,l.Se),ua(a,d,l.se)):t("Warning: Skipped loading section, paddr="+M(l.se)+" memsz="+l.$e,2)):2!==l.type&&3!==l.type&&4!==l.type&&6!==l.type&&1685382480!==l.type&&1685382481!==l.type&&1685382483!==l.type&&n(!1,"unimplemented elf section type: "+M(l.type)))}else n(!1,"Not a bootable multiboot format");a.u.ac(244,a,function(p){console.log("Test exited with code "+M(p,2));throw"HALT";},function(){},function(){},
function(){});for(let p=14;15>=p;p++)P(a.u,8192+p,a,function(r){t("kvm-unit-test: Set irq "+M(p)+" to "+M(r,2));r?this.Ta(p):Rb(this,p)});t("Starting multiboot kernel at:",2);a.debug.Vh();a.debug.ng();break}}}
function ve(a,b,c){var d=c.cd||531;S(b,56,1|d>>4&240);S(b,61,d&255);S(b,21,128);S(b,22,2);d=0;1048576<=a.H[0]&&(d=a.H[0]-1048576>>10,d=Math.min(d,65535));S(b,23,d&255);S(b,24,d>>8&255);S(b,48,d&255);S(b,49,d>>8&255);d=0;16777216<=a.H[0]&&(d=a.H[0]-16777216>>16,d=Math.min(d,65535));S(b,52,d&255);S(b,53,d>>8&255);S(b,91,0);S(b,92,0);S(b,93,0);S(b,20,47);S(b,95,0);c.$h&&S(b,63,1)}
function Bb(a){var b=a.Kd.Cg,c=a.Kd.Yd;if(b){var d=new Uint8Array(b);ua(a,d,1048576-b.byteLength);if(c){var e=new Uint8Array(c);ua(a,e,786432);qb(a.u,4272947200,1048576,function(k){k=k-4272947200|0;return k<e.length?e[k]:0},function(){n(!1,"Unexpected write to VGA rom")})}else t("Warning: No VGA BIOS");qb(a.u,4293918720,1048576,function(k){return this.Ka[k&1048575]}.bind(a),function(k,l){this.Ka[k&1048575]=l}.bind(a))}else t("Warning: No BIOS")}
function ye(a,b,c,d,e,k){e>>>=0;k>>>=0;n(0<=b&&900>b);const l=new Uint8Array(a.Xa.buffer,e,k);a.Bg[c]=(a.Bg[c]||0)+1;a.zh&&a.zh(l);WebAssembly.instantiate(l,{e:a.ph}).then(f=>{f=f.instance.exports.f;a.ak(b,c,d);a.xa.Xf.set(b+1024,f);a.yh&&a.yh(l)}).catch(f=>{console.log(f);debugger;throw f;})}function xb(a){if(a.C()&512){const b=zb(a,yb());Ab(a);return b}return 100}
function zb(a,b){var c=a.v.gf.Cb(b,!1);var d=a.v.Xc.Cb(b,!1);let e=100,k=100;a.S[0]&&(e=a.v.Na.Cb(b),k=a.v.Zc.Cb(b));return Math.min(c,d,100,e,k)}function Ab(a){a.C()&512&&(ze(a),a.qh())}function ze(a){n(a.C()&512);a.v.qc&&a.v.qc.Zd();a.v.Zc&&a.v.Zc.Zd()}ub.prototype.Ta=function(a){n(1===arguments.length);this.v.qc&&this.v.qc.Wd(a);this.v.Ic&&this.v.Ic.Wd(a)};function Rb(a,b){a.v.qc&&a.v.qc.$d(b);a.v.Ic&&a.v.Ic.$d(b)}
"undefined"!==typeof window?window.CPU=ub:"undefined"!==typeof module&&"undefined"!==typeof module.exports?module.exports.CPU=ub:"function"===typeof importScripts&&(self.CPU=ub);function se(a){function b(q){for(var u=k.K[0]?"prot":"real",A=k.Ac(),v=k.nh(),w=k.U[0],y=M(k.g[1],4)+":"+M(k.kk()>>>0,8),z=M(k.g[2],4)+":"+M(k.i[0]>>>0,8),D=k.F[0]?"32":"16",H=k.flags[0]&512?1:0,L={[1]:"c",[4]:"p",[16]:"a",[64]:"z",[128]:"s",[256]:"t",[512]:"i",[1024]:"d",[2048]:"o"},U="",O=0;16>O;O++)L[1<<O]&&(U=A&1<<O?U+L[1<<O]:U+" ");return"mode="+u+"/"+D+" paging="+ +(0!==(k.ya[0]&-2147483648))+" pae="+ +(0!==(k.ya[4]&32))+" iopl="+v+" cpl="+w+" if="+H+" cs:eip="+y+" cs_off="+M(k.vb()>>>0,8)+
" flgs="+M(k.Ac()>>>0,6)+" ("+U+") ss:esp="+z+" ssize="+ +k.P[0]+(q?" in "+q:"")}function c(){for(var q={eax:0,ecx:1,edx:2,ebx:3,esp:4,ebp:5,esi:6,edi:7},u="eax ecx edx ebx esp ebp esi edi".split(" "),A="",v="",w=0;4>w;w++)A+=u[w]+"="+M(k.i[q[u[w]]]>>>0,8)+" ",v+=u[w+4]+"="+M(k.i[q[u[w+4]]]>>>0,8)+" ";A+="  ds="+M(k.g[3],4)+" es="+M(k.g[0],4)+" fs="+M(k.g[4],4);v+="  gs="+M(k.g[5],4)+" cs="+M(k.g[1],4)+" ss="+M(k.g[2],4);return[A,v]}function d(q,u,A){if(!(q&1))return!1;var v=128===(q&128);return{size:v,
global:256===(q&256),$f:32===(q&32),Nh:64===(q&64),dg:16===(q&16),lh:4===(q&4),bh:2===(q&2),Ie:(v&&!A?q&(u?4292870144:4290772992):q&4294963200)>>>0}}function e(q,u,A){for(var v=u?512:1024,w=u?8:4,y=u?21:22,z=0;z<v;z++){var D=k.h(q+z*w),H=d(D,u,!0);if(H)if(D="",D+=H.size?"S ":"  ",D+=H.$f?"A ":"  ",D+=H.dg?"Cd ":"  ",D+=H.lh?"U ":"  ",D+=H.bh?"Rw ":"   ",H.size)t("=== "+M(A+(z<<y)>>>0,8)+" -> "+M(H.Ie>>>0,8)+" | "+D);else{t("=== "+M(A+(z<<y)>>>0,8)+" | "+D);for(var L=0;L<v;L++){var U=H.Ie+L*w;D=k.h(U);
var O=d(D,u,!1);O&&(D="",D+=O.dg?"Cd ":"   ",D+=O.lh?"U ":"  ",D+=O.bh?"Rw ":"   ",D+=O.global?"G ":"  ",D+=O.$f?"A ":"  ",D+=O.Nh?"Di ":"   ",t("# "+M(A+(z<<y|L<<12)>>>0,8)+" -> "+M(O.Ie,8)+" | "+D+"        (at "+M(U,8)+")"))}}}}var k=a,l={};a.debug=l;l.fb=function(){function q(A){10===A?(t(u,4096),u=""):u+=String.fromCharCode(A)}if(k.u){var u="";P(k.u,1026,this,q);P(k.u,1280,this,q)}};l.ci=c;l.ng=function(){var q=c();t(q[0],2);t(q[1],2)};l.W=b;l.Vh=function(){t(b(void 0),2)};l.tk=function(q,u){var A=
k.i[4];t("========= STACK ==========");if(u>=q||void 0===u)q=5,u=-5;for(;q>u;q--){var v="    ";q||(v="=>  ");v+=M(q,2)+" | ";t(v+M(A+4*q,8)+" | "+M(k.h(A+4*q)>>>0))}};l.Uh=function(){if(k.ya[4]&32){t("PAE enabled");for(var q=0;4>q;q++){var u=k.h(k.ya[3]+8*q);u&1&&e(u&4294963200,!0,q<<30)}}else t("PAE disabled"),e(k.ya[3],!1,0)};l.Sh=function(){function q(u,A){for(var v=0;v<A;v+=8,u+=8){var w=k.sa(u+2)|k.Fa(u+4)<<16|k.Fa(u+7)<<24,y=k.sa(u)|(k.Fa(u+6)&15)<<16,z=k.Fa(u+5),D=k.Fa(u+6)>>4,H="",L=z>>5&
3;H=z&128?H+" P ":H+"NP ";z&16?(H=D&4?H+"32b ":H+"16b ",z&8?(H+="X ",z&4&&(H+="C ")):H+="R ",H+="RW "):H+="sys: "+M(z&15);D&8&&(y=y<<12|4095);t(M(v&-8,4)+" "+M(w>>>0,8)+" ("+M(y>>>0,8)+" bytes) "+H+";  dpl = "+L+", a = "+z.toString(2)+", f = "+D.toString(2))}}t("gdt: (len = "+M(k.B[0])+")");q(k.Kb(k.ub[0]),k.B[0]);t("\nldt: (len = "+M(k.o[7])+")");q(k.Kb(k.M[7]),k.o[7])};l.Th=function(){for(var q=0;q<k.Fb[0];q+=8){var u=k.Kb(k.wb[0]+q),A=k.sa(u)|k.sa(u+6)<<16,v=k.sa(u+2);u=k.Fa(u+5);var w=u>>5&3;
var y=5===(u&31)?"task gate ":14===(u&31)?"intr gate ":15===(u&31)?"trap gate ":"invalid   ";y=u&128?y+" P":y+"NP";t(M(q>>3,4)+" "+M(A>>>0,8)+", "+M(v,4)+"; "+y+";  dpl = "+w+", t = "+u.toString(2))}};l.wk=function(q,u){void 0===q?(q=0,u=k.H[0]):void 0===u&&(u=q,q=0);return k.Ka.slice(q,q+u).buffer};l.Ak=function(q,u){u=u||64;for(var A,v,w=0;w<u>>4;w++){A=M(q+(w<<4),5)+"   ";for(var y=0;16>y;y++)v=k.Fa(q+(w<<4)+y),A+=M(v,2)+" ";A+="  ";for(y=0;16>y;y++)v=k.Fa(q+(w<<4)+y),A+=33>v||126<v?".":String.fromCharCode(v);
t(A)}};l.Ik=function(){for(var q=k.H[0]/128/16|0,u,A=0;16>A;A++){u=M(128*A*q,8)+" | ";for(var v=0;128>v;v++)u+=0<k.Gb[(128*A+v)*q]?"X":" ";t(u)}};l.rk=function(){};let f,p;l.sk=function(q,u,A){if(!p){if(void 0===f&&(f="function"===typeof require?require("./capstone-x86.min.js"):window.cs,void 0===f)){t("Warning: Missing capstone library, disassembly not available");return}p=[new f.Capstone(f.ARCH_X86,f.MODE_16),new f.Capstone(f.ARCH_X86,f.MODE_32)]}try{p[q].disasm(u,A).forEach(function(v){t(M(v.Ie>>>
0)+": "+bb(v.bytes.map(w=>M(w,2).slice(-2)).join(" "),20)+" "+v.mnemonic+" "+v.op_str)}),t("")}catch(v){t("Could not disassemble: "+Array.from(u).map(w=>M(w,2)).join(" "))}};let r;l.uk=function(q){if(void 0===r&&(r="function"===typeof require?require("./libwabt.js"):new window.WabtModule,void 0===r)){t("Warning: Missing libwabt, wasm dump not available");return}q=q.slice();try{var u=r.readWasm(q,{Fk:!1});u.generateNames();u.applyNames();const w=u.toText({vk:!0,yk:!0});t(w)}catch(w){var A=new Blob([q]),
v=document.createElement("a");v.download="failed.wasm";v.href=window.URL.createObjectURL(A);v.dataset.downloadurl=["application/octet-stream",v.download,v.href].join(":");v.click();window.URL.revokeObjectURL(v.src);console.log(w.toString())}finally{u&&u.Da()}}};let Ae=DataView.prototype,Be={size:1,get:Ae.getUint8,set:Ae.setUint8},Ce={size:2,get:Ae.getUint16,set:Ae.setUint16},Y={size:4,get:Ae.getUint32,set:Ae.setUint32},Ee=De([{li:Y},{Hh:Be},{data:Be},{dk:Be},{Ck:Be},{qk:Be},{Dk:function(a){return{size:a,get:()=>-1}}(7)},{type:Ce},{zk:Ce},{ek:Y},{Yh:Y},{ti:Y},{Wj:Y},{flags:Y},{Wh:Ce},{Kg:Ce},{Lg:Ce},{gh:Ce},{hh:Ce},{Hk:Ce}]);console.assert(52===Ee.reduce((a,b)=>a+b.size,0));let Fe=De([{type:Y},{offset:Y},{mh:Y},{se:Y},{Se:Y},{$e:Y},{flags:Y},{align:Y}]);
console.assert(32===Fe.reduce((a,b)=>a+b.size,0));let Ge=De([{name:Y},{type:Y},{flags:Y},{Bh:Y},{offset:Y},{size:Y},{link:Y},{info:Y},{Dh:Y},{Zh:Y}]);console.assert(40===Ge.reduce((a,b)=>a+b.size,0));function De(a){return a.map(function(b){var c=Object.keys(b);console.assert(1===c.length);c=c[0];b=b[c];console.assert(0<b.size);return{name:c,type:b,size:b.size,get:b.get,set:b.set}})}
function xe(a){a=new DataView(a);let [b,c]=He(a,Ee);console.assert(52===c);for(var d of Object.keys(b))t(d+": 0x"+b[d].toString(16));t(b);console.assert(1179403647===b.li,"Bad magic");console.assert(1===b.Hh,"Unimplemented: 64 bit elf");console.assert(1===b.data,"Unimplemented: big endian");console.assert(1===b.dk,"Bad version0");console.assert(2===b.type,"Unimplemented type");console.assert(1===b.ek,"Bad version1");console.assert(52===b.Wh,"Bad header size");console.assert(32===b.Kg,"Bad program header size");
console.assert(40===b.gh,"Bad section header size");[d]=Ie(new DataView(a.buffer,a.byteOffset+b.ti,b.Kg*b.Lg),Fe,b.Lg);[a]=Ie(new DataView(a.buffer,a.byteOffset+b.Wj,b.gh*b.hh),Ge,b.hh);if(ab){console.log("%d program headers:",d.length);for(let e of d)console.log("type=%s offset=%s vaddr=%s paddr=%s filesz=%s memsz=%s flags=%s align=%s",e.type.toString(16),e.offset.toString(16),e.mh.toString(16),e.se.toString(16),e.Se.toString(16),e.$e.toString(16),e.flags.toString(16),e.align.toString(16));console.log("%d program headers:",
a.length);for(let e of a)console.log("name=%s type=%s flags=%s addr=%s offset=%s size=%s link=%s info=%s addralign=%s entsize=%s",e.name.toString(16),e.type.toString(16),e.flags.toString(16),e.Bh.toString(16),e.offset.toString(16),e.size.toString(16),e.link.toString(16),e.info.toString(16),e.Dh.toString(16),e.Zh.toString(16))}return{hi:b,Sj:d,Gk:a}}function He(a,b){let c={},d=0;for(let e of b)b=e.get.call(a,d,!0),console.assert(void 0===c[e.name]),c[e.name]=b,d+=e.size;return[c,d]}
function Ie(a,b,c){let d=[],e=0;for(var k=0;k<c;k++){let [l,f]=He(new DataView(a.buffer,a.byteOffset+e,void 0),b);d.push(l);e+=f}return[d,e]};function ue(a,b,c,d){t("Trying to load kernel of size "+b.byteLength);var e=new Uint8Array(b);const k=new Uint16Array(b);var l=new Uint32Array(b),f=e[497]||4,p=k[255];if(43605!==p)t("Bad checksum1: "+M(p));else if(p=k[257]|k[258]<<16,1400005704!==p)t("Bad checksum2: "+M(p));else{p=k[259];n(514<=p);var r=e[529];n(r&1);var q=k[283],u=l[139],A=l[140],v=e[564],w=e[565],y=l[142],z=l[146],D=l[147],H=l[150],L=l[151],U=l[152];t("kernel boot protocol version: "+M(p));t("flags="+M(r)+" xflags="+M(q));t("code32_start="+
M(l[133]));t("initrd_addr_max="+M(u));t("kernel_alignment="+M(A));t("relocatable="+v);t("min_alignment="+M(w));t("cmdline max="+M(y));t("payload offset="+M(z)+" size="+M(D));t("pref_address="+M(L)+":"+M(H));t("init_size="+M(U));e[528]=255;e[529]=r&-97|128;k[274]=56832;k[253]=65535;t("heap_end_ptr="+M(56832));d+="\x00";n(d.length<y);t("cmd_line_ptr="+M(581632));l[138]=581632;for(e=0;e<d.length;e++)a[581632+e]=d.charCodeAt(e);f=512*(f+1);t("prot_mode_kernel_start="+M(f));d=new Uint8Array(b,0,f);b=new Uint8Array(b,
f);e=f=0;c&&(f=67108864,e=c.byteLength,n(1048576+b.length<f),a.set(new Uint8Array(c),f));l[134]=f;l[135]=e;n(655360>524288+d.length);a.set(d,524288);a.set(b,1048576);a=new Uint8Array(256);(new Uint16Array(a.buffer))[0]=43605;a[2]=1;c=3;a[c++]=250;a[c++]=184;a[c++]=32768;a[c++]=128;a[c++]=142;a[c++]=192;a[c++]=142;a[c++]=216;a[c++]=142;a[c++]=224;a[c++]=142;a[c++]=232;a[c++]=142;a[c++]=208;a[c++]=188;a[c++]=57344;a[c++]=224;a[c++]=234;a[c++]=0;a[c++]=0;a[c++]=32800;a[c++]=128;n(512>c);l=a[c]=0;for(b=
0;b<a.length;b++)l+=a[b];a[c]=-l;return{pi:{name:"genroms/kernel.bin",data:a}}}};var Ia=16384,Oa=4;function Je(a){this.g=[];this.C=[];this.j=a;this.B={Bf:0};this.h={};this.l=274877906944;this.o=0;this.i=[];Ha(this,"",-1)}Je.prototype.W=function(){let a=[];a[0]=this.g;a[1]=this.B.Bf;a[2]=[];for(const [b,c]of Object.entries(this.h))0===(this.g[b].mode&Ia)&&a[2].push([b,c]);a[3]=this.l;a[4]=this.o;return a=a.concat(this.i)};
Je.prototype.G=function(a){this.g=a[0].map(b=>{const c=new Ke(0);c.G(b);return c});this.B.Bf=a[1];this.h={};for(let [b,c]of a[2])c.buffer.byteLength!==c.byteLength&&(c=c.slice()),this.h[b]=c;this.l=a[3];this.o=a[4];this.i=a.slice(5)};function Ca(a,b,c){var d=a.g[b];0==d.status||2==d.status?c():5===d.status?Ca(Z(a,d),d.g,c):a.C.push({id:b,pk:c})}
function Le(a,b){n(b,"Invalid fs passed to load_from_json");if(3!==b.version)throw"The filesystem JSON format has changed. Please update your fs2json (https://github.com/copy/fs2json) and recreate the filesystem JSON.";var c=b.fsroot;a.o=b.size;for(b=0;b<c.length;b++)Me(a,c[b],0)}
function Me(a,b,c){var d=Ne(a);const e=b[0];d.size=b[1];d.pc=b[2];d.Ld=d.pc;d.bd=d.pc;d.mode=b[3];d.uid=b[4];d.Ja=b[5];var k=d.mode&61440;if(k===Ia)for(Oe(a,d,c,e),c=a.g.length-1,b=b[6],d=0;d<b.length;d++)Me(a,b[d],c);else 32768===k?(d.status=2,d.bc=b[6],n(d.bc),Oe(a,d,c,e)):40960===k?(d.Xd=b[6],Oe(a,d,c,e)):49152!==k&&t("Unexpected ifmt: "+M(k)+" ("+e+")")}
function Pe(a,b,c,d){const e=a.g[c],k=a.g[b];n(5!==k.status,"Filesystem: Shouldn't link under fowarder parents");n(Qe(a,b),"Filesystem: Can't link under non-directories");n(5!==e.status||0===e.g,"Filesystem: Can't link across filesystems apart from their root");n(0<=e.ua,"Filesystem: Found negative nlinks value of "+e.ua);n(!k.ea.has(d),"Filesystem: Name '"+d+"' is already taken");k.ea.set(d,c);e.ua++;Qe(a,c)&&(n(!e.ea.has(".."),"Filesystem: Cannot link a directory twice"),e.ea.has(".")||e.ua++,e.ea.set(".",
c),e.ea.set("..",b),k.ua++)}function Re(a,b,c){const d=Va(a,b,c),e=a.g[d],k=a.g[b];n(5!==k.status,"Filesystem: Can't unlink from forwarders");n(Qe(a,b),"Filesystem: Can't unlink from non-directories");k.ea.delete(c)?(e.ua--,Qe(a,d)&&(n(e.ea.get("..")===b,"Filesystem: Found directory with bad parent id"),e.ea.delete(".."),k.ua--),n(0<=e.ua,"Filesystem: Found negative nlinks value of "+e.ua)):n(!1,"Filesystem: Can't unlink non-existent file: "+c)}
function Oe(a,b,c,d){-1!=c?(a.g.push(b),b.Ub=a.g.length-1,Pe(a,c,b.Ub,d)):0==a.g.length?(a.g.push(b),b.ea.set(".",0),b.ea.set("..",0),b.ua=2):(C("Error in Filesystem: Pushed inode with name = "+d+" has no parent"),Ya())}function Ke(a){this.ea=new Map;this.af=this.Ze=this.pc=this.bd=this.Ld=this.Ub=this.Ja=this.uid=this.size=this.status=0;this.Xd="";this.mode=493;this.za={type:0,version:0,path:a};this.ua=0;this.bc="";this.h=[];this.g=this.i=-1}
Ke.prototype.W=function(){const a=[];a[0]=this.mode;a[1]=(this.mode&61440)===Ia?[...this.ea]:32768===(this.mode&61440)?this.bc:40960===(this.mode&61440)?this.Xd:49152===(this.mode&61440)?[this.af,this.Ze]:null;a[2]=this.h;a[3]=this.status;a[4]=this.size;a[5]=this.uid;a[6]=this.Ja;a[7]=this.Ub;a[8]=this.Ld;a[9]=this.bd;a[10]=this.pc;a[11]=this.za.version;a[12]=this.za.path;a[13]=this.ua;return a};
Ke.prototype.G=function(a){this.mode=a[0];if((this.mode&61440)===Ia){this.ea=new Map;for(const [b,c]of a[1])this.ea.set(b,c)}else 32768===(this.mode&61440)?this.bc=a[1]:40960===(this.mode&61440)?this.Xd=a[1]:49152===(this.mode&61440)&&([this.af,this.Ze]=a[1]);this.h=[];for(const b of a[2]){const c=new Se;c.G(b);this.h.push(c)}this.status=a[3];this.size=a[4];this.uid=a[5];this.Ja=a[6];this.Ub=a[7];this.Ld=a[8];this.bd=a[9];this.pc=a[10];this.za.type=(this.mode&61440)>>8;this.za.version=a[11];this.za.path=
a[12];this.ua=a[13]};function Te(a,b){Object.assign(b,a,{Ub:b.Ub,ea:b.ea,ua:b.ua})}function Ne(a){const b=Math.round(Date.now()/1E3);a=new Ke(++a.B.Bf);a.bd=a.Ld=a.pc=b;return a}function Ha(a,b,c){var d=a.g[c];if(0<=c&&5===d.status)return c=d.g,b=Ha(Z(a,d),b,c),Ue(a,d.i,b);d=Ne(a);d.mode=511|Ia;0<=c&&(d.uid=a.g[c].uid,d.Ja=a.g[c].Ja,d.mode=a.g[c].mode&511|Ia);d.za.type=Ia>>8;Oe(a,d,c,b);return a.g.length-1}
function Ja(a,b,c){var d=a.g[c];if(5===d.status)return c=d.g,b=Ja(Z(a,d),b,c),Ue(a,d.i,b);d=Ne(a);d.uid=a.g[c].uid;d.Ja=a.g[c].Ja;d.za.type=128;d.mode=a.g[c].mode&438|32768;Oe(a,d,c,b);return a.g.length-1}function Ga(a,b,c,d,e){var k=a.g[c];if(5===k.status)return c=k.g,b=Ga(Z(a,k),b,c,d,e),Ue(a,k.i,b);k=Ne(a);k.Ze=d;k.af=e;k.uid=a.g[c].uid;k.Ja=a.g[c].Ja;k.za.type=192;k.mode=a.g[c].mode&438;Oe(a,k,c,b);return a.g.length-1}
function Fa(a,b,c,d){var e=a.g[c];if(5===e.status)return c=e.g,b=Fa(Z(a,e),b,c,d),Ue(a,e.i,b);e=Ne(a);e.uid=a.g[c].uid;e.Ja=a.g[c].Ja;e.za.type=160;e.Xd=d;e.mode=40960;Oe(a,e,c,b);return a.g.length-1}async function Ve(a,b,c,d){var e=a.g[c];if(5===e.status)return c=e.g,d=await Ve(Z(a,e),b,c,d),Ue(a,e.i,d);e=Ja(a,b,c);b=a.g[e];c=new Uint8Array(d.length);c.set(d);await We(a,e,c);b.size=d.length;return e}
function Ba(a,b,c){var d=a.g[b];if(5===d.status)return Ba(Z(a,d),d.g,c);(d.mode&61440)==Ia&&Xe(a,b);return!0}async function Xa(a,b){var c=a.g[b];if(5===c.status)return await Xa(Z(a,c),c.g);2===c.status&&a.j.g(c.bc);c.status==Oa&&(c.status=-1,await Ye(a,b))}
async function Ta(a,b,c,d,e){if(b==d&&c==e)return 0;var k=Va(a,b,c);if(-1===k)return-2;var l=b;n(Qe(a,l),"Filesystem: Cannot get full path of non-directory inode");for(var f="";0!=l;)f="/"+Ze(a,l)+f,l=$e(a,l);if(-1!=Va(a,d,e)&&(l=Wa(a,d,e),0>l))return l;f=a.g[k];var p=a.g[b];l=a.g[d];if(5===p.status||5===l.status)if(5===p.status&&p.i===l.i){if(a=await Ta(Z(a,p),p.g,c,l.g,e),0>a)return a}else{if(0===Aa(a,k).Ub)return t("XXX: Attempted to move mountpoint ("+c+") - skipped",4194304),-1;if(!Qe(a,k)&&
1<Aa(a,k).ua)return t("XXX: Attempted to move hardlinked file ("+c+") across filesystems - skipped",4194304),-1;p=Va(a,b,c);var r=a.g[p],q=new Ke(-1);n(r,"Filesystem divert: name ("+c+") not found");n(Qe(a,p)||1>=r.ua,"Filesystem: can't divert hardlinked file '"+c+"' with nlinks="+r.ua);Object.assign(q,r);const u=a.g.length;a.g.push(q);q.Ub=u;5===r.status&&a.i[r.i].g.set(r.g,u);if(5!==r.status||0===r.g)Re(a,b,c),Pe(a,b,u,c);if(Qe(a,p)&&5!==r.status)for(const [A,v]of q.ea)"."!==A&&".."!==A&&Qe(a,v)&&
a.g[v].ea.set("..",u);a.h[u]=a.h[p];delete a.h[p];r.ea=new Map;r.ua=0;p=u;r=Aa(a,k);q=await Ra(a,p,0,r.size);5===l.status?(d=Z(a,l),e=Qe(a,p)?Ha(d,e,l.g):Ja(d,e,l.g),d=Aa(d,e),Te(r,d),af(a,k,l.i,e)):(n(5===f.status,"Filesystem delete_forwarder: expected forwarder"),f.status=-1,a.i[f.i].g.delete(f.g),Te(r,f),Pe(a,d,k,e));await Pa(a,k,r.size);q&&q.length&&await Sa(a,k,0,q.length,q);if(Qe(a,k))for(const A of bf(a,p))if(e=await Ta(a,p,A,k,A),0>e)return e;await Ye(a,p);a=Wa(a,b,c);if(0>a)return a}else Re(a,
b,c),Pe(a,d,k,e),f.za.version++;return 0}async function Sa(a,b,c,d,e){var k=a.g[b];if(5===k.status)b=k.g,await Sa(Z(a,k),b,c,d,e);else{var l=await a.Wb(b);!l||l.length<c+d?(await Pa(a,b,Math.floor(3*(c+d)/2)),k.size=c+d,l=await a.Wb(b)):k.size<c+d&&(k.size=c+d);e&&l.set(e.subarray(0,d),c);await We(a,b,l)}}async function Ra(a,b,c,d){const e=a.g[b];return 5===e.status?(b=e.g,await Ra(Z(a,e),b,c,d)):await cf(a,b,c,d)}
function Va(a,b,c){b=a.g[b];if(5===b.status){const d=b.g;c=Va(Z(a,b),d,c);return-1===c?-1:df(a,b.i,c)}a=b.ea.get(c);return void 0===a?-1:a}function ya(a){let b=a.g.length;for(const {h:c,g:d}of a.i)b+=ya(c),b-=d.size;return b}function za(a){let b=1048576;for(const {h:c}of a.i)b+=za(c);return b}function wa(a){let b=a.o;for(const {h:c}of a.i)b+=wa(c);return b}function xa(a){let b=a.l;for(const {h:c}of a.i)b+=xa(c);return a.l}
function Ze(a,b){const c=a.g[$e(a,b)];if(5===c.status)return Ze(Z(a,c),a.g[b].g);if(!c)return"";for(const [d,e]of c.ea)if(e===b)return d;n(!1,"Filesystem: Found directory inode whose parent doesn't link to it");return""}
function Da(a,b,c,d){if(Qe(a,c))return-1;const e=a.g[b],k=a.g[c];if(5===e.status)return 5!==k.status||k.i!==e.i?(t("XXX: Attempted to hardlink a file into a child filesystem - skipped",4194304),-1):Da(Z(a,e),e.g,k.g,d);if(5===k.status)return t("XXX: Attempted to hardlink file across filesystems - skipped",4194304),-1;Pe(a,b,c,d);return 0}
function Wa(a,b,c){if("."===c||".."===c)return-1;var d=Va(a,b,c);const e=a.g[d];var k=a.g[b];if(5===k.status)return n(5===e.status,"Children of forwarders should be forwarders"),b=k.g,Wa(Z(a,k),b,c);if(k=Qe(a,d)){a:if(d=a.g[d],5===d.status)var l=Qe(Z(a,d),d.g);else{for(l of d.ea.keys())if("."!==l&&".."!==l){l=!1;break a}l=!0}k=!l}if(k)return-39;Re(a,b,c);0===e.ua&&(e.status=Oa);return 0}async function Ye(a,b){const c=a.g[b];5===c.status?await Ye(Z(a,c),c.g):(c.size=0,delete a.h[b])}
Je.prototype.Wb=async function(a){const b=this.g[a];n(b,`Filesystem get_buffer: idx ${a} does not point to an inode`);return this.h[a]?this.h[a]:2===b.status?(n(b.bc,"Filesystem get_data: found inode on server without sha256sum"),await this.j.read(b.bc,0,b.size)):null};
async function cf(a,b,c,d){const e=a.g[b];n(e,`Filesystem get_data: idx ${b} does not point to an inode`);return a.h[b]?a.h[b].subarray(c,c+d):2===e.status?(n(e.bc,"Filesystem get_data: found inode on server without sha256sum"),await a.j.read(e.bc,c,d)):null}async function We(a,b,c){a.h[b]=c;2===a.g[b].status&&(a.g[b].status=0,a.j.g(a.g[b].bc))}
function Aa(a,b){n(!isNaN(b),"Filesystem GetInode: NaN idx");n(0<=b&&b<a.g.length,"Filesystem GetInode: out of range idx:"+b);b=a.g[b];return 5===b.status?Aa(Z(a,b),b.g):b}async function Pa(a,b,c){var d=Aa(a,b),e=await cf(a,b,0,d.size);if(c!=d.size){var k=new Uint8Array(c);d.size=c;e&&k.set(e.subarray(0,Math.min(e.length,d.size)),0);await We(a,b,k)}}
function ef(a,b){b=b.replace("//","/");b=b.split("/");0<b.length&&0===b[b.length-1].length&&b.pop();0<b.length&&0===b[0].length&&b.shift();const c=b.length;var d=-1,e=0;let k=null;for(var l=0;l<c;l++)if(d=e,e=Va(a,d,b[l]),!k&&5===a.g[d].status&&(k="/"+b.slice(l).join("/")),-1==e)return l<c-1?{id:-1,Gf:-1,name:b[l],qg:k}:{id:-1,Gf:d,name:b[l],qg:k};return{id:e,Gf:d,name:b[l],qg:k}}
function Xe(a,b){var c=a.g[b];if(5===c.status)Xe(Z(a,c),c.g);else{var d=0;for(const e of c.ea.keys())d+=24+ff(e);b=a.h[b]=new Uint8Array(d);c.size=d;d=0;for(const [e,k]of c.ea)c=Aa(a,k),d+=B(["Q","d","b","s"],[c.za,d+13+8+1+2+ff(e),c.mode>>12,e],b,d)}}
function Qa(a,b,c){a=a.h[b];n(a,`FS directory data for dirid=${b} should be generated`);n(a.length,"FS directory should have at least an entry");if(c>=a.length)return a.length;for(b=0;;){const d=K(["Q","d"],a,{offset:b})[1];if(d>c)break;b=d}return b}function Qe(a,b){b=a.g[b];return 5===b.status?Qe(Z(a,b),b.g):(b.mode&61440)===Ia}
function bf(a,b){n(Qe(a,b),"Filesystem: cannot get children of non-directory inode");b=a.g[b];if(5===b.status)return bf(Z(a,b),b.g);a=[];for(const c of b.ea.keys())"."!==c&&".."!==c&&a.push(c);return a}function $e(a,b){n(Qe(a,b),"Filesystem: cannot get parent of non-directory inode");b=a.g[b];if(5!==b.status||0===b.g)return b.ea.get("..");const c=$e(Z(a,b),b.g);n(-1!==c,"Filesystem: should not have invalid parent ids");return df(a,b.i,c)}
function af(a,b,c,d){const e=a.g[b];n(0===e.ua,"Filesystem: attempted to convert an inode into forwarder before unlinking the inode");5===e.status&&a.i[e.i].g.delete(e.g);e.status=5;e.i=c;e.g=d;a.i[c].g.set(d,b)}function Ue(a,b,c){const d=Ne(a),e=a.g.length;a.g.push(d);d.Ub=e;af(a,e,b,c);return e}function df(a,b,c){var d=a.i[b];n(0<=c,"Filesystem get_forwarder: invalid foreign_id: "+c);n(d,"Filesystem get_forwarder: invalid mount number: "+b);d=d.g.get(c);return void 0===d?Ue(a,b,c):d}
function Z(a,b){a=a.i[b.i];n(5===b.status,"Filesystem follow_fs: inode should be a forwarding inode");n(a,"Filesystem follow_fs: inode<id="+b.Ub+"> should point to valid mounted FS");return a.h}function Se(){this.type=2;this.start=0;this.length=Infinity;this.g=-1;this.h=""}Se.prototype.W=function(){const a=[];a[0]=this.type;a[1]=this.start;a[2]=Infinity===this.length?0:this.length;a[3]=this.g;a[4]=this.h;return a};
Se.prototype.G=function(a){this.type=a[0];this.start=a[1];this.length=0===a[2]?Infinity:a[2];this.g=a[3];this.h=a[4]};function gf(a){const b=new Se;b.G(a.W());return b}function hf(a,b){return a.g===b.g&&a.h===b.h||2===a.type||2===b.type||1!==a.type&&1!==b.type||a.start+a.length<=b.start||b.start+b.length<=a.start?!1:!0}function jf(a,b){return b.g===a.g&&b.h===a.h&&b.type===a.type}function kf(a,b){return jf(a,b)&&b.start+b.length===a.start}
function Ka(a,b,c,d,e){n(0===a||1===a||2===a,"Filesystem: Invalid lock type: "+a);n(0<=b,"Filesystem: Invalid negative lock starting offset: "+b);n(0<c,"Filesystem: Invalid non-positive lock length: "+c);const k=new Se;k.type=a;k.start=b;k.length=c;k.g=d;k.h=e;return k}function Na(a,b,c){b=a.g[b];if(5===b.status){var d=b.g;return Na(Z(a,b),d,c)}for(d of b.h)if(hf(c,d))return gf(d);return null}
function La(a,b,c,d){const e=a.g[b];if(5===e.status)return b=e.g,La(Z(a,e),b,c,d);c=gf(c);if(2!==c.type&&Na(a,b,c))return 1;for(a=0;a<e.h.length;a++){d=e.h[a];n(0<d.length,"Filesystem: Found non-positive lock region length: "+d.length);n(0===d.type||1===d.type,"Filesystem: Found invalid lock type: "+d.type);n(!e.h[a-1]||e.h[a-1].start<=d.start,"Filesystem: Locks should be sorted by starting offset");if(d.start+d.length<=c.start)continue;if(c.start+c.length<=d.start)break;if(d.g!==c.g||d.h!==c.h){n(!hf(d,
c),"Filesytem: Found conflicting lock region, despite already checked for conflicts");continue}b=c.start+c.length;const k=c.start-d.start,l=d.start+d.length-b;if(0<k&&0<l&&d.type===c.type)return 0;0<k&&(d.length=k);if(0>=k&&0<l)d.start=b,d.length=l;else if(0<l){for(;a<e.h.length&&e.h[a].start<b;)a++;e.h.splice(a,0,Ka(d.type,b,l,d.g,d.h))}else 0>=k&&(e.h.splice(a,1),a--)}if(2!==c.type){a=c;d=!1;for(b=0;b<e.h.length&&!(kf(a,e.h[b])&&(e.h[b].length+=c.length,a=e.h[b],d=!0),c.start<=e.h[b].start);b++);
d||(e.h.splice(b,0,a),b++);for(;b<e.h.length;b++)if(jf(e.h[b],a)){kf(e.h[b],a)&&(a.length+=e.h[b].length,e.h.splice(b,1));break}}return 0}function lf(a,b){b=ef(a,b);if(-1!==b.id)return a=Aa(a,b.id),Array.from(a.ea.keys()).filter(c=>"."!==c&&".."!==c)}Je.prototype.we=function(a){a=ef(this,a);if(-1===a.id)return Promise.resolve(null);const b=Aa(this,a.id);return Ra(this,a.id,0,b.size)};function C(a){t([].slice.apply(arguments).join(" "),4194304)}function Ya(){throw Error("message.Abort()");};function B(a,b,c,d){for(var e,k=0,l=0;l<a.length;l++)switch(e=b[l],a[l]){case "w":c[d++]=e&255;c[d++]=e>>8&255;c[d++]=e>>16&255;c[d++]=e>>24&255;k+=4;break;case "d":c[d++]=e&255;c[d++]=e>>8&255;c[d++]=e>>16&255;c[d++]=e>>24&255;c[d++]=0;c[d++]=0;c[d++]=0;c[d++]=0;k+=8;break;case "h":c[d++]=e&255;c[d++]=e>>8;k+=2;break;case "b":c[d++]=e;k+=1;break;case "s":var f=d,p=0;c[d++]=0;c[d++]=0;k+=2;for(var r of e)mf(r.charCodeAt(0)).forEach(function(q){c[d++]=q;k+=1;p++});c[f+0]=p&255;c[f+1]=p>>8&255;break;
case "Q":B(["b","w","d"],[e.type,e.version,e.path],c,d);d+=13;k+=13;break;default:C("Marshall: Unknown type="+a[l])}return k}
function K(a,b,c){let d=c.offset;for(var e=[],k=0;k<a.length;k++)switch(a[k]){case "w":var l=b[d++];l+=b[d++]<<8;l+=b[d++]<<16;l+=b[d++]<<24>>>0;e.push(l);break;case "d":l=b[d++];l+=b[d++]<<8;l+=b[d++]<<16;l+=b[d++]<<24>>>0;d+=4;e.push(l);break;case "h":l=b[d++];e.push(l+(b[d++]<<8));break;case "b":e.push(b[d++]);break;case "s":l=b[d++];l+=b[d++]<<8;for(var f="",p=new nf,r=0;r<l;r++){var q=p.i(b[d++]);-1!=q&&(f+=String.fromCharCode(q))}e.push(f);break;case "Q":c.offset=d;l=K(["b","w","d"],b,c);d=
c.offset;e.push({type:l[0],version:l[1],path:l[2]});break;default:C("Error in Unmarshall: Unknown type="+a[k])}c.offset=d;return e};function nf(){this.g=new Uint8Array(5);this.h=0;this.i=function(a){this.g[this.h]=a;this.h++;switch(this.h){case 1:if(128>this.g[0])return this.h=0,this.g[0];break;case 2:if(192==(this.g[0]&224)&&128==(this.g[1]&192))return this.h=0,(this.g[0]&31)<<6|this.g[1]&63}return-1}}function mf(a){if(128>a)return[a];if(2048>a)return[192|a>>6&31,128|a&63]}function ff(a){for(var b=0,c=0;c<a.length;c++)b+=128>a.charCodeAt(c)?1:2;return b};function of(a){function b(v){!v.altKey&&f[56]&&k(56,!1);return e(v,!1)}function c(v){!v.altKey&&f[56]&&k(56,!1);return e(v,!0)}function d(){for(var v=Object.keys(f),w,y=0;y<v.length;y++)w=+v[y],f[w]&&k(w,!1);f={}}function e(v,w){if(p.A&&(v.shiftKey&&v.ctrlKey&&(73===v.keyCode||74===v.keyCode||75===v.keyCode)||!p.Re?0:v.target?v.target.classList.contains("phone_keyboard")||"INPUT"!==v.target.nodeName&&"TEXTAREA"!==v.target.nodeName:1)){a:{if(void 0!==v.code){var y=A[v.code];if(void 0!==y)break a}y=
r[v.keyCode]}if(y)return k(y,w,v.repeat),v.preventDefault&&v.preventDefault(),!1;console.log("Missing char in map: keyCode="+(v.keyCode||-1).toString(16)+" code="+v.code)}}function k(v,w,y){if(w)f[v]&&!y&&k(v,!1);else if(!f[v])return;(f[v]=w)||(v|=128);255<v?(l(v>>8),l(v&255)):l(v)}function l(v){p.A.send("keyboard-code",v)}var f={},p=this;this.Re=!0;var r=new Uint16Array([0,0,0,0,0,0,0,0,14,15,0,0,0,28,0,0,42,29,56,0,58,0,0,0,0,0,0,1,0,0,0,0,57,57417,57425,57423,57415,57419,57416,57421,80,0,0,0,0,
82,83,0,11,2,3,4,5,6,7,8,9,10,0,39,0,13,0,0,0,30,48,46,32,18,33,34,35,23,36,37,38,50,49,24,25,16,19,31,20,22,47,17,45,21,44,57435,57436,57437,0,0,82,79,80,81,75,76,77,71,72,73,0,0,0,0,0,0,59,60,61,62,63,64,65,66,67,68,87,88,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,69,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,0,39,13,51,12,52,53,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,26,43,27,40,0,57435,57400,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),q={8:8,10:13,32:32,39:222,
44:188,45:189,46:190,47:191,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,59:186,61:187,91:219,92:220,93:221,96:192,97:65,98:66,99:67,100:68,101:69,102:70,103:71,104:72,105:73,106:74,107:75,108:76,109:77,110:78,111:79,112:80,113:81,114:82,115:83,116:84,117:85,118:86,119:87,120:88,121:89,122:90},u={33:49,34:222,35:51,36:52,37:53,38:55,40:57,41:48,42:56,43:187,58:186,60:188,62:190,63:191,64:50,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,
81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,94:54,95:189,123:219,124:220,125:221,126:192},A={Escape:1,Digit1:2,Digit2:3,Digit3:4,Digit4:5,Digit5:6,Digit6:7,Digit7:8,Digit8:9,Digit9:10,Digit0:11,Minus:12,Equal:13,Backspace:14,Tab:15,KeyQ:16,KeyW:17,KeyE:18,KeyR:19,KeyT:20,KeyY:21,KeyU:22,KeyI:23,KeyO:24,KeyP:25,BracketLeft:26,BracketRight:27,Enter:28,ControlLeft:29,KeyA:30,KeyS:31,KeyD:32,KeyF:33,KeyG:34,KeyH:35,KeyJ:36,KeyK:37,KeyL:38,Semicolon:39,Quote:40,Backquote:41,ShiftLeft:42,
Backslash:43,KeyZ:44,KeyX:45,KeyC:46,KeyV:47,KeyB:48,KeyN:49,KeyM:50,Comma:51,Period:52,Slash:53,ShiftRight:54,NumpadMultiply:55,AltLeft:56,Space:57,CapsLock:58,F1:59,F2:60,F3:61,F4:62,F5:63,F6:64,F7:65,F8:66,F9:67,F10:68,NumLock:69,ScrollLock:70,Numpad7:71,Numpad8:72,Numpad9:73,NumpadSubtract:74,Numpad4:75,Numpad5:76,Numpad6:77,NumpadAdd:78,Numpad1:79,Numpad2:80,Numpad3:81,Numpad0:82,NumpadDecimal:83,IntlBackslash:86,F11:87,F12:88,NumpadEnter:57372,ControlRight:57373,NumpadDivide:57397,AltRight:57400,
Home:57415,ArrowUp:57416,PageUp:57417,ArrowLeft:57419,ArrowRight:57421,End:57423,ArrowDown:57424,PageDown:57425,Insert:57426,Delete:57427,OSLeft:57435,OSRight:57436,ContextMenu:57437};this.A=a;this.Da=function(){"undefined"!==typeof window&&(window.removeEventListener("keyup",b,!1),window.removeEventListener("keydown",c,!1),window.removeEventListener("blur",d,!1))};this.fb=function(){"undefined"!==typeof window&&(this.Da(),window.addEventListener("keyup",b,!1),window.addEventListener("keydown",c,
!1),window.addEventListener("blur",d,!1))};this.fb();this.g=function(v){v={keyCode:v};e(v,!0);e(v,!1)};this.Yj=function(v){var w=v.charCodeAt(0);w in q?this.g(q[w]):w in u?(l(42),this.g(u[w]),l(170)):console.log("ascii -> keyCode not found: ",w,v)}};function pf(a,b){function c(z){if(!y.enabled||!y.Re)return!1;var D=b||document.body,H;if(!(H=document.pointerLockElement))a:{for(z=z.target;z.parentNode;){if(z===D){H=!0;break a}z=z.parentNode}H=!1}return H}function d(z){c(z)&&(z=z.changedTouches)&&z.length&&(z=z[z.length-1],v=z.clientX,w=z.clientY)}function e(){if(q||A||u)y.A.send("mouse-click",[!1,!1,!1]),q=A=u=!1}function k(z){if(y.A&&c(z)){var D=0,H=0,L=z.changedTouches;L?L.length&&(L=L[L.length-1],D=L.clientX-v,H=L.clientY-w,v=L.clientX,w=L.clientY,
z.preventDefault()):"number"===typeof z.movementX?(D=z.movementX,H=z.movementY):"number"===typeof z.webkitMovementX?(D=z.webkitMovementX,H=z.webkitMovementY):"number"===typeof z.mozMovementX?(D=z.mozMovementX,H=z.mozMovementY):(D=z.clientX-v,H=z.clientY-w,v=z.clientX,w=z.clientY);y.A.send("mouse-delta",[.15*D,-(.15*H)]);b&&y.A.send("mouse-absolute",[z.pageX-b.offsetLeft,z.pageY-b.offsetTop,b.offsetWidth,b.offsetHeight])}}function l(z){c(z)&&p(z,!0)}function f(z){c(z)&&p(z,!1)}function p(z,D){y.A&&
(1===z.which?q=D:2===z.which?A=D:3===z.which?u=D:t("Unknown event.which: "+z.which),y.A.send("mouse-click",[q,A,u]),z.preventDefault())}function r(z){if(c(z)){var D=z.wheelDelta||-z.detail;0>D?D=-1:0<D&&(D=1);y.A.send("mouse-wheel",[D,0]);z.preventDefault()}}var q=!1,u=!1,A=!1,v=0,w=0,y=this;this.enabled=!1;this.Re=!0;this.A=a;this.A.register("mouse-enable",function(z){this.enabled=z},this);this.Da=function(){"undefined"!==typeof window&&(window.removeEventListener("touchstart",d,!1),window.removeEventListener("touchend",
e,!1),window.removeEventListener("touchmove",k,!1),window.removeEventListener("mousemove",k,!1),window.removeEventListener("mousedown",l,!1),window.removeEventListener("mouseup",f,!1),window.removeEventListener("wheel",r,{passive:!1}))};this.fb=function(){"undefined"!==typeof window&&(this.Da(),window.addEventListener("touchstart",d,!1),window.addEventListener("touchend",e,!1),window.addEventListener("touchmove",k,!1),window.addEventListener("mousemove",k,!1),window.addEventListener("mousedown",l,
!1),window.addEventListener("mouseup",f,!1),window.addEventListener("wheel",r,{passive:!1}))};this.fb()};function qf(a){if("undefined"!==typeof window)if(window.AudioContext||window.webkitAudioContext){var b=window.AudioWorklet?rf:sf;this.A=a;this.N=window.AudioContext?new AudioContext:new webkitAudioContext;this.bf=new tf(a,this.N);this.g=new uf(a,this.N,this.bf);new b(a,this.N,this.bf);this.g.start();a.register("emulator-stopped",function(){this.N.suspend()},this);a.register("emulator-started",function(){this.N.resume()},this);a.register("speaker-confirm-initialized",function(){a.send("speaker-has-initialized")},
this);a.send("speaker-has-initialized")}else console.warn("Web browser doesn't support Web Audio API")}
function tf(a,b){function c(d){return function(e){d.gain.setValueAtTime(e,this.N.currentTime)}}this.N=b;this.sources=new Map;this.tg=this.sg=this.F=this.D=this.B=1;this.i=this.N.createBiquadFilter();this.j=this.N.createBiquadFilter();this.i.type="highshelf";this.j.type="highshelf";this.i.frequency.setValueAtTime(2E3,this.N.currentTime);this.j.frequency.setValueAtTime(2E3,this.N.currentTime);this.g=this.N.createBiquadFilter();this.h=this.N.createBiquadFilter();this.g.type="lowshelf";this.h.type="lowshelf";
this.g.frequency.setValueAtTime(200,this.N.currentTime);this.h.frequency.setValueAtTime(200,this.N.currentTime);this.l=this.N.createGain();this.o=this.N.createGain();this.C=this.N.createChannelMerger(2);this.I=this.i;this.K=this.j;this.i.connect(this.g);this.g.connect(this.l);this.l.connect(this.C,0,0);this.j.connect(this.h);this.h.connect(this.o);this.o.connect(this.C,0,1);this.C.connect(this.N.destination);a.register("mixer-connect",function(d){vf(this,d[0],d[1])},this);a.register("mixer-disconnect",
function(d){wf(this,d[0],d[1])},this);a.register("mixer-volume",function(d){var e=d[0],k=d[1];d=Math.pow(10,d[2]/20);var l=0===e?this:this.sources.get(e);void 0===l?n(!1,"Mixer set volume - cannot set volume for undefined source: "+e):l.pf(d,k)},this);a.register("mixer-gain-left",function(d){this.sg=Math.pow(10,d/20);this.update()},this);a.register("mixer-gain-right",function(d){this.tg=Math.pow(10,d/20);this.update()},this);a.register("mixer-treble-left",c(this.i),this);a.register("mixer-treble-right",
c(this.j),this);a.register("mixer-bass-left",c(this.g),this);a.register("mixer-bass-right",c(this.h),this)}function xf(a,b,c){b=new yf(a.N,b,a.I,a.K);n(!a.sources.has(c),"Mixer add source - overwritting source: "+c);a.sources.set(c,b);return b}function vf(a,b,c){a=a.sources.get(b);void 0===a?n(!1,"Mixer connect - cannot connect undefined source: "+b):a.connect(c)}function wf(a,b,c){a=a.sources.get(b);void 0===a?n(!1,"Mixer disconnect - cannot disconnect undefined source: "+b):a.disconnect(c)}
tf.prototype.pf=function(a,b){void 0===b&&(b=2);switch(b){case 0:this.D=a;break;case 1:this.F=a;break;case 2:this.B=a;break;default:n(!1,"Mixer set master volume - unknown channel: "+b);return}this.update()};tf.prototype.update=function(){var a=this.B*this.F*this.tg;this.l.gain.setValueAtTime(this.B*this.D*this.sg,this.N.currentTime);this.o.gain.setValueAtTime(a,this.N.currentTime)};
function yf(a,b,c,d){this.N=a;this.o=this.l=!0;this.D=this.C=this.j=this.g=1;this.B=a.createChannelSplitter(2);this.h=a.createGain();this.i=a.createGain();b.connect(this.B);this.B.connect(this.h,0);this.h.connect(c);this.B.connect(this.i,1);this.i.connect(d)}yf.prototype.update=function(){var a=this.o*this.g*this.j*this.D;this.h.gain.setValueAtTime(this.l*this.g*this.j*this.C,this.N.currentTime);this.i.gain.setValueAtTime(a,this.N.currentTime)};
yf.prototype.connect=function(a){var b=!a||2===a;if(b||0===a)this.l=!0;if(b||1===a)this.o=!0;this.update()};yf.prototype.disconnect=function(a){var b=!a||2===a;if(b||0===a)this.l=!1;if(b||1===a)this.o=!1;this.update()};yf.prototype.pf=function(a,b){void 0===b&&(b=2);switch(b){case 0:this.C=a;break;case 1:this.D=a;break;case 2:this.j=a;break;default:n(!1,"Mixer set volume - unknown channel: "+b);return}this.update()};
function uf(a,b,c){this.Od=b.createOscillator();this.Od.type="square";this.Od.frequency.setValueAtTime(440,b.currentTime);this.g=xf(c,this.Od,1);this.g.disconnect();a.register("pcspeaker-enable",function(){vf(c,1)},this);a.register("pcspeaker-disable",function(){wf(c,1)},this);a.register("pcspeaker-update",function(d){var e=d[1],k=0;3===d[0]&&(k=Math.min(1193181.6665999999/e,this.Od.frequency.maxValue),k=Math.max(k,0));this.Od.frequency.setValueAtTime(k,b.currentTime)},this)}uf.prototype.start=function(){this.Od.start()};
function rf(a,b,c){this.A=a;this.N=b;this.enabled=!1;this.ib=48E3;b=function(){function e(f){if(0===f)return 1;f*=Math.PI;return Math.sin(f)/f}function k(){var f=Reflect.construct(AudioWorkletProcessor,[],k);f.D=3;f.B=Array(1024);f.C=0;f.I=0;f.j=0;f.F=f.B.length;f.l=0;f.K=l;f.g=l;f.M=1;f.o=0;f.i=0;f.h=0;f.port.onmessage=p=>{switch(p.data.type){case "queue":f.pa(p.data.value);break;case "sampling-rate":f.M=p.data.value/sampleRate}};return f}var l=[new Float32Array(256),new Float32Array(256)];Reflect.setPrototypeOf(k.prototype,
AudioWorkletProcessor.prototype);Reflect.setPrototypeOf(k,AudioWorkletProcessor);k.prototype.process=k.prototype.process=function(f,p){for(f=0;f<p[0][0].length;f++){for(var r=0,q=0,u=this.h+this.D,A=this.h-this.D+1;A<=u;A++){var v=this.o+A;r+=this.S(v,0)*this.U(this.i-A);q+=this.S(v,1)*this.U(this.i-A)}if(isNaN(r)||isNaN(q))r=q=0,this.P("ERROR: NaN values! Ignoring for now.");p[0][0][f]=r;p[0][1][f]=q;this.i+=this.M;this.h=Math.floor(this.i)}p=this.h;p+=this.D+2;this.i-=this.h;this.o+=this.h;this.h=
0;this.Y(p);return!0};k.prototype.U=function(f){return e(f)*e(f/this.D)};k.prototype.S=function(f,p){return 0>f?(f+=this.K[0].length,this.K[p][f]):this.g[p][f]};k.prototype.Y=function(f){var p=this.g[0].length;p-this.o<f&&(this.$(),this.o-=p)};k.prototype.$=function(){256>this.l&&this.j&&this.P("Not enough samples - should not happen during midway of playback");this.K=this.g;this.g=this.V();var f=this.g[0].length;if(256>f){for(var p=this.C,r=0;256>f&&r<this.j;)f+=this.B[p][0].length,p=p+1&this.F-
1,r++;f=Math.max(f,256);f=[new Float32Array(f),new Float32Array(f)];f[0].set(this.g[0]);f[1].set(this.g[1]);p=this.g[0].length;for(var q=0;q<r;q++){var u=this.V();f[0].set(u[0],p);f[1].set(u[1],p);p+=u[0].length}this.g=f}this.uc()};k.prototype.uc=function(){1024>this.l/this.M&&this.port.postMessage({type:"pump"})};k.prototype.pa=function(f){this.j<this.F&&(this.B[this.I]=f,this.I=this.I+1&this.F-1,this.j++,this.l+=f[0].length,this.uc())};k.prototype.V=function(){if(!this.j)return l;var f=this.B[this.C];
this.B[this.C]=null;this.C=this.C+1&this.F-1;this.j--;this.l-=f[0].length;return f};k.prototype.P=function(f){this.port.postMessage({type:"debug-log",value:f})};registerProcessor("dac-processor",k)}.toString();var d=URL.createObjectURL(new Blob(["var DEBUG = true;\n"+b.substring(b.indexOf("{")+1,b.lastIndexOf("}"))],{type:"application/javascript"}));this.Pa=null;this.g=this.N.createGain();this.N.audioWorklet.addModule(d).then(()=>{URL.revokeObjectURL(d);this.Pa=new AudioWorkletNode(this.N,"dac-processor",
{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2],parameterData:{},processorOptions:{}});this.Pa.port.postMessage({type:"sampling-rate",value:this.ib});this.Pa.port.onmessage=e=>{switch(e.data.type){case "pump":this.uc();break;case "debug-log":t("SpeakerWorkletDAC - Worklet: "+e.data.value)}};this.Pa.connect(this.g)});this.i=xf(c,this.g,2);this.i.g=3;a.register("dac-send-data",function(e){this.Kf(e)},this);a.register("dac-enable",function(){this.enabled=!0},this);a.register("dac-disable",
function(){this.enabled=!1},this);a.register("dac-tell-sampling-rate",function(e){n(0<e,"Sampling rate should be nonzero");this.ib=e;this.Pa&&this.Pa.port.postMessage({type:"sampling-rate",value:e})},this);this.h=new zf(this.N,this.g)}rf.prototype.Kf=function(a){this.Pa&&(Af(this.h,a),this.Pa.port.postMessage({type:"queue",value:a},[a[0].buffer,a[1].buffer]))};rf.prototype.uc=function(){this.enabled&&this.A.send("dac-request-data")};
function sf(a,b,c){this.A=a;this.N=b;this.enabled=!1;this.ib=22050;this.g=0;this.ve=1;this.ef=this.N.createBiquadFilter();this.ef.type="lowpass";this.h=this.ef;this.j=xf(c,this.h,2);this.j.g=3;a.register("dac-send-data",function(d){this.Kf(d)},this);a.register("dac-enable",function(){this.enabled=!0;this.uc()},this);a.register("dac-disable",function(){this.enabled=!1},this);a.register("dac-tell-sampling-rate",function(d){n(0<d,"Sampling rate should be nonzero");this.ib=d;this.ve=Math.ceil(8E3/d);
this.ef.frequency.setValueAtTime(d/2,this.N.currentTime)},this);this.i=new zf(this.N,this.h)}
sf.prototype.Kf=function(a){Af(this.i,a);var b=a[0].length,c=b/this.ib;if(1<this.ve){var d=this.N.createBuffer(2,b*this.ve,this.ib*this.ve);for(var e=d.getChannelData(0),k=d.getChannelData(1),l=0,f=0;f<b;f++)for(var p=0;p<this.ve;p++,l++)e[l]=a[0][f],k[l]=a[1][f]}else d=this.N.createBuffer(2,b,this.ib),d.copyToChannel?(d.copyToChannel(a[0],0),d.copyToChannel(a[1],1)):(d.getChannelData(0).set(a[0]),d.getChannelData(1).set(a[1]));a=this.N.createBufferSource();a.buffer=d;a.connect(this.ef);a.addEventListener("ended",
this.uc.bind(this));d=this.N.currentTime;if(this.g<d)for(t("Speaker DAC - Creating/Recreating reserve - shouldn't occur frequently during playback"),this.g=d,d=.2-c,b=0;b<=d;)b+=c,this.g+=c,setTimeout(()=>this.uc(),1E3*b);a.start(this.g);this.g+=c;setTimeout(()=>this.uc(),0)};sf.prototype.uc=function(){this.enabled&&(.2<this.g-this.N.currentTime||this.A.send("dac-request-data"))};
function zf(a,b){this.N=a;this.l=b;this.Pa=null;this.j=this.N.createGain();this.j.gain.setValueAtTime(0,this.N.currentTime);this.j.connect(this.N.destination);this.i=!1;this.B=[];this.o=[];this.h=[[],[]];this.g=[[],[]]}
zf.prototype.start=function(a){this.i=!0;this.h=[[],[]];this.g=[[],[]];this.B.push(this.h);this.o.push(this.g);this.Pa=this.N.createScriptProcessor(1024,2,2);this.Pa.onaudioprocess=b=>{this.g[0].push(b.inputBuffer.getChannelData(0).slice());this.g[1].push(b.inputBuffer.getChannelData(1).slice())};this.l.connect(this.Pa);this.Pa.connect(this.j);setTimeout(()=>{this.stop()},a)};zf.prototype.stop=function(){this.i=!1;this.l.disconnect(this.Pa);this.Pa.disconnect();this.Pa=null};
function Af(a,b){a.i&&(a.h[0].push(b[0].slice()),a.h[1].push(b[1].slice()))};function Bf(a,b){function c(f){l.A&&l.enabled&&(l.i(f.which),f.preventDefault())}function d(f){var p=f.which;8===p?(l.i(127),f.preventDefault()):9===p&&(l.i(9),f.preventDefault())}function e(f){if(l.enabled){for(var p=f.clipboardData.getData("text/plain"),r=0;r<p.length;r++)l.i(p.charCodeAt(r));f.preventDefault()}}function k(f){f.target!==a&&a.blur()}var l=this;this.enabled=!0;this.A=b;this.text="";this.j=!1;this.h=0;this.A.register("serial0-output-char",function(f){this.Xj(f)},this);this.Da=function(){a.removeEventListener("keypress",
c,!1);a.removeEventListener("keydown",d,!1);a.removeEventListener("paste",e,!1);window.removeEventListener("mousedown",k,!1)};this.fb=function(){this.Da();a.style.display="block";a.addEventListener("keypress",c,!1);a.addEventListener("keydown",d,!1);a.addEventListener("paste",e,!1);window.addEventListener("mousedown",k,!1)};this.fb();this.Xj=function(f){"\b"===f?(this.text=this.text.slice(0,-1),this.update()):"\r"!==f&&(this.text+=f,"\n"===f&&(this.j=!0),this.update())};this.update=function(){var f=
Date.now(),p=f-this.h;16>p?void 0===this.g&&(this.g=setTimeout(()=>{this.g=void 0;var r=Date.now();n(15<=r-this.h);this.h=r;this.l()},16-p)):(void 0!==this.g&&(clearTimeout(this.g),this.g=void 0),this.h=f,this.l())};this.l=function(){a.value=this.text;this.j&&(this.j=!1,a.scrollTop=1E9)};this.i=function(f){l.A&&l.A.send("serial0-input",f)}}
function Cf(a,b){this.element=a;if(window.Terminal){var c=this.g=new window.Terminal;c.setOption("logLevel","off");c.write("This is the serial console. Whatever you type or paste here will be sent to COM1");c.onData(function(d){for(let e=0;e<d.length;e++)b.send("serial0-input",d.charCodeAt(e))});b.register("serial0-output-char",function(d){c.write(d)},this)}}Cf.prototype.show=function(){this.g&&this.g.open(this.element)};function Df(a,b){this.A=b;this.g=void 0;this.h=[];this.url=a;this.i=Date.now()-1E4;this.A.register("net0-send",function(c){this.send(c)},this)}m=Df.prototype;m.fi=function(a){this.A&&this.A.send("net0-receive",new Uint8Array(a.data))};m.di=function(){this.connect();setTimeout(this.connect.bind(this),1E4)};m.gi=function(){for(var a=0;a<this.h.length;a++)this.send(this.h[a]);this.h=[]};m.ei=function(){};m.Da=function(){this.g&&this.g.close()};
m.connect=function(){if("undefined"!==typeof WebSocket){if(this.g){var a=this.g.readyState;if(0===a||1===a)return}this.i+1E4>Date.now()||(this.i=Date.now(),this.g=new WebSocket(this.url),this.g.binaryType="arraybuffer",this.g.onopen=this.gi.bind(this),this.g.onmessage=this.fi.bind(this),this.g.onclose=this.di.bind(this),this.g.onerror=this.ei.bind(this))}};m.send=function(a){this.g&&1===this.g.readyState?this.g.send(a):(this.h.push(a),128<this.h.length&&(this.h=this.h.slice(-64)),this.connect())};(function(){function a(f,p,r){function q(){const y=r||0;setTimeout(()=>{a(f,p,y+1)},1E3*([1,1,2,3,5,8,13,21][y]||34))}var u=new XMLHttpRequest;u.open(p.method||"get",f,!0);u.responseType=p.$c?"json":"arraybuffer";if(p.headers)for(var A=Object.keys(p.headers),v=0;v<A.length;v++){var w=A[v];u.setRequestHeader(w,p.headers[w])}p.Rd&&(A=p.Rd.start,u.setRequestHeader("Range","bytes="+A+"-"+(A+p.Rd.length-1)),u.onreadystatechange=function(){200===u.status&&u.abort()});u.onload=function(){4===u.readyState&&
(200!==u.status&&206!==u.status?(console.error("Loading the image "+f+" failed (status %d)",u.status),500<=u.status&&600>u.status&&q()):u.response&&p.done&&p.done(u.response,u))};u.onerror=function(y){console.error("Loading the image "+f+" failed",y);q()};p.progress&&(u.onprogress=function(y){p.progress(y)});u.send(null)}function b(f,p){let r=require("fs");p.Rd?(n(!p.$c),r.open(f,"r",(q,u)=>{if(q)throw q;let A=p.Rd.length;var v=Buffer.allocUnsafe(A);r.read(u,v,0,A,p.Rd.start,(w,y)=>{if(w)throw w;
n(y===A);p.done&&p.done(new Uint8Array(v));r.close(u,z=>{if(z)throw z;})})})):r.readFile(f,{encoding:p.$c?"utf-8":null},function(q,u){q?console.log("Could not read file:",f,q):(q=u,p.$c?q=JSON.parse(q):q=(new Uint8Array(q)).buffer,p.done(q))})}function c(f,p){this.filename=f;this.g=256;this.byteLength=p;this.h=Object.create(null);this.onload=void 0}function d(f,p,r){const q=f.match(/(.*)(\..*)/);q?(this.i=q[1],this.j=q[2]):(this.i=f,this.j="");this.g=256;this.byteLength=p;this.B="number"===typeof r;
this.jd=r;this.h=Object.create(null);this.onload=void 0}function e(f){this.g=f;this.byteLength=f.size;1073741824<f.size&&console.warn("SyncFileBuffer: Allocating buffer of "+(f.size>>20)+" MB ...");this.buffer=new ArrayBuffer(f.size);this.onload=void 0}function k(f){this.i=f;this.byteLength=f.size;this.g=256;this.h=Object.create(null);this.onload=void 0}"undefined"===typeof XMLHttpRequest?Eb=b:Eb=a;Fb=c;Gb=d;Hb=k;kb=e;Ib=function(f,p,r){return String.fromCharCode(...(new Uint8Array(f.buffer,p>>>0,
r>>>0)))};var l="undefined"===typeof XMLHttpRequest?function(f,p){require("fs").stat(f,(r,q)=>{r?p(r):p(null,q.size)})}:function(f,p){Eb(f,{done:(r,q)=>{r=q.getResponseHeader("Content-Range")||"";(q=r.match(/\/(\d+)\s*$/))?p(null,+q[1]):p("`Range: bytes=...` header not supported (Got `"+r+"`)")},headers:{Range:"bytes=0-0"}})};c.prototype.load=function(){void 0!==this.byteLength?this.onload&&this.onload(Object.create(null)):l(this.filename,(f,p)=>{if(f)throw Error("Cannot use: "+this.filename+". "+
f);n(0<=p);this.byteLength=p;this.onload&&this.onload(Object.create(null))})};c.prototype.i=function(f,p){var r=p/this.g;f/=this.g;for(var q=0;q<r;q++)if(!this.h[f+q])return;if(1===r)return this.h[f];p=new Uint8Array(p);for(q=0;q<r;q++)p.set(this.h[f+q],q*this.g);return p};c.prototype.get=function(f,p,r){console.assert(f+p<=this.byteLength);console.assert(0===f%this.g);console.assert(0===p%this.g);console.assert(p);var q=this.i(f,p,r);q?r(q):Eb(this.filename,{done:function(u){u=new Uint8Array(u);
this.j(f,p,u);r(u)}.bind(this),Rd:{start:f,length:p}})};c.prototype.set=function(f,p,r){console.assert(f+p.byteLength<=this.byteLength);var q=p.length;console.assert(0===f%this.g);console.assert(0===q%this.g);console.assert(q);f/=this.g;q/=this.g;for(var u=0;u<q;u++){var A=this.h[f+u];void 0===A&&(A=this.h[f+u]=new Uint8Array(this.g));var v=p.subarray(u*this.g,(u+1)*this.g);A.set(v);console.assert(A.byteLength===v.length)}r()};c.prototype.j=function(f,p,r){f/=this.g;p/=this.g;for(var q=0;q<p;q++){var u=
this.h[f+q];u&&r.set(u,q*this.g)}};c.prototype.Wb=function(f){f()};c.prototype.W=function(){const f=[],p=[];for(let [r,q]of Object.entries(this.h))n(isFinite(+r)),p.push([+r,q]);f[0]=p;return f};c.prototype.G=function(f){f=f[0];this.h=Object.create(null);for(let [p,r]of Object.values(f))this.h[p]=r};d.prototype.load=function(){void 0===this.byteLength&&n(!1);this.onload&&this.onload(Object.create(null))};d.prototype.o=c.prototype.i;d.prototype.get=function(f,p,r){console.assert(f+p<=this.byteLength);
console.assert(0===f%this.g);console.assert(0===p%this.g);console.assert(p);var q=this.o(f,p,r);if(q)r(q);else if(this.B){q=Math.floor(f/this.jd);const u=f-q*this.jd;n(0<=u);const A=Math.floor(p/this.jd)+(0===u?1:2),v=new Uint8Array(u+A*this.jd);let w=0;for(let y=0;y<A;y++)Eb(this.i+"-"+(q+y+"").padStart(8,"0")+this.j,{done:function(z){var D=y*this.jd;z=new Uint8Array(z);v.set(z,D);w++;w===A&&(D=v.subarray(u,u+p),this.l(f,p,D),r(D))}.bind(this)})}else Eb(this.i+"-"+f+"-"+(f+p)+this.j,{done:function(u){n(u.byteLength===
p);u=new Uint8Array(u);this.l(f,p,u);r(u)}.bind(this)})};d.prototype.set=c.prototype.set;d.prototype.l=c.prototype.j;d.prototype.W=c.prototype.W;d.prototype.G=c.prototype.G;e.prototype.load=function(){this.h(0)};e.prototype.h=function(f){var p=new FileReader;p.onload=function(r){r=new Uint8Array(r.target.result);(new Uint8Array(this.buffer,f)).set(r);this.h(f+4194304)}.bind(this);f<this.byteLength?p.readAsArrayBuffer(this.g.slice(f,Math.min(f+4194304,this.byteLength))):(this.g=void 0,this.onload&&
this.onload({buffer:this.buffer}))};e.prototype.get=function(f,p,r){console.assert(f+p<=this.byteLength);r(new Uint8Array(this.buffer,f,p))};e.prototype.set=function(f,p,r){console.assert(f+p.byteLength<=this.byteLength);(new Uint8Array(this.buffer,f,p.byteLength)).set(p);r()};e.prototype.Wb=function(f){f(this.buffer)};e.prototype.W=function(){const f=[];f[0]=this.byteLength;f[1]=new Uint8Array(this.buffer);return f};e.prototype.G=function(f){this.byteLength=f[0];this.buffer=f[1].slice().buffer};
k.prototype.load=function(){this.onload&&this.onload(Object.create(null))};k.prototype.get=function(f,p,r){console.assert(0===f%this.g);console.assert(0===p%this.g);console.assert(p);var q=this.j(f,p,r);q?r(q):(q=new FileReader,q.onload=function(u){u=new Uint8Array(u.target.result);this.l(f,p,u);r(u)}.bind(this),q.readAsArrayBuffer(this.i.slice(f,f+p)))};k.prototype.j=c.prototype.i;k.prototype.set=c.prototype.set;k.prototype.l=c.prototype.j;k.prototype.W=c.prototype.W;k.prototype.Wb=function(f){f()};
k.prototype.ug=function(f){for(var p=[],r=Object.keys(this.h).map(Number).sort(function(w,y){return w-y}),q=0,u=0;u<r.length;u++){var A=r[u],v=this.h[A];A*=this.g;console.assert(A>=q);A!==q&&(p.push(this.i.slice(q,A)),q=A);p.push(v);q+=v.length}q!==this.i.size&&p.push(this.i.slice(q));f=new File(p,f);console.assert(f.size===this.i.size);return f}})();function cb(a){this.ae=!1;var b=qe();this.A=b[0];this.he=b[1];var c,d;const e=new WebAssembly.Table({element:"anyfunc",initial:1924});b={cpu_exception_hook:l=>this.cpu_exception_hook&&this.cpu_exception_hook(l),hlt_op:function(){var l=c;0===(l.C()&512)&&l.A.send("cpu-event-halt");l.j[0]=1;xb(l)},abort:function(){n(!1)},microtick:yb,get_rand_int:function(){return Jb()},pic_acknowledge:function(){ze(c)},io_port_read8:function(l){var f=c.u,p=f.ports[l];p.Fa===f.Qe&&t("read8 port  #"+M(l,4)+sb(l),32);
f=p.Fa.call(p.ma);n(256>f,"8 bit port returned large value: "+M(l));return f},io_port_read16:function(l){var f=c.u,p=f.ports[l];p.sa===f.Oe&&t("read16 port  #"+M(l,4)+sb(l),32);f=p.sa.call(p.ma);n(65536>f&&0<=f,"16 bit port returned large value: "+M(l));return f},io_port_read32:function(l){var f=c.u,p=f.ports[l];p.Vc===f.Pe&&t("read32 port  #"+M(l,4)+sb(l),32);l=p.Vc.call(p.ma);n((l|0)===l);return l},io_port_write8:function(l,f){var p=c.u,r=p.ports[l];r.Jd===p.ob&&t("write8 port #"+M(l,4)+" <- "+
M(f,2)+sb(l),32);r.Jd.call(r.ma,f)},io_port_write16:function(l,f){var p=c.u,r=p.ports[l];r.Yc===p.ob&&t("write16 port #"+M(l,4)+" <- "+M(f,4)+sb(l),32);r.Yc.call(r.ma,f)},io_port_write32:function(l,f){var p=c.u,r=p.ports[l];r.Eb===p.ob&&t("write32 port #"+M(l,4)+" <- "+M(f>>>0,8)+sb(l),32);r.Eb.call(r.ma,f)},mmap_read8:function(l){l=c.l[l>>>17](l);n(0<=l&&255>=l);return l},mmap_read16:function(l){var f=c.l[l>>>17];l=f(l)|f(l+1|0)<<8;n(0<=l&&65535>=l);return l},mmap_read32:function(l){return c.Hb[l>>>
17](l)},mmap_write8:function(l,f){var p=c;n(0<=f&&255>=f);p.re[l>>>17](l,f)},mmap_write16:function(l,f){var p=c.re[l>>>17];n(0<=f&&65535>=f);p(l,f&255);p(l+1|0,f>>8)},mmap_write32:function(l,f){c.qe[l>>>17](l,f)},mmap_write64:function(l,f,p){var r=c,q=l>>>17;n(q===l+7>>>17);r=r.qe[q];r(l,f);r(l+4,p)},mmap_write128:function(l,f,p,r,q){var u=c,A=l>>>17;n(A===l+12>>>17);u=u.qe[A];u(l,f);u(l+4,p);u(l+8,r);u(l+12,q)},log_from_wasm:function(l,f){l=Ib(d,l,f);t(l,2)},console_log_from_wasm:function(l,f){l=
Ib(d,l,f);console.error(l)},dbg_trace_from_wasm:function(){t(Error().stack,void 0)},codegen_finalize:(l,f,p,r,q)=>{ye(c,l,f,p,r,q)},jit_clear_func:l=>{var f=c;n(0<=l&&900>l);f.xa.Xf.set(l+1024,null)},jit_clear_all_funcs:()=>{const l=c.xa.Xf;for(let f=0;900>f;f++)l.set(1024+f,null)},__indirect_function_table:e};let k=a.wasm_fn;k||(k=l=>new Promise(f=>{let p="v86-debug.wasm",r="v86-fallback.wasm";if(a.wasm_path){p=a.wasm_path;const q=p.lastIndexOf("/");r=(-1===q?"":p.substr(0,q))+"/"+r}else"undefined"===
typeof window&&"string"===typeof __dirname?(p=__dirname+"/"+p,r=__dirname+"/"+r):(p="build/"+p,r="build/"+r);Eb(p,{done:q=>{WebAssembly.instantiate(q,l).then(({instance:u})=>{f(u.exports)},()=>{Eb(r,{done:u=>{WebAssembly.instantiate(u,l).then(({instance:A})=>{f(A.exports)})}})})},progress:q=>{this.he.send("download-progress",{le:0,ke:1,me:p,lengthComputable:q.lengthComputable,total:q.total,loaded:q.loaded})}})}));k({env:b}).then(l=>{d=l.memory;l.rust_init();l=this.Db=new tb(this.he,{exports:l,Xf:e});
c=l.s;Ef(this,l,a)})}
async function Ef(a,b,c){function d(v,w){switch(v){case "hda":l.T=this.kc.hda=w;break;case "hdb":l.We=this.kc.hdb=w;break;case "cdrom":l.na=this.kc.cdrom=w;break;case "fda":l.oa=this.kc.fda=w;break;case "fdb":l.og=this.kc.fdb=w;break;case "multiboot":l.td=this.kc.multiboot=w.buffer;break;case "bzimage":l.xb=this.kc.bzimage=w.buffer;break;case "initrd":l.Hc=this.kc.initrd=w.buffer;break;case "bios":l.Kd=w.buffer;break;case "vga_bios":l.fk=w.buffer;break;case "initial_state":l.md=w.buffer;break;case "fs9p_json":l.rg=
w;break;default:n(!1,v)}}function e(v,w){if(w)if(w.get&&w.set&&w.load)f.push({name:v,qd:w});else{w={buffer:w.buffer,async:w.async,url:w.url,size:w.size,jd:w.fixed_chunk_size,ka:w.ka};if("bios"===v||"vga_bios"===v||"initial_state"===v||"multiboot"===v||"bzimage"===v||"initrd"===v)w.async=!1;w.buffer instanceof ArrayBuffer?(w=new Kb(w.buffer),f.push({name:v,qd:w})):"undefined"!==typeof File&&w.buffer instanceof File?(void 0===w.async&&(w.async=268435456<=w.buffer.size),w=w.async?new Hb(w.buffer):new kb(w.buffer),
f.push({name:v,qd:w})):w.url?w.async?(w=w.ka?new Gb(w.url,w.size,w.jd):new Fb(w.url,w.size),f.push({name:v,qd:w})):f.push({name:v,url:w.url,size:w.size}):t("Ignored file: url="+w.url+" buffer="+w.buffer)}}function k(){function v(){this.Vd&&this.Vd.show&&this.Vd.show();this.A.send("cpu-init",l);l.md&&(b.Sd(l.md),l.md=void 0);c.autostart&&this.A.send("cpu-run");this.he.send("emulator-loaded")}if(l.Vb&&l.rg)if(l.md?t("Filesystem basefs ignored: Overridden by state image"):Le(l.Vb,l.rg),c.bzimage_initrd_from_filesystem){const {xb:w,
Hc:y}=Ff(l.Vb);t("Found bzimage: "+w+" and initrd: "+y);Promise.all([l.Vb.we(y),l.Vb.we(w)]).then(([z,D])=>{d.call(this,"initrd",new Kb(z.buffer));d.call(this,"bzimage",new Kb(D.buffer));v.call(this)})}else v.call(this);else console.assert(!c.bzimage_initrd_from_filesystem,"bzimage_initrd_from_filesystem: Requires a filesystem"),v.call(this)}a.A.register("emulator-stopped",function(){this.ae=!1},a);a.A.register("emulator-started",function(){this.ae=!0},a);var l={};a.kc={fda:void 0,fdb:void 0,hda:void 0,
hdb:void 0,cdrom:void 0};l.Na=c.acpi;l.ki=!0;l.Ag=c.log_level;l.H=c.memory_size||67108864;l.da=c.vga_memory_size||8388608;l.cd=c.boot_order||531;l.$h=c.fastboot||!1;l.oa=void 0;l.og=void 0;l.ze=c.uart1;l.Ae=c.uart2;l.Be=c.uart3;l.dd=c.cmdline;l.tc=c.preserve_mac_from_state_image;c.network_adapter?a.j=c.network_adapter(a.A):c.network_relay_url&&(a.j=new Df(c.network_relay_url,a.A));l.Xh=!0;c.disable_keyboard||(a.i=new of(a.A));c.disable_mouse||(a.h=new pf(a.A,c.screen_container));c.screen_container?
a.g=new Za(c.screen_container,a.A):c.screen_dummy&&(a.g=new Gf(a.A));c.serial_container&&(a.Vd=new Bf(c.serial_container,a.A));c.serial_container_xtermjs&&(a.Vd=new Cf(c.serial_container_xtermjs,a.A));c.disable_speaker||(a.l=new qf(a.A));var f=[];c.state&&console.warn("Warning: Unknown option 'state'. Did you mean 'initial_state'?");for(var p="bios vga_bios cdrom hda hdb fda fdb initial_state multiboot bzimage initrd".split(" "),r=0;r<p.length;r++)e(p[r],c[p[r]]);if(c.filesystem){p=c.filesystem.basefs;
r=c.filesystem.baseurl;let v=new Hf;r&&(v=new If(v,r));l.Vb=a.Vb=new Je(v);if(p){console.assert(r,"Filesystem: baseurl must be specified");if("object"===typeof p){var q=p.size;p=p.url}n("string"===typeof p);f.push({name:"fs9p_json",url:p,size:q,$c:!0})}}var u=f.length,A=function(v){if(v===u)setTimeout(k.bind(this),0);else{var w=f[v];w.qd?(w.qd.onload=function(){d.call(this,w.name,w.qd);A(v+1)}.bind(this),w.qd.load()):Eb(w.url,{done:function(y){d.call(this,w.name,w.$c?y:new Kb(y));A(v+1)}.bind(this),
progress:function(y){200===y.target.status?a.he.send("download-progress",{le:v,ke:u,me:w.url,lengthComputable:y.lengthComputable,total:y.total||w.size,loaded:y.loaded}):a.he.send("download-error",{le:v,ke:u,me:w.url,request:y.target})},$c:w.$c})}}.bind(a);A(0)}
function Ff(a){const b=(lf(a,"/")||[]).map(e=>"/"+e);a=(lf(a,"/boot/")||[]).map(e=>"/boot/"+e);let c,d;for(let e of[].concat(b,a)){const k=/old/i.test(e)||/fallback/i.test(e),l=/initrd/i.test(e)||/initramfs/i.test(e);!/vmlinuz/i.test(e)&&!/bzimage/i.test(e)||d&&k||(d=e);!l||c&&k||(c=e)}c&&d||(console.log("Failed to find bzimage or initrd in filesystem. Files:"),console.log(b.join(" ")),console.log(a.join(" ")));return{Hc:c,xb:d}}m=cb.prototype;m.mf=function(){this.A.send("cpu-run")};m.stop=function(){this.A.send("cpu-stop")};
m.Da=function(){this.stop();this.Db.Da();this.i&&this.i.Da();this.j&&this.j.Da();this.h&&this.h.Da();this.g&&this.g.Da();this.Vd&&this.Vd.Da()};m.Lf=function(){this.A.send("cpu-restart")};function db(a,b,c){a.A.register(b,c,a)}m.Sd=function(a){this.Db.Sd(a)};m.xe=function(a){setTimeout(function(){try{a(null,this.Db.xe())}catch(b){a(b,null)}}.bind(this),0)};function fb(a,b){for(var c=0;c<b.length;c++)a.A.send("keyboard-code",b[c])}function $a(a,b){for(var c=0;c<b.length;c++)a.i.Yj(b[c])}
function jb(){var a=document.body,b=a.requestPointerLock||a.mozRequestPointerLock||a.webkitRequestPointerLock;b&&b.call(a)}function mb(a,b,c){var d=d||function(){};if(a=a.Vb){var e=b.split("/");e=e[e.length-1];b=ef(a,b).Gf;""!==e&&-1!==b?Ve(a,e,b,c).then(()=>d(null)):setTimeout(function(){d(new Jf)},0)}}m.we=function(a,b){var c=this.Vb;c&&c.we(a).then(d=>{d?b(null,d):b(new Jf,null)})};function Jf(){this.message="File not found"}Jf.prototype=Error.prototype;
"undefined"!==typeof window?(window.V86Starter=cb,window.V86=cb):"undefined"!==typeof module&&"undefined"!==typeof module.exports?(module.exports.V86Starter=cb,module.exports.V86=cb):"function"===typeof importScripts&&(self.V86Starter=cb,self.V86=cb);function Gf(a){var b,c,d,e,k;this.A=a;a.register("screen-set-mode",function(l){this.Pf(l)},this);a.register("screen-fill-buffer-end",function(l){this.Vf(l[0])},this);a.register("screen-put-char",function(l){this.Jf(l[0],l[1],l[2],l[3],l[4])},this);a.register("screen-text-scroll",function(l){console.log("scroll",l)},this);a.register("screen-update-cursor",function(l){this.Gd(l[0],l[1])},this);a.register("screen-update-cursor-scanline",function(l){this.Hd(l[0],l[1])},this);a.register("screen-set-size-text",
function(l){this.Cd(l[0],l[1])},this);a.register("screen-set-size-graphical",function(l){this.Bd(l[0],l[1])},this);this.Jf=function(l,f,p,r,q){l<k&&f<e&&(l=3*(l*e+f),d[l]=p,d[l+1]=r,d[l+2]=q)};this.Da=function(){};this.Pf=function(){};this.eg=function(){};this.Cd=function(l,f){if(l!==e||f!==k)d=new Int32Array(l*f*3),e=l,k=f};this.Bd=function(){};this.Qf=function(){};this.Hd=function(){};this.Gd=function(l,f){if(l!==b||f!==c)b=l,c=f};this.Vf=function(){}};const eb={Zj:function(a){return eb.Rj(a)+eb.Qj(a)},Rj:function(a){let b="";var c="COMPILE COMPILE_SKIPPED_NO_NEW_ENTRY_POINTS COMPILE_SUCCESS COMPILE_WRONG_ADDRESS_SPACE COMPILE_CUT_OFF_AT_END_OF_PAGE COMPILE_WITH_LOOP_SAFETY COMPILE_PAGE COMPILE_PAGE/COMPILE_SUCCESS COMPILE_PAGE_SKIPPED_NO_NEW_ENTRY_POINTS COMPILE_BASIC_BLOCK COMPILE_DUPLICATED_BASIC_BLOCK COMPILE_WASM_BLOCK COMPILE_WASM_LOOP COMPILE_DISPATCHER COMPILE_ENTRY_POINT COMPILE_WASM_TOTAL_BYTES COMPILE_WASM_TOTAL_BYTES/COMPILE_PAGE JIT_CACHE_OVERRIDE JIT_CACHE_OVERRIDE_DIFFERENT_STATE_FLAGS RUN_INTERPRETED RUN_INTERPRETED_PENDING RUN_INTERPRETED_NEAR_END_OF_PAGE RUN_INTERPRETED_DIFFERENT_STATE RUN_INTERPRETED_MISSED_COMPILED_ENTRY_RUN_INTERPRETED RUN_INTERPRETED_MISSED_COMPILED_ENTRY_LOOKUP RUN_INTERPRETED_STEPS RUN_FROM_CACHE RUN_FROM_CACHE_STEPS RUN_FROM_CACHE_STEPS/RUN_FROM_CACHE RUN_FROM_CACHE_STEPS/RUN_INTERPRETED_STEPS DIRECT_EXIT INDIRECT_JUMP INDIRECT_JUMP_NO_ENTRY NORMAL_PAGE_CHANGE NORMAL_FALLTHRU NORMAL_FALLTHRU_WITH_TARGET_BLOCK NORMAL_BRANCH NORMAL_BRANCH_WITH_TARGET_BLOCK CONDITIONAL_JUMP CONDITIONAL_JUMP_PAGE_CHANGE CONDITIONAL_JUMP_EXIT CONDITIONAL_JUMP_FALLTHRU CONDITIONAL_JUMP_FALLTHRU_WITH_TARGET_BLOCK CONDITIONAL_JUMP_BRANCH CONDITIONAL_JUMP_BRANCH_WITH_TARGET_BLOCK DISPATCHER_SMALL DISPATCHER_LARGE LOOP LOOP_SAFETY CONDITION_OPTIMISED CONDITION_UNOPTIMISED FAILED_PAGE_CHANGE SAFE_READ_FAST SAFE_READ_SLOW_PAGE_CROSSED SAFE_READ_SLOW_NOT_VALID SAFE_READ_SLOW_NOT_USER SAFE_READ_SLOW_IN_MAPPED_RANGE SAFE_WRITE_FAST SAFE_WRITE_SLOW_PAGE_CROSSED SAFE_WRITE_SLOW_NOT_VALID SAFE_WRITE_SLOW_NOT_USER SAFE_WRITE_SLOW_IN_MAPPED_RANGE SAFE_WRITE_SLOW_READ_ONLY SAFE_WRITE_SLOW_HAS_CODE SAFE_READ_WRITE_FAST SAFE_READ_WRITE_SLOW_PAGE_CROSSED SAFE_READ_WRITE_SLOW_NOT_VALID SAFE_READ_WRITE_SLOW_NOT_USER SAFE_READ_WRITE_SLOW_IN_MAPPED_RANGE SAFE_READ_WRITE_SLOW_READ_ONLY SAFE_READ_WRITE_SLOW_HAS_CODE PAGE_FAULT TLB_MISS DO_RUN DO_MANY_CYCLES CYCLE_INTERNAL INVALIDATE_ALL_MODULES_NO_FREE_WASM_INDICES INVALIDATE_MODULE_WRITTEN_WHILE_COMPILED INVALIDATE_MODULE_UNUSED_AFTER_OVERWRITE INVALIDATE_MODULE_DIRTY_PAGE INVALIDATE_PAGE_HAD_CODE INVALIDATE_PAGE_HAD_ENTRY_POINTS DIRTY_PAGE_DID_NOT_HAVE_CODE RUN_FROM_CACHE_EXIT_SAME_PAGE RUN_FROM_CACHE_EXIT_NEAR_END_OF_PAGE RUN_FROM_CACHE_EXIT_DIFFERENT_PAGE CLEAR_TLB FULL_CLEAR_TLB TLB_FULL TLB_GLOBAL_FULL MODRM_SIMPLE_REG MODRM_SIMPLE_REG_WITH_OFFSET MODRM_SIMPLE_CONST_OFFSET MODRM_COMPLEX SEG_OFFSET_OPTIMISED SEG_OFFSET_NOT_OPTIMISED".split(" "),
d=0;const e={};for(let l=0;l<c.length;l++){const f=c[l];var k=void 0;if(f.includes("/")){d++;const [p,r]=f.split("/");k=e[p]/e[r]}else k=e[f]=a.xa.exports.profiler_stat_get(l-d),k=1E8<=k?Math.round(k/1E6)+"m":1E5<=k?Math.round(k/1E3)+"k":k;b+=f+"="+k+"\n"}b+="\n";c=a.xa.exports.get_valid_tlb_entries_count();d=a.xa.exports.get_valid_global_tlb_entries_count();b=b+("TLB_ENTRIES="+c+" ("+d+" global, "+(c-d)+" non-global)\nWASM_TABLE_FREE=")+(a.xa.exports.jit_get_wasm_table_index_free_list_count()+"\n");
b+="JIT_CACHE_SIZE="+a.xa.exports.jit_get_cache_size()+"\n";b+="FLAT_SEGMENTS="+a.xa.exports.has_flat_segmentation()+"\n";b+="do_many_cycles avg: "+(a.xf/a.mg||0)+"\n";b+="wasm memory size: "+(a.Xa.buffer.byteLength>>20)+"m\n";b=b+"Config:\nMAX_PAGES="+(a.xa.exports.get_config(0)+"\n");b+="JIT_USE_LOOP_SAFETY="+a.xa.exports.get_config(1)+"\n";return b+="MAX_EXTRA_BASIC_BLOCKS="+a.xa.exports.get_config(2)+"\n"},Qj:function(a){return[eb.ue(a,!1,!1,!1,!1),eb.ue(a,!0,!1,!1,!1),eb.ue(a,!1,!0,!1,!1),eb.ue(a,
!1,!1,!0,!1),eb.ue(a,!1,!1,!1,!0)].join("\n\n")},ue:function(a,b,c,d,e){let k="";var l=[],f=b?"compiled":c?"jit exit":d?"unguarded register":e?"wasm size":"executed";for(let q=0;256>q;q++)for(let u=0;8>u;u++)for(let A of[!1,!0]){var p=a.xa.exports.get_opstats_buffer(b,c,d,e,q,!1,A,u);l.push({ff:q,count:p,yg:A,pg:u});p=a.xa.exports.get_opstats_buffer(b,c,d,e,q,!0,A,u);l.push({ff:3840|q,count:p,yg:A,pg:u})}a=0;b=new Set([38,46,54,62,100,101,102,103,240,242,243]);for(let {count:q,ff:u}of l)b.has(u)||
(a+=q);if(0===a)return"";c=new Uint32Array(256);b=new Uint32Array(256);for(let {ff:q,count:u}of l)3840==(q&65280)?b[q&255]+=u:c[q&255]+=u;k=k+"------------------\nTotal: "+(a+"\n");const r=1E7<a?1E3:1;d=Math.max.apply(Math,l.map(({count:q})=>Math.round(q/r)));d=String(d).length;k+=`Instruction counts ${f} (in ${r}):\n`;for(e=0;256>e;e++)k+=M(e,2).slice(2)+":"+bb(Math.round(c[e]/r),d),k=15==e%16?k+"\n":k+" ";k=k+"\n"+`Instruction counts ${f} (0f, in ${r}):\n`;for(f=0;256>f;f++)k+=M(f&255,2).slice(2)+
":"+bb(Math.round(b[f]/r),d),k=15==f%16?k+"\n":k+" ";k+="\n";l=l.filter(({count:q})=>q).sort(({count:q},{count:u})=>u-q);for(let {ff:q,yg:u,pg:A,count:v}of l.slice(0,200))l=q.toString(16)+"_"+A+(u?"_m":"_r"),k+=l+":"+(v/a*100).toFixed(2)+" ";return k+"\n"}};"undefined"!==typeof module&&"undefined"!==typeof module.exports&&(module.exports.print_stats=eb);function Hf(){this.h=new Map}Hf.prototype.read=async function(a,b,c){n(a,"MemoryFileStorage read: sha256sum should be a non-empty string");return(a=this.h.get(a))?a.subarray(b,b+c):null};Hf.prototype.cache=async function(a,b){n(a,"MemoryFileStorage cache: sha256sum should be a non-empty string");this.h.set(a,b)};Hf.prototype.g=function(a){this.h.delete(a)};function If(a,b){n(b,"ServerMemoryFileStorage: baseurl should not be empty");this.h=a;this.i=b}
function Kf(a,b){return new Promise(c=>{Eb(a.i+b,{done:d=>{const e=new Uint8Array(d);a.cache(b,e).then(()=>c(e))}})})}If.prototype.read=async function(a,b,c){const d=await this.h.read(a,b,c);return d?d:(await Kf(this,a)).subarray(b,b+c)};If.prototype.cache=async function(a,b){return await this.h.cache(a,b)};If.prototype.g=function(a){this.h.g(a)};
"undefined"!==typeof window?(window.MemoryFileStorage=Hf,window.ServerFileStorageWrapper=If):"undefined"!==typeof module&&"undefined"!==typeof module.exports?(module.exports.MemoryFileStorage=Hf,module.exports.ServerFileStorageWrapper=If):"function"===typeof importScripts&&(self.MemoryFileStorage=Hf,self.ServerFileStorageWrapper=If);
